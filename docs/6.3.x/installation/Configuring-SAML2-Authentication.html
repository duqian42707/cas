<!DOCTYPE html>
<html>

<head>
    <!-- Required meta tags always come first -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="CAS - Enterprise Single Sign-On for the Web"/>
    <meta name="keywords" content="authentication, login, cas, central authentication service, web, java, protocol, thymeleaf,
                   open source, boot, spring, authorization, google, facebook, twitter, higher-ed, enterprise,
                   access management, single signon, sso, RBAC, ABAC, attributes, SAML, OpenID, openid connect,
                   JWT, ADFS"/>
    <meta name="robots" content="index,follow"/>

    
    

        
    


    

    <script>
        ((i, s, o, g, r, a, m) => {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-83384532-2', 'auto');
        ga('send', 'pageview');

    </script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3"/>

    <link rel="stylesheet" type="text/css" media="screen" href="../../stylesheets/stylesheet.css">
    <link rel="stylesheet" type="text/css" media="print" href="../../stylesheets/print.css">

    <link href='https://fonts.googleapis.com/css?family=Lato:400,300,700' rel='stylesheet'>
    <link href='https://fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic&subset=latin-ext,latin' rel='stylesheet'>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@100;200;300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css" rel="stylesheet">

    <title>CAS - SAML2 Authentication</title>

</head>

<body>
<!-- HEADER -->
<header class="hidden-sm-down">
    <div class="container">
        <div class="row">
            <div class="col-xs-4 col-md-2">
                <a href="../../index.html">
                    <img class="undecorated" src="../../images/cas_logo.png"/>
                </a>
            </div>
            <div class="col-xs-8 col-md-6">
                <h1>Enterprise Single Sign-On for All</h1>
            </div>
            <div class="hidden-sm-down col-md-4">
                <a id="forkme_banner" href="https://github.com/apereo/cas">View on GitHub</a>
            </div>

        </div>
    </div>
</header>

<!-- NAVBAR -->

<nav class="navbar navbar-expand-md navbar-dark bg-primary bg-dark">
    <div class="container">
        <button class="navbar-toggler collapsed" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarsExample04" aria-controls="navbarsExample04" aria-expanded="false"
                aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="navbar-collapse collapse" id="navbarsExample04">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active"><a href="../../index.html" class="zoom nav-link">Home</a></li>
                <li class="nav-item"><a href="https://github.com/apereo/cas/releases" class="zoom nav-link">Releases</a></li>
                <li class="nav-item"><a href="../../Support.html" class="zoom nav-link">Support</a></li>
                <li class="nav-item"><a href="../../Mailing-Lists.html" class="zoom nav-link">Mailing Lists</a></li>
                <li class="nav-item">
                    <a class="zoom nav-link" href="../../Demos.html">Demos</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="zoom nav-link dropdown-toggle mr-md-2" href="#" id="cas-versions" data-bs-toggle="dropdown"
                       aria-haspopup="true" aria-expanded="false">Versions</a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="cas-versions">
                        
                        
                        <a class="dropdown-item" href="/cas/development/">Development</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.6.x/">v6.6.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.5.x/">v6.5.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.4.x/">v6.4.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.3.x/">v6.3.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.2.x/">v6.2.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.1.x/">v6.1.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.0.x/">v6.0.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.3.x/">v5.3.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.2.x/">v5.2.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.1.x/">v5.1.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.0.x/">v5.0.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/4.2.x/">v4.2.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/4.1.x/">v4.1.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/4.0.x/">v4.0.x</a>
                        
                        

                    </div>
                </li>
                <li class="nav-item"><a href="https://apereo.github.io" target="_blank" class="zoom nav-link">Blog</a></li>
            </ul>

        </div>

    </div>
</nav>


<div class="container-fluid">
    <div class="row flex-xl-nowrap">
        <div class="col-12 col-md-3 col-xl-2 docs-sidebar pb-5" id="sidebar"></div>


        <div class="d-none d-xl-block col-xl-2 docs-toc">
    <div id="pageContents">
        <ul class="section-nav"></ul>
    </div>
</div>


        <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 cas-docs-content" role="main">


            

            <section>
                <nav id="docsNavBar">
                    <span id="toolbarIcons"></span>
                </nav>

                <div id="cas-docs-container">
                    <h1 id="saml2-authentication">SAML2 Authentication</h1>

<p>CAS can act as a SAML2 identity provider accepting authentication requests and producing SAML assertions.</p>

<p>If you intend to allow CAS to delegate authentication to an external SAML2 identity provider, you need to <a href="../integration/Delegate-Authentication.html">review this guide</a>.</p>

<div class="alert alert-info"><strong>SAML Specification</strong><p>This document solely focuses on what one might do to turn on SAML2 support inside CAS. It is not to describe/explain the numerous characteristics of the SAML2 protocol itself. If you are unsure about the concepts referred to on this page, please start with reviewing the <a href="http://docs.oasis-open.org/security/saml/Post2.0/sstc-saml-tech-overview-2.0.html">SAML2 Specification</a>.</p></div>

<h2 id="federation-interop-evaluation">Federation Interop Evaluation</h2>

<p>The CAS project strives to conform to the <a href="https://kantarainitiative.github.io/SAMLprofiles/fedinterop.html">SAML V2.0 Implementation Profile for Federation Interoperability</a>. An evaluation of the requirements against the current CAS release is available <a href="https://docs.google.com/spreadsheets/d/1NYN5n6AaNxz0UxwkzIDuXMYL1JUKNZZlSzLZEDUw4Aw/edit?usp=sharing">here</a>. It is recommended that you view, evaluate and comment on functionality that is currently either absent or marked questionable where verification is needed.</p>

<h2 id="saml-endpoints">SAML Endpoints</h2>

<p>The following CAS endpoints respond to supported SAML2 profiles:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">/idp/profile/SAML2/Redirect/SSO</code></li>
  <li><code class="language-plaintext highlighter-rouge">/idp/profile/SAML2/POST/SSO</code></li>
  <li><code class="language-plaintext highlighter-rouge">/idp/profile/SAML2/POST-SimpleSign/SSO</code></li>
  <li><code class="language-plaintext highlighter-rouge">/idp/profile/SAML2/POST/SLO</code></li>
  <li><code class="language-plaintext highlighter-rouge">/idp/profile/SAML2/Redirect/SLO</code></li>
  <li><code class="language-plaintext highlighter-rouge">/idp/profile/SAML2/Unsolicited/SSO</code></li>
  <li><code class="language-plaintext highlighter-rouge">/idp/profile/SAML2/SOAP/ECP</code></li>
  <li><code class="language-plaintext highlighter-rouge">/idp/profile/SAML2/SOAP/AttributeQuery</code></li>
  <li><code class="language-plaintext highlighter-rouge">/idp/profile/SAML1/SOAP/ArtifactResolution</code></li>
</ul>

<h2 id="idp-metadata">IdP Metadata</h2>

<p>The following CAS endpoints handle the generation of SAML2 metadata:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">/idp/metadata</code></li>
</ul>

<p>This endpoint will display the CAS IdP SAML2 metadata upon receiving a GET request. If metadata is already available and generated,
it will be displayed. If metadata is absent, one will be generated automatically.
CAS configuration below dictates where metadata files/keys will be generated and stored.</p>

<p>Note that the endpoint can accept a <code class="language-plaintext highlighter-rouge">service</code> parameter either by entity id or numeric identifier. This parameter
is matched against the CAS service registry allowing the endpoint to calculate and combine any identity provider 
metadata overrides that may have been specified.</p>

<p>Here is a generated metadata file as an example:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;EntityDescriptor</span> <span class="na">xmlns=</span><span class="s">"urn:oasis:names:tc:SAML:2.0:metadata"</span> <span class="na">xmlns:ds=</span><span class="s">"http://www.w3.org/2000/09/xmldsig#"</span>
                <span class="na">xmlns:shibmd=</span><span class="s">"urn:mace:shibboleth:metadata:1.0"</span> <span class="na">xmlns:xml=</span><span class="s">"http://www.w3.org/XML/1998/namespace"</span>
                <span class="na">xmlns:mdui=</span><span class="s">"urn:oasis:names:tc:SAML:metadata:ui"</span> <span class="na">entityID=</span><span class="s">"ENTITY_ID"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;IDPSSODescriptor</span> <span class="na">protocolSupportEnumeration=</span><span class="s">"urn:oasis:names:tc:SAML:2.0:protocol"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;Extensions&gt;</span>
            <span class="nt">&lt;shibmd:Scope</span> <span class="na">regexp=</span><span class="s">"false"</span><span class="nt">&gt;</span>SCOPE<span class="nt">&lt;/shibmd:Scope&gt;</span>
        <span class="nt">&lt;/Extensions&gt;</span>
        <span class="nt">&lt;KeyDescriptor</span> <span class="na">use=</span><span class="s">"signing"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;ds:KeyInfo&gt;</span>
              <span class="nt">&lt;ds:X509Data&gt;</span>
                  <span class="nt">&lt;ds:X509Certificate&gt;</span>...<span class="nt">&lt;/ds:X509Certificate&gt;</span>
              <span class="nt">&lt;/ds:X509Data&gt;</span>
            <span class="nt">&lt;/ds:KeyInfo&gt;</span>
        <span class="nt">&lt;/KeyDescriptor&gt;</span>
        <span class="nt">&lt;KeyDescriptor</span> <span class="na">use=</span><span class="s">"encryption"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;ds:KeyInfo&gt;</span>
              <span class="nt">&lt;ds:X509Data&gt;</span>
                  <span class="nt">&lt;ds:X509Certificate&gt;</span>...<span class="nt">&lt;/ds:X509Certificate&gt;</span>
              <span class="nt">&lt;/ds:X509Data&gt;</span>
            <span class="nt">&lt;/ds:KeyInfo&gt;</span>
        <span class="nt">&lt;/KeyDescriptor&gt;</span>

        <span class="nt">&lt;NameIDFormat&gt;</span>urn:mace:shibboleth:1.0:nameIdentifier<span class="nt">&lt;/NameIDFormat&gt;</span>
        <span class="nt">&lt;NameIDFormat&gt;</span>urn:oasis:names:tc:SAML:2.0:nameid-format:transient<span class="nt">&lt;/NameIDFormat&gt;</span>

        <span class="nt">&lt;SingleLogoutService</span> <span class="na">Binding=</span><span class="s">"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST"</span>
                             <span class="na">Location=</span><span class="s">"https://HOST_NAME/cas/idp/profile/SAML2/POST/SLO"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;SingleSignOnService</span> <span class="na">Binding=</span><span class="s">"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST"</span>
                             <span class="na">Location=</span><span class="s">"https://HOST_NAME/cas/idp/profile/SAML2/POST/SSO"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;SingleSignOnService</span> <span class="na">Binding=</span><span class="s">"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect"</span>
                             <span class="na">Location=</span><span class="s">"https://HOST_NAME/cas/idp/profile/SAML2/Redirect/SSO"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/IDPSSODescriptor&gt;</span>
<span class="nt">&lt;/EntityDescriptor&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>SAML2 identity provider metadata can be managed in dynamics ways as well. To learn more, please <a href="Configuring-SAML2-DynamicMetadata.html">review this guide</a>.</p>

<h3 id="per-service">Per Service</h3>

<p>Identity provider metadata, certificates and keys can also be defined on a per-service basis to override the global defaults.
Metadata artifacts that would be applicable to a specific service definition and managed via the file system need to be stored
in a directory location named after the service definition’s name and numeric identifier inside the canonical metadata directory. For example,
if global metadata artifacts are managed on disk at <code class="language-plaintext highlighter-rouge">/etc/cas/config/saml/metadata</code>, then metadata applicable to a service definition
whose name is configured as <code class="language-plaintext highlighter-rouge">SampleService</code> with an id of <code class="language-plaintext highlighter-rouge">1000</code> are expected to be found at <code class="language-plaintext highlighter-rouge">/etc/cas/config/saml/metadata/SampleService-1000</code>.</p>

<p>SAML2 identity provider metadata can be managed in dynamics ways as well. To learn more, please <a href="Configuring-SAML2-DynamicMetadata.html">review this guide</a>.</p>

<h2 id="configuration">Configuration</h2>

<p>Support is enabled by including the following dependency in the WAR overlay:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.apereo.cas<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>cas-server-support-saml-idp<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>${cas.version}<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>You may also need to declare the following repository in
your CAS overlay to be able to resolve dependencies:</p>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="n">repositories</span> <span class="o">{</span>
    <span class="n">maven</span> <span class="o">{</span> 
        <span class="n">mavenContent</span> <span class="o">{</span> <span class="n">releasesOnly</span><span class="o">()</span> <span class="o">}</span>
        <span class="n">url</span> <span class="s2">"https://build.shibboleth.net/nexus/content/repositories/releases"</span> 
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>To see the relevant list of CAS properties, please <a href="../configuration/Configuration-Properties.html#saml-idp">review this guide</a>.</p>

<h3 id="administrative-endpoints">Administrative Endpoints</h3>

<p>The following endpoints are provided by CAS:</p>

<table>
  <thead>
    <tr>
      <th>Endpoint</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">samlPostProfileResponse</code></td>
      <td>Obtain a SAML2 response payload by supplying a <code class="language-plaintext highlighter-rouge">username</code>, <code class="language-plaintext highlighter-rouge">password</code>, <code class="language-plaintext highlighter-rouge">entityId</code> and <code class="language-plaintext highlighter-rouge">encrypt</code> as parameters.</td>
    </tr>
  </tbody>
</table>

<h3 id="saml-services">SAML Services</h3>

<p>SAML relying parties and services must be registered within the CAS service registry similar to the following example:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.support.saml.services.SamlRegisteredService"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"serviceId"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"the-entity-id-of-the-sp"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"SAMLService"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10000003</span><span class="p">,</span><span class="w">
  </span><span class="nl">"evaluationOrder"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
  </span><span class="nl">"metadataLocation"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://url/to/metadata.xml"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>The following fields are available for SAML services:</p>

<table>
  <thead>
    <tr>
      <th>Field</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">metadataLocation</code></td>
      <td>Location of service metadata defined from system files, classpath, directories or URL resources.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">metadataProxyLocation</code></td>
      <td>Proxy endpoint (<code class="language-plaintext highlighter-rouge">https://proxy-address:8901</code>) to fetch service metadata from URL resources.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">metadataSignatureLocation</code></td>
      <td>Location of the metadata signing certificate/public key to validate the metadata which must be defined from system files or classpath. If defined, will enforce the <code class="language-plaintext highlighter-rouge">SignatureValidationFilter</code> validation filter on metadata.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">metadataExpirationDuration</code></td>
      <td>If defined, will expire metadata in the cache after the indicated duration which will force CAS to retrieve and resolve the metadata again.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">requireSignedRoot</code></td>
      <td>Whether incoming metadata’s root element is required to be signed. Default is <code class="language-plaintext highlighter-rouge">true</code>.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">signUnsolicitedAuthnRequest</code></td>
      <td>When dealing with Unsolicited SSO, determine whether the authentication request should be forcefully signed.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">signAssertions</code></td>
      <td>Whether assertions should be signed. Default is <code class="language-plaintext highlighter-rouge">false</code>.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">signResponses</code></td>
      <td>Whether responses should be signed. Default is <code class="language-plaintext highlighter-rouge">true</code>.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">encryptionOptional</code></td>
      <td>Encrypt whenever possible (i.e a compatible key is found in the peer’s metadata) or skip encryption otherwise. Default is <code class="language-plaintext highlighter-rouge">false</code>.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">encryptAssertions</code></td>
      <td>Whether assertions should be encrypted. Default is <code class="language-plaintext highlighter-rouge">false</code>.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">encryptAttributes</code></td>
      <td>Whether assertion attributes should be encrypted. Default is <code class="language-plaintext highlighter-rouge">false</code>.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">encryptableAttributes</code></td>
      <td>Set of attributes nominated for encryption, disqualifying others absent in this collection. Default (i.e. <code class="language-plaintext highlighter-rouge">*</code>) is to encrypt all once <code class="language-plaintext highlighter-rouge">encryptAttributes</code> is true.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">requiredAuthenticationContextClass</code></td>
      <td>If defined, will specify the SAML authentication context class in the final response. If undefined, the authentication class will either be <code class="language-plaintext highlighter-rouge">urn:oasis:names:tc:SAML:2.0:ac:classes:unspecified</code> or <code class="language-plaintext highlighter-rouge">urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport</code> depending on the SAML authentication request.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">requiredNameIdFormat</code></td>
      <td>If defined, will force the indicated Name ID format in the final SAML response.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">skewAllowance</code></td>
      <td>If defined, indicates number of seconds used to skew authentication dates such as valid-from and valid-until elements, etc.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">metadataCriteriaPattern</code></td>
      <td>If defined, will force an entity id filter on the metadata aggregate based on the <code class="language-plaintext highlighter-rouge">PredicateFilter</code> to include/exclude specific entity ids based on a valid regex pattern.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">metadataCriteriaDirection</code></td>
      <td>If defined, will force an entity id filter on the metadata aggregate based on <code class="language-plaintext highlighter-rouge">PredicateFilter</code>. Allowed values are <code class="language-plaintext highlighter-rouge">INCLUDE</code>,<code class="language-plaintext highlighter-rouge">EXCLUDE</code>.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">metadataCriteriaRoles</code></td>
      <td>If defined, will allow the defined metadata roles (i.e. <code class="language-plaintext highlighter-rouge">SPSSODescriptor</code>, <code class="language-plaintext highlighter-rouge">IDPSSODescriptor</code>). Default is <code class="language-plaintext highlighter-rouge">SPSSODescriptor</code>.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">metadataCriteriaRemoveEmptyEntitiesDescriptors</code></td>
      <td>Controls whether to keep entities descriptors that contain no entity descriptors. Default is <code class="language-plaintext highlighter-rouge">true</code>.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">metadataCriteriaRemoveRolelessEntityDescriptors</code></td>
      <td>Controls whether to keep entity descriptors that contain no roles. Default is <code class="language-plaintext highlighter-rouge">true</code>.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">attributeNameFormats</code></td>
      <td>Map that defines attribute name formats for a given attribute name to be encoded in the SAML response.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">attributeFriendlyNames</code></td>
      <td>Map that defines attribute friendly names for a given attribute name to be encoded in the SAML response.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">attributeValueTypes</code></td>
      <td>Map that defines the type of attribute values for a given attribute name.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">nameIdQualifier</code></td>
      <td>If defined, will overwrite the <code class="language-plaintext highlighter-rouge">NameQualifier</code> attribute of the produced subject’s name id.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">logoutResponseBinding</code></td>
      <td>If defined, will overwrite the binding used to prepare logout responses for the service provider.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">issuerEntityId</code></td>
      <td>If defined, will override the issue value with the given identity provider entity id. This may be useful in cases where CAS needs to maintain multiple identity provider entity ids.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">assertionAudiences</code></td>
      <td>Comma-separated list of audience urls to include in the assertion, in the addition to the entity id.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">serviceProviderNameIdQualifier</code></td>
      <td>If defined, will overwrite the <code class="language-plaintext highlighter-rouge">SPNameQualifier</code> attribute of the produced subject’s name id.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">skipGeneratingAssertionNameId</code></td>
      <td>Whether generation of a name identifier should be skipped for assertions. Default is <code class="language-plaintext highlighter-rouge">false</code>.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">skipGeneratingTransientNameId</code></td>
      <td>Whether transient name identifier generation should be skipped. Default is <code class="language-plaintext highlighter-rouge">false</code>.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">skipGeneratingSubjectConfirmationInResponseTo</code></td>
      <td>Whether generation of the <code class="language-plaintext highlighter-rouge">InResponseTo</code> element should be skipped for subject confirmations. Default is <code class="language-plaintext highlighter-rouge">false</code>.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">skipGeneratingSubjectConfirmationNotOnOrAfter</code></td>
      <td>Whether generation of the <code class="language-plaintext highlighter-rouge">NotOnOrBefore</code> element should be skipped for subject confirmations. Default is <code class="language-plaintext highlighter-rouge">false</code>.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">skipGeneratingSubjectConfirmationRecipient</code></td>
      <td>Whether generation of the <code class="language-plaintext highlighter-rouge">Recipient</code> element should be skipped for subject confirmations. Default is <code class="language-plaintext highlighter-rouge">false</code>.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">skipGeneratingSubjectConfirmationNotBefore</code></td>
      <td>Whether generation of the <code class="language-plaintext highlighter-rouge">NotBefore</code> element should be skipped for subject confirmations. Default is <code class="language-plaintext highlighter-rouge">true</code>.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">skipGeneratingSubjectConfirmationNameId</code></td>
      <td>Whether generation of the <code class="language-plaintext highlighter-rouge">NameID</code> element should be skipped for subject confirmations. Default is <code class="language-plaintext highlighter-rouge">true</code>.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">signingCredentialFingerprint</code></td>
      <td><code class="language-plaintext highlighter-rouge">SHA-1</code> digest of the signing credential’s public key, parsed as a regular expression, used for the purposes of key rotation when dealing with multiple credentials.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">signingCredentialType</code></td>
      <td>Acceptable values are <code class="language-plaintext highlighter-rouge">BASIC</code> and <code class="language-plaintext highlighter-rouge">X509</code>. This setting controls the type of the signature block produced in the final SAML response for this application. The latter, being the default, encodes the signature in <code class="language-plaintext highlighter-rouge">PEM</code> format inside a <code class="language-plaintext highlighter-rouge">X509Data</code> block while the former encodes the signature based on the resolved public key under a <code class="language-plaintext highlighter-rouge">DEREncodedKeyValue</code> block.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">signingSignatureReferenceDigestMethods</code></td>
      <td>Collection of signing signature reference digest methods, if any, to override the global defaults.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">signingKeyAlgorithm</code></td>
      <td>Signing key algorithm to forcibly use for signing operations when loading the private key. Default is <code class="language-plaintext highlighter-rouge">RSA</code>.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">signingSignatureAlgorithms</code></td>
      <td>Collection of signing signature algorithms, if any, to override the global defaults.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">signingSignatureBlackListedAlgorithms</code></td>
      <td>Collection of rejected signing signature algorithms, if any, to override the global defaults.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">signingSignatureWhiteListedAlgorithms</code></td>
      <td>Collection of allowed signing signature algorithms, if any, to override the global defaults.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">signingSignatureCanonicalizationAlgorithm</code></td>
      <td>The signing signature canonicalization algorithm, if any, to override the global defaults.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">encryptionDataAlgorithms</code></td>
      <td>Collection of encryption data algorithms, if any, to override the global defaults.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">encryptionKeyAlgorithms</code></td>
      <td>Collection of encryption key transport algorithms, if any, to override the global defaults.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">encryptionBlackListedAlgorithms</code></td>
      <td>Collection of rejected encryption algorithms, if any, to override the global defaults.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">encryptionWhiteListedAlgorithms</code></td>
      <td>Collection of allowed encryption algorithms, if any, to override the global defaults.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">whiteListBlackListPrecedence</code></td>
      <td>Preference value indicating which should take precedence when both whitelist and blacklist are non-empty. Accepted values are <code class="language-plaintext highlighter-rouge">WHITELIST</code> or <code class="language-plaintext highlighter-rouge">BLACKLIST</code>. Default is <code class="language-plaintext highlighter-rouge">WHITELIST</code>.</td>
    </tr>
  </tbody>
</table>

<div class="alert alert-info"><strong>Keep What You Need!</strong><p>You are encouraged to only keep and maintain properties and settings needed for a 
particular integration. It is UNNECESSARY to grab a copy of all service fields and try to configure them yet again based on their default. While 
you may wish to keep a copy as a reference, this strategy would ultimately lead to poor upgrades increasing chances of breaking changes and a messy 
deployment at that.</p></div>

<h3 id="metadata-aggregates">Metadata Aggregates</h3>

<p>CAS services are fundamentally recognized and loaded by service identifiers taught to CAS typically via
regular expressions. This allows for common groupings of applications and services by
url patterns (i.e. “Everything that belongs to <code class="language-plaintext highlighter-rouge">example.org</code> is registered with CAS).
With aggregated metadata, CAS essentially does double
authorization checks because it will first attempt to find the entity id
in its collection of resolved metadata components and then it looks to
see if that entity id is authorized via the pattern that is assigned to
that service definition. This means you can do one of several things:</p>

<ol>
  <li>Open up the pattern to allow everything that is authorized in the metadata.</li>
  <li>Restrict the pattern to only a select few entity ids found in the
metadata. This is essentially the same thing as defining metadata criteria
to filter down the list of resolved relying parties and entity ids except that its done
after the fact once the metadata is fully loaded and parsed.</li>
  <li>You can also instruct CAS to filter metadata
entities by a defined criteria at resolution time when it reads the
metadata itself. This is essentially the same thing as forcing the pattern
to match entity ids, except that it’s done while CAS is reading the
metadata and thus load times are improved.</li>
</ol>

<h3 id="metadata-resolution">Metadata Resolution</h3>

<p>Service provider metadata is fetched and loaded on demand for every service and then cached in a global cache for a 
configurable duration. Subsequent requests for service metadata will always consult the cache first and if missed, 
will resort to actually resolving the metadata by loading or contacting the configured resource. 
Each service provider definition that is registered with CAS may optionally also specifically an expiration period of 
metadata resolution to override the default global value.</p>

<h4 id="dynamic-metadata-resolution">Dynamic Metadata Resolution</h4>

<p>In addition to the more traditional means of managing service provider metadata such as direct XML files or URLs, CAS 
provides support for a number of other strategies to fetch metadata more dynamically with the likes of MDQ and more.
To learn more, please <a href="Configuring-SAML2-DynamicMetadata.html">review this guide</a>.</p>

<h3 id="security-configuration">Security Configuration</h3>

<p>There are several levels of configuration that control the security configuration of objects that are signed, encrypted, etc. These configurations include things 
like the keys to use, preferred/default algorithms, and algorithms to allow, enforce or reject.</p>

<p>The configurations are generally determined based on the following order:</p>

<ul>
  <li>Service provider metadata</li>
  <li>Per-service configuration overrides</li>
  <li>Global CAS default settings</li>
  <li>OpenSAML initial defaults</li>
</ul>

<p>In almost all cases, you should leave the defaults in place.</p>

<p>To see the relevant list of CAS properties, please <a href="../configuration/Configuration-Properties.html#saml-algorithms--security">review this guide</a>.</p>

<h4 id="encryption">Encryption</h4>

<p>The following examples demonstrate encryption security configuration overrides per service provider.</p>

<h4 id="cbc">CBC</h4>

<p>The following example demonstrates how to configure CAS to use <code class="language-plaintext highlighter-rouge">CBC</code> encryption for a particular service provider:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"@class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.support.saml.services.SamlRegisteredService"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"serviceId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sp.example.org"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SAML"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="nl">"metadataLocation"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/path/to/sp-metadata.xml"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"encryptionDataAlgorithms"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"java.util.ArrayList"</span><span class="p">,</span><span class="w">
    </span><span class="p">[</span><span class="w">
      </span><span class="s2">"http://www.w3.org/2001/04/xmlenc#aes128-cbc"</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"encryptionKeyAlgorithms"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"java.util.ArrayList"</span><span class="p">,</span><span class="w">
    </span><span class="p">[</span><span class="w">
      </span><span class="s2">"http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p"</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="gcm">GCM</h4>

<p>The following example demonstrates how to configure CAS to use <code class="language-plaintext highlighter-rouge">GCM</code> encryption for a particular service provider:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"@class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.support.saml.services.SamlRegisteredService"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"serviceId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sp.example.org"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SAML"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="nl">"metadataLocation"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/path/to/sp-metadata.xml"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"encryptionDataAlgorithms"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"java.util.ArrayList"</span><span class="p">,</span><span class="w">
    </span><span class="p">[</span><span class="w">
      </span><span class="s2">"http://www.w3.org/2009/xmlenc11#aes128-gcm"</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"encryptionKeyAlgorithms"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"java.util.ArrayList"</span><span class="p">,</span><span class="w">
    </span><span class="p">[</span><span class="w">
      </span><span class="s2">"http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p"</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="signing">Signing</h4>

<p>The following examples demonstrate signing security configuration overrides per service provider.</p>

<h5 id="sha-1">SHA-1</h5>

<p>The following example demonstrates how to configure CAS to use <code class="language-plaintext highlighter-rouge">SHA-1</code> signing and digest algorithms for a particular service provider:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"@class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.support.saml.services.SamlRegisteredService"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"serviceId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sp.example.org"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SAML"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="nl">"metadataLocation"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/path/to/sp-metadata.xml"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"signingSignatureAlgorithms"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"java.util.ArrayList"</span><span class="p">,</span><span class="w">
    </span><span class="p">[</span><span class="w">
      </span><span class="s2">"http://www.w3.org/2000/09/xmldsig#rsa-sha1"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"http://www.w3.org/2001/04/xmldsig-more#ecdsa-sha1"</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"signingSignatureReferenceDigestMethods"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"java.util.ArrayList"</span><span class="p">,</span><span class="w">
    </span><span class="p">[</span><span class="w">
      </span><span class="s2">"http://www.w3.org/2000/09/xmldsig#sha1"</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h5 id="sha-256">SHA-256</h5>

<p>The following example demonstrates how to configure CAS to use <code class="language-plaintext highlighter-rouge">SHA-256</code> signing and digest algorithms for a particular service provider:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"@class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.support.saml.services.SamlRegisteredService"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"serviceId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sp.example.org"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SAML"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="nl">"metadataLocation"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/path/to/sp-metadata.xml"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"signingSignatureAlgorithms"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"java.util.ArrayList"</span><span class="p">,</span><span class="w">
    </span><span class="p">[</span><span class="w">
      </span><span class="s2">"http://www.w3.org/2001/04/xmldsig-more#rsa-sha256"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"http://www.w3.org/2001/04/xmldsig-more#ecdsa-sha256"</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"signingSignatureReferenceDigestMethods"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"java.util.ArrayList"</span><span class="p">,</span><span class="w">
    </span><span class="p">[</span><span class="w">
      </span><span class="s2">"http://www.w3.org/2001/04/xmlenc#sha256"</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="attribute-release">Attribute Release</h3>

<p>Attribute filtering and release policies are defined per SAML service. See <a href="Configuring-SAML2-Attribute-Release.html">this guide</a> for more info.</p>

<h3 id="name-id-selection">Name ID Selection</h3>

<p>Each service may specify a required Name ID format. If left undefined, the metadata will be consulted to find the right format.
The Name ID value is always the authenticated user that is designed to be returned to this service. In other words, if you
decide to configure CAS to return a particular attribute as
<a href="../integration/Attribute-Release-PrincipalId.html">the authenticated user name for this service</a>,
that value will then be used to construct the Name ID along with the right format.</p>

<h4 id="examples">Examples</h4>

<p>The following service definition instructs CAS to use the <code class="language-plaintext highlighter-rouge">urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress</code> as the final Name ID format,
and use the <code class="language-plaintext highlighter-rouge">mail</code> attribute value as the final Name ID value.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"@class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.support.saml.services.SamlRegisteredService"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"serviceId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"the-entity-id-of-the-sp"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SAML Service"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"metadataLocation"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/path/to/sp-metadata.xml"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="nl">"requiredNameIdFormat"</span><span class="p">:</span><span class="w"> </span><span class="s2">"urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"usernameAttributeProvider"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.services.PrincipalAttributeRegisteredServiceUsernameProvider"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"usernameAttribute"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"mail"</span><span class="p">,</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>The following service definition instructs CAS to use the <code class="language-plaintext highlighter-rouge">urn:oasis:names:tc:SAML:2.0:nameid-format:transient</code> as the final Name ID format,
and use the <code class="language-plaintext highlighter-rouge">cn</code> attribute value in upper-case as the final Name ID value, skipping the generation of transient value per the required format.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"@class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.support.saml.services.SamlRegisteredService"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"serviceId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"the-entity-id-of-the-sp"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SAML Service"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"metadataLocation"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/path/to/sp-metadata.xml"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="nl">"requiredNameIdFormat"</span><span class="p">:</span><span class="w"> </span><span class="s2">"urn:oasis:names:tc:SAML:2.0:nameid-format:transient"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"skipGeneratingTransientNameId"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nl">"usernameAttributeProvider"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.services.PrincipalAttributeRegisteredServiceUsernameProvider"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"usernameAttribute"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"cn"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"canonicalizationMode"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"UPPER"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>The following service definition instructs CAS to use the <code class="language-plaintext highlighter-rouge">cn</code> attribute value to create a persistent Name ID.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"@class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.support.saml.services.SamlRegisteredService"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"serviceId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"the-entity-id-of-the-sp"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SAML Service"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"metadataLocation"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/path/to/sp-metadata.xml"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="nl">"requiredNameIdFormat"</span><span class="p">:</span><span class="w"> </span><span class="s2">"urn:oasis:names:tc:SAML:2.0:nameid-format:persistent"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"usernameAttributeProvider"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.services.AnonymousRegisteredServiceUsernameAttributeProvider"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"persistentIdGenerator"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.authentication.principal.ShibbolethCompatiblePersistentIdGenerator"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"salt"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"aGVsbG93b3JsZA=="</span><span class="p">,</span><span class="w">
      </span><span class="nl">"attribute"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cn"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="unsolicited-sso">Unsolicited SSO</h2>

<p>SAML2 IdP <code class="language-plaintext highlighter-rouge">Unsolicited/SSO</code> profile supports the following parameters:</p>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">providerId</code></td>
      <td>Required. Entity ID of the service provider.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">shire</code></td>
      <td>Optional. Response location (ACS URL) of the service provider.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">target</code></td>
      <td>Optional. Relay state.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">time</code></td>
      <td>Optional. Skew the authentication request.</td>
    </tr>
  </tbody>
</table>

<h2 id="attribute-queries">Attribute Queries</h2>

<p>In order to allow CAS to support and respond to attribute queries, you need to make sure the generated metadata has
the <code class="language-plaintext highlighter-rouge">AttributeAuthorityDescriptor</code> element enabled, with protocol support enabled for <code class="language-plaintext highlighter-rouge">urn:oasis:names:tc:SAML:2.0:protocol</code>
and relevant binding that corresponds to the CAS endpoint(s). You also must ensure the <code class="language-plaintext highlighter-rouge">AttributeAuthorityDescriptor</code> tag lists all
<code class="language-plaintext highlighter-rouge">KeyDescriptor</code> elements and certificates that are used for signing as well as authentication, specially if the SOAP client of the service provider 
needs to cross-compare the certificate behind the CAS endpoint with what is defined for the <code class="language-plaintext highlighter-rouge">AttributeAuthorityDescriptor</code>. CAS by default 
will always use its own signing certificate for signing of the responses generated as a result of an attribute query.</p>

<p>Also note that support for attribute queries need to be explicitly enabled and the behavior is off by default, given it imposes a burden on 
CAS and the underlying ticket registry to keep track of attributes and responses as tickets and have them be later used and looked up.</p>

<p>To see the relevant list of CAS properties, please <a href="../configuration/Configuration-Properties.html#saml-idp">review this guide</a>.</p>

<h2 id="service-provider-integrations">Service Provider Integrations</h2>

<p>A number of SAML2 service provider integrations are provided natively by CAS. To learn more,
please <a href="../integration/Configuring-SAML-SP-Integrations.html">review this guide</a>.</p>

<h2 id="service-provider-metadata">Service Provider Metadata</h2>

<p>If the SP you wish to integrate with does not produce SAML metadata, you may be able to
use <a href="https://www.samltool.com/sp_metadata.php">this service</a> to create the metadata,
save it in an XML file and then reference and register it with CAS for the SP.</p>

<p>Alternatively, you may take advantage of a standalone <code class="language-plaintext highlighter-rouge">saml-sp-metadata.json</code> file that may be found in the same directory
as the CAS metadata artifacts. The contents of this file may be as follows:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"https://example.org/saml"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"entityId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.org/saml"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"certificate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MIIDUj..."</span><span class="p">,</span><span class="w">
    </span><span class="nl">"assertionConsumerServiceUrl"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.org/sso/"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>Each entry in the file is identified by the service provider entity id, allowing CAS to dynamically locate and build the required metadata on the fly
to resume the authentication flow. This may prove easier for those service providers that only present a URL and a signing certificate for the
integration relieving you from creating and managing XML metadata files separately.</p>

<p>The service providers are registered with the CAS service registry as such:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.support.saml.services.SamlRegisteredService"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"serviceId"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.org/saml"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"SAMLService"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10000003</span><span class="p">,</span><span class="w">
  </span><span class="nl">"metadataLocation"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"json://"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<div class="alert alert-info"><strong>Metadata Location</strong><p>The metadata location in the registration record above needs to be specified as <code>json://</code> to signal to CAS that SAML metadata for registered service provider must be fetched from the designated JSON file.</p></div>

<h2 id="client-libraries">Client Libraries</h2>

<p>For Java-based applications, the following frameworks may be used to integrate your application with CAS acting as a SAML2 identity provider:</p>

<ul>
  <li><a href="http://projects.spring.io/spring-security-saml/">Spring Security SAML</a></li>
  <li><a href="http://www.pac4j.org/docs/clients/saml.html">Pac4j</a></li>
</ul>

<h2 id="sample-client-applications">Sample Client Applications</h2>

<ul>
  <li><a href="https://github.com/cas-projects/saml2-sample-java-webapp">Spring Security SAML Sample Webapp</a></li>
  <li><a href="https://developer.okta.com/standards/SAML/setting_up_a_saml_application_in_okta">Okta</a></li>
</ul>

<h2 id="troubleshooting">Troubleshooting</h2>

<p>To enable additional logging, modify the logging configuration file to add the following:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;Logger</span> <span class="na">name=</span><span class="s">"org.opensaml"</span> <span class="na">level=</span><span class="s">"debug"</span> <span class="na">additivity=</span><span class="s">"false"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;AppenderRef</span> <span class="na">ref=</span><span class="s">"console"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;AppenderRef</span> <span class="na">ref=</span><span class="s">"file"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/Logger&gt;</span>
<span class="nt">&lt;Logger</span> <span class="na">name=</span><span class="s">"PROTOCOL_MESSAGE"</span> <span class="na">level=</span><span class="s">"debug"</span> <span class="na">additivity=</span><span class="s">"false"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;AppenderRef</span> <span class="na">ref=</span><span class="s">"console"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;AppenderRef</span> <span class="na">ref=</span><span class="s">"file"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/Logger&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

                </div>
            </section>
        </main>
    </div>
</div>


<footer>
    <div class="container">
        CAS is supported by the <a href="https://www.apereo.org/">Apereo Foundation</a>.
    </div>
</footer>

<script>
    let pageSection = 'Protocols';
</script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.3.2/js/tether.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js"></script>

<script src="../../javascripts/URI.js"></script>
<script src="../../javascripts/main.js"></script>

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script>
<script type="text/javascript" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
</body>

</html>
