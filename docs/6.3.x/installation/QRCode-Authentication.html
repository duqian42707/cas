<!DOCTYPE html>
<html>

<head>
    <!-- Required meta tags always come first -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="CAS - Enterprise Single Sign-On for the Web"/>
    <meta name="keywords" content="authentication, login, cas, central authentication service, web, java, protocol, thymeleaf,
                   open source, boot, spring, authorization, google, facebook, twitter, higher-ed, enterprise,
                   access management, single signon, sso, RBAC, ABAC, attributes, SAML, OpenID, openid connect,
                   JWT, ADFS"/>
    <meta name="robots" content="index,follow"/>

    
    

        
    


    

    <script>
        ((i, s, o, g, r, a, m) => {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-83384532-2', 'auto');
        ga('send', 'pageview');

    </script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3"/>

    <link rel="stylesheet" type="text/css" media="screen" href="../../stylesheets/stylesheet.css">
    <link rel="stylesheet" type="text/css" media="print" href="../../stylesheets/print.css">

    <link href='https://fonts.googleapis.com/css?family=Lato:400,300,700' rel='stylesheet'>
    <link href='https://fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic&subset=latin-ext,latin' rel='stylesheet'>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@100;200;300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css" rel="stylesheet">

    <title>CAS - QR Code Authentication</title>

</head>

<body>
<!-- HEADER -->
<header class="hidden-sm-down">
    <div class="container">
        <div class="row">
            <div class="col-xs-4 col-md-2">
                <a href="../../index.html">
                    <img class="undecorated" src="../../images/cas_logo.png"/>
                </a>
            </div>
            <div class="col-xs-8 col-md-6">
                <h1>Enterprise Single Sign-On for All</h1>
            </div>
            <div class="hidden-sm-down col-md-4">
                <a id="forkme_banner" href="https://github.com/apereo/cas">View on GitHub</a>
            </div>

        </div>
    </div>
</header>

<!-- NAVBAR -->

<nav class="navbar navbar-expand-md navbar-dark bg-primary bg-dark">
    <div class="container">
        <button class="navbar-toggler collapsed" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarsExample04" aria-controls="navbarsExample04" aria-expanded="false"
                aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="navbar-collapse collapse" id="navbarsExample04">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active"><a href="../../index.html" class="zoom nav-link">Home</a></li>
                <li class="nav-item"><a href="https://github.com/apereo/cas/releases" class="zoom nav-link">Releases</a></li>
                <li class="nav-item"><a href="../../Support.html" class="zoom nav-link">Support</a></li>
                <li class="nav-item"><a href="../../Mailing-Lists.html" class="zoom nav-link">Mailing Lists</a></li>
                <li class="nav-item">
                    <a class="zoom nav-link" href="../../Demos.html">Demos</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="zoom nav-link dropdown-toggle mr-md-2" href="#" id="cas-versions" data-bs-toggle="dropdown"
                       aria-haspopup="true" aria-expanded="false">Versions</a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="cas-versions">
                        
                        
                        <a class="dropdown-item" href="/cas/development/">Development</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.6.x/">v6.6.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.5.x/">v6.5.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.4.x/">v6.4.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.3.x/">v6.3.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.2.x/">v6.2.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.1.x/">v6.1.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.0.x/">v6.0.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.3.x/">v5.3.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.2.x/">v5.2.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.1.x/">v5.1.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.0.x/">v5.0.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/4.2.x/">v4.2.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/4.1.x/">v4.1.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/4.0.x/">v4.0.x</a>
                        
                        

                    </div>
                </li>
                <li class="nav-item"><a href="https://apereo.github.io" target="_blank" class="zoom nav-link">Blog</a></li>
            </ul>

        </div>

    </div>
</nav>


<div class="container-fluid">
    <div class="row flex-xl-nowrap">
        <div class="col-12 col-md-3 col-xl-2 docs-sidebar pb-5" id="sidebar"></div>


        <div class="d-none d-xl-block col-xl-2 docs-toc">
    <div id="pageContents">
        <ul class="section-nav"></ul>
    </div>
</div>


        <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 cas-docs-content" role="main">


            

            <section>
                <nav id="docsNavBar">
                    <span id="toolbarIcons"></span>
                </nav>

                <div id="cas-docs-container">
                    <h1 id="qr-code-authentication">QR Code Authentication</h1>

<p>QR Code authentication is a strategy that allows the user to scan a QR code, generated by the
CAS server, using a mobile device and subsequently login after having successfully validated it.</p>

<p>The QR code contains a special identifier embedded within that allows the mobile device to establish a communication
channel using web sockets to the CAS server. Once established, the mobile device may collect credentials from the user
and submit those to CAS for verification. The return result, expected as a <code class="language-plaintext highlighter-rouge">JWT</code> that is generated by CAS,
is then passed along to the web socket channel for verification and successful login. Subsequent login attempts can allow
for a completely <em>passwordless</em> scenario such that the mobile device can continue to re-use the JWT
for authentication attempts, allowing the end user to <em>scan and proceed</em>.</p>

<p>Support is enabled by including the following dependency in the WAR overlay:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.apereo.cas<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>cas-server-support-qrlogin<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>${cas.version}<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="administrative-endpoints">Administrative Endpoints</h2>

<p>The following endpoints are provided by CAS:</p>

<table>
  <thead>
    <tr>
      <th>Endpoint</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">qrDevices/{username}</code></td>
      <td><code class="language-plaintext highlighter-rouge">GET</code> request to fetch device for the user.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">qrDevices/{username}/{device}</code></td>
      <td><code class="language-plaintext highlighter-rouge">POST</code> request to register a device with CAS.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">qrDevices/{username}/{device}</code></td>
      <td><code class="language-plaintext highlighter-rouge">DELETE</code> request to delete a device for the user.</td>
    </tr>
  </tbody>
</table>

<h2 id="configuration">Configuration</h2>

<p>To see the relevant list of CAS 
properties, please <a href="../configuration/Configuration-Properties.html#qr-authentication">review this guide</a>.</p>

<h2 id="web-socket-communication">Web Socket Communication</h2>

<p>The process of connecting to a web socket connection certainly varies for each mobile app framework. At a high level, 
mobile devices should establish a web socket connection to the CAS server via the <code class="language-plaintext highlighter-rouge">/cas/qr-websocket</code> endpoint.
The payload must then be sent to the <code class="language-plaintext highlighter-rouge">/qr/accept</code> path as a map and must contain a <code class="language-plaintext highlighter-rouge">token</code> field that 
carries the pre-authenticated JWT. The payload header must point to the channel id obtained 
from the QR code under the header name <code class="language-plaintext highlighter-rouge">QR_AUTHENTICATION_CHANNEL_ID</code> as well 
as the authorized device identifier under <code class="language-plaintext highlighter-rouge">QR_AUTHENTICATION_DEVICE_ID</code>.</p>

<p>The following code snippet demonstrates this process as an example:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="kd">let</span> <span class="nx">socket</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SockJS</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://sso.example.org/cas/qr-websocket</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">stompClient</span> <span class="o">=</span> <span class="nx">Stomp</span><span class="p">.</span><span class="nx">over</span><span class="p">(</span><span class="nx">socket</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">payload</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="dl">'</span><span class="s1">token</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">...</span><span class="dl">'</span><span class="p">});</span>   
<span class="kd">let</span> <span class="nx">channelId</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">...</span><span class="dl">"</span><span class="p">;</span>      
<span class="kd">let</span> <span class="nx">deviceId</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">...</span><span class="dl">"</span><span class="p">;</span>
<span class="nx">stompClient</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="dl">"</span><span class="s2">/qr/accept</span><span class="dl">"</span><span class="p">,</span> 
    <span class="p">{</span><span class="dl">'</span><span class="s1">QR_AUTHENTICATION_CHANNEL_ID</span><span class="dl">'</span><span class="p">:</span> <span class="nx">channelId</span><span class="p">,</span> 
     <span class="dl">'</span><span class="s1">QR_AUTHENTICATION_DEVICE_ID</span><span class="dl">'</span><span class="p">:</span> <span class="nx">deviceId</span><span class="p">},</span> 
    <span class="nx">payload</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The following code snippet demonstrates this process for 
the Android platform based on <a href="https://github.com/NaikSoftware/StompProtocolAndroid">StompProtocolAndroid</a>:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">ua.naiksoftware.stomp.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">ua.naiksoftware.stomp.dto.*</span><span class="o">;</span>

<span class="nc">String</span> <span class="n">jwt</span> <span class="o">=</span> <span class="s">"..."</span><span class="o">;</span>
<span class="nc">JSONStringer</span> <span class="n">jsonWebToken</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">JSONStringer</span><span class="o">().</span><span class="na">object</span><span class="o">()</span>
  <span class="o">.</span><span class="na">key</span><span class="o">(</span><span class="s">"token"</span><span class="o">).</span><span class="na">value</span><span class="o">(</span><span class="n">jwt</span><span class="o">).</span><span class="na">endObject</span><span class="o">();</span>

<span class="nc">String</span> <span class="n">channel</span> <span class="o">=</span> <span class="s">"..."</span><span class="o">;</span>      
<span class="nc">String</span> <span class="n">deviceId</span> <span class="o">=</span> <span class="s">"..."</span><span class="o">;</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">StompHeader</span><span class="o">&gt;</span> <span class="n">headers</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
<span class="n">headers</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">StompHeader</span><span class="o">(</span><span class="s">"QR_AUTHENTICATION_CHANNEL_ID"</span><span class="o">,</span> <span class="n">channel</span><span class="o">));</span>
<span class="n">headers</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">StompHeader</span><span class="o">(</span><span class="s">"QR_AUTHENTICATION_DEVICE_ID"</span><span class="o">,</span> <span class="n">deviceId</span><span class="o">));</span>
<span class="n">headers</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">StompHeader</span><span class="o">(</span><span class="nc">StompHeader</span><span class="o">.</span><span class="na">DESTINATION</span><span class="o">,</span> <span class="s">"/qr/accept"</span><span class="o">));</span>

<span class="c1">// wss://10.0.2.2 for ssl and localhost</span>
<span class="nc">StompClient</span> <span class="n">client</span> <span class="o">=</span> <span class="nc">Stomp</span><span class="o">.</span><span class="na">over</span><span class="o">(</span><span class="nc">Stomp</span><span class="o">.</span><span class="na">ConnectionProvider</span><span class="o">.</span><span class="na">OKHTTP</span><span class="o">,</span> 
  <span class="s">"wss://10.0.2.2:8443/cas/qr-websocket/websocket"</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="n">httpClient</span><span class="o">);</span>

<span class="n">client</span><span class="o">.</span><span class="na">connect</span><span class="o">();</span>
<span class="nc">StompMessage</span> <span class="n">stompMessage</span> <span class="o">=</span> 
  <span class="k">new</span> <span class="nf">StompMessage</span><span class="o">(</span><span class="nc">StompCommand</span><span class="o">.</span><span class="na">SEND</span><span class="o">,</span> <span class="n">headers</span><span class="o">,</span> <span class="n">jsonWebToken</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
<span class="n">client</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">stompMessage</span><span class="o">).</span><span class="na">subscribe</span><span class="o">();</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="obtaining-jwt">Obtaining JWT</h2>

<p>The mobile device should ask for and then submit user credentials to the CAS 
server using the <a href="../protocol/REST-Protocol.html#jwt-ticket-granting-tickets">REST protocol</a> to 
obtain a JWT. The JWT request must also contain an additional request 
parameter <code class="language-plaintext highlighter-rouge">QR_AUTHENTICATION_DEVICE_ID</code> which indicates the authorized device identifier for the user.</p>

<p>Once the JWT is received, the device may cache the JWT and establish a <em>session</em> for code reuse later. 
The JWT should be sent to the CAS server’s web socket channel for validation and login as demonstrated above. The generated
JWT is automatically signed and encrypted by CAS and can only be decoded by the CAS server.</p>

<h2 id="web-socket-channel">Web Socket Channel</h2>

<p>The QR code contains a special identifier embedded within that allows the mobile device to establish 
a communication channel using web sockets to the CAS server. The mobile device must be able 
to scan the QR code  to extract the channel id in order to establish a 
communication route between CAS and the device.</p>

<h2 id="mobile-device-authorization">Mobile Device Authorization</h2>

<p>Registered devices are authorized and accepted by CAS using a dedicated QR device repository, that is able to 
track and link device identifiers to user ids. Such devices must be registered with CAS using an 
external registration mechanism or via available CAS-provided APIs.</p>

<p>By default, all devices can authenticate using the QR code. Different device repository
implementations can be supplied using one of the strategies outlined below.</p>

<h3 id="json">JSON</h3>

<p>Authorized devices can be managed and tracked inside a single JSON resource, whose path is taught to CAS via settings. To see the 
relevant list of CAS properties, please <a href="../configuration/Configuration-Properties.html#qr-authentication">review this guide</a>.</p>

<h3 id="custom">Custom</h3>

<p>Provide the appropriate bean implementation below to define a custom strategy for managing registered devices.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="nc">QRAuthenticationDeviceRepository</span> <span class="nf">qrAuthenticationDeviceRepository</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="o">...</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

                </div>
            </section>
        </main>
    </div>
</div>


<footer>
    <div class="container">
        CAS is supported by the <a href="https://www.apereo.org/">Apereo Foundation</a>.
    </div>
</footer>

<script>
    let pageSection = 'Authentication';
</script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.3.2/js/tether.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js"></script>

<script src="../../javascripts/URI.js"></script>
<script src="../../javascripts/main.js"></script>

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script>
<script type="text/javascript" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
</body>

</html>
