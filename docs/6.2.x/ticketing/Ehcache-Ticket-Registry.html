<!DOCTYPE html>
<html>

<head>
    <!-- Required meta tags always come first -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="CAS - Enterprise Single Sign-On for the Web"/>
    <meta name="keywords" content="authentication, login, cas, central authentication service, web, java, protocol, thymeleaf,
                   open source, boot, spring, authorization, google, facebook, twitter, higher-ed, enterprise,
                   access management, single signon, sso, RBAC, ABAC, attributes, SAML, OpenID, openid connect,
                   JWT, ADFS"/>
    <meta name="robots" content="index,follow"/>

    
    

        
    


    

    <script>
        ((i, s, o, g, r, a, m) => {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-83384532-2', 'auto');
        ga('send', 'pageview');

    </script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3"/>

    <link rel="stylesheet" type="text/css" media="screen" href="../../stylesheets/stylesheet.css">
    <link rel="stylesheet" type="text/css" media="print" href="../../stylesheets/print.css">

    <link href='https://fonts.googleapis.com/css?family=Lato:400,300,700' rel='stylesheet'>
    <link href='https://fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic&subset=latin-ext,latin' rel='stylesheet'>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@100;200;300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css" rel="stylesheet">

    <title>CAS - Ehcache Ticket Registry</title>

</head>

<body>
<!-- HEADER -->
<header class="hidden-sm-down">
    <div class="container">
        <div class="row">
            <div class="col-xs-4 col-md-2">
                <a href="../../index.html">
                    <img class="undecorated" src="../../images/cas_logo.png"/>
                </a>
            </div>
            <div class="col-xs-8 col-md-6">
                <h1>Enterprise Single Sign-On for All</h1>
            </div>
            <div class="hidden-sm-down col-md-4">
                <a id="forkme_banner" href="https://github.com/apereo/cas">View on GitHub</a>
            </div>

        </div>
    </div>
</header>

<!-- NAVBAR -->

<nav class="navbar navbar-expand-md navbar-dark bg-primary bg-dark">
    <div class="container">
        <button class="navbar-toggler collapsed" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarsExample04" aria-controls="navbarsExample04" aria-expanded="false"
                aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="navbar-collapse collapse" id="navbarsExample04">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active"><a href="../../index.html" class="zoom nav-link">Home</a></li>
                <li class="nav-item"><a href="https://github.com/apereo/cas/releases" class="zoom nav-link">Releases</a></li>
                <li class="nav-item"><a href="../../Support.html" class="zoom nav-link">Support</a></li>
                <li class="nav-item"><a href="../../Mailing-Lists.html" class="zoom nav-link">Mailing Lists</a></li>
                <li class="nav-item">
                    <a class="zoom nav-link" href="../../Demos.html">Demos</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="zoom nav-link dropdown-toggle mr-md-2" href="#" id="cas-versions" data-bs-toggle="dropdown"
                       aria-haspopup="true" aria-expanded="false">Versions</a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="cas-versions">
                        
                        
                        <a class="dropdown-item" href="/cas/development/">Development</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.6.x/">v6.6.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.5.x/">v6.5.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.4.x/">v6.4.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.3.x/">v6.3.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.2.x/">v6.2.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.1.x/">v6.1.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.0.x/">v6.0.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.3.x/">v5.3.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.2.x/">v5.2.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.1.x/">v5.1.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.0.x/">v5.0.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/4.2.x/">v4.2.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/4.1.x/">v4.1.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/4.0.x/">v4.0.x</a>
                        
                        

                    </div>
                </li>
                <li class="nav-item"><a href="https://apereo.github.io" target="_blank" class="zoom nav-link">Blog</a></li>
            </ul>

        </div>

    </div>
</nav>


<div class="container-fluid">
    <div class="row flex-xl-nowrap">
        <div class="col-12 col-md-3 col-xl-2 docs-sidebar pb-5" id="sidebar"></div>


        <div class="d-none d-xl-block col-xl-2 docs-toc">
    <div id="pageContents">
        <ul class="section-nav"></ul>
    </div>
</div>


        <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 cas-docs-content" role="main">


            

            <section>
                <nav id="docsNavBar">
                    <span id="toolbarIcons"></span>
                </nav>

                <div id="cas-docs-container">
                    <h1 id="ehcache-v3-ticket-registry">Ehcache v3 Ticket Registry</h1>

<p>Ehcache 3.x integration is enabled by including the following dependency in the WAR overlay:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;dependency&gt;</span>
     <span class="nt">&lt;groupId&gt;</span>org.apereo.cas<span class="nt">&lt;/groupId&gt;</span>
     <span class="nt">&lt;artifactId&gt;</span>cas-server-support-ehcache3-ticket-registry<span class="nt">&lt;/artifactId&gt;</span>
     <span class="nt">&lt;version&gt;</span>${cas.version}<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>This registry stores tickets using the <a href="http://ehcache.org/">Ehcache 3.x</a> caching library 
and <a href="https://www.ehcache.org/documentation/3.3/clustered-cache.html">an optional Terracotta cluster</a>.</p>

<h2 id="in-memory-store-with-disk-persistence">In-memory store with disk persistence</h2>

<p>Ehcache 3.x doesn’t support distributing caching without Terracotta so using it without pointing at a Terracotta 
server or cluster doesn’t support using more than one CAS server at a time. The location and size of the disk caches 
can be configured using the root-directory and per-cache-size-on-disk properties. If the persist-on-disk property
is set to true then the caches will survive a restart.</p>

<h3 id="terracotta-clustering">Terracotta Clustering</h3>

<p>By pointing this Ehcache module at a Terracotta server then multiple CAS servers can share tickets. CAS uses <code class="language-plaintext highlighter-rouge">autocreate</code> 
to create the Terracotta cluster configuration. An easy way to run a Terracotta server is to use the <a href="https://github.com/Terracotta-OSS/docker">docker container</a>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>docker run <span class="nt">--rm</span> <span class="nt">--name</span> tc-server <span class="nt">-p</span> 9410:9410 <span class="nt">-d</span> <span class="se">\</span>
 <span class="nt">--env</span> <span class="nv">OFFHEAP_RESOURCE1_NAME</span><span class="o">=</span>main <span class="se">\</span>
 <span class="nt">--env</span> <span class="nv">OFFHEAP_RESOURCE2_NAME</span><span class="o">=</span>extra <span class="se">\</span>
 <span class="nt">--env</span> <span class="nv">OFFHEAP_RESOURCE1_SIZE</span><span class="o">=</span>256 <span class="se">\</span>
 <span class="nt">--env</span> <span class="nv">OFFHEAP_RESOURCE2_SIZE</span><span class="o">=</span>16 <span class="se">\</span>
terracotta/terracotta-server-oss:5.6.4
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Running a Terracotta cluster on Kubernetes can be done easily using the Terracotta <a href="https://github.com/helm/charts/tree/master/stable/terracotta">helm chart</a>.</p>

<h4 id="configuration">Configuration</h4>

<p>To see the relevant list of CAS properties, please <a href="../configuration/Configuration-Properties.html#ehcache-3-ticket-registry">review this guide</a>.
CAS currently doesn’t support or require an XML configuration to configure Ehcache.</p>

<h3 id="eviction-policy">Eviction Policy</h3>

<p>Ehcache can be configured as “eternal” in which case CAS’s regular cleaning process will remove expired tickets. If the 
eternal property is set to false then storage timeouts will be set based on the metadata for the individual caches.</p>

<h1 id="ehcache-v2-ticket-registry">Ehcache v2 Ticket Registry</h1>

<p>Due to the relatively unsupported status of the Ehcache 2.x code base, this module is deprecated and will likely be 
removed in a future CAS release. Unlike the Ehcache 3.x library, it can replicate directly between CAS servers without
needing an external cache cluster (e.g. Terracotta in Ehcache 3.x).</p>

<div class="alert alert-warning"><strong>Usage</strong>
<p><strong>This feature is deprecated and is scheduled to be removed in the future.</strong> If you can, consider using
the Ehcache v3 ticket registry functionality in CAS to handle this integration.</p>
</div>

<p>Ehcache integration is enabled by including the following dependency in the WAR overlay:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;dependency&gt;</span>
     <span class="nt">&lt;groupId&gt;</span>org.apereo.cas<span class="nt">&lt;/groupId&gt;</span>
     <span class="nt">&lt;artifactId&gt;</span>cas-server-support-ehcache-ticket-registry<span class="nt">&lt;/artifactId&gt;</span>
     <span class="nt">&lt;version&gt;</span>${cas.version}<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>This registry stores tickets using <a href="http://ehcache.org/">Ehcache</a> version 2.x library.</p>

<h2 id="distributed-cache">Distributed Cache</h2>

<p>Distributed caches are recommended for HA architectures since they offer fault tolerance in the ticket storage
subsystem. A single cache instance is created to house all types of tickets, and is synchronously replicated
across the cluster of nodes that are defined in the configuration.</p>

<h3 id="rmi-replication">RMI Replication</h3>

<p>Ehcache supports <a href="https://docs.oracle.com/javase/tutorial/rmi/index.html">RMI</a>
replication for distributed caches composed of two or more nodes. To learn more about RMI
replication with Ehcache, <a href="http://ehcache.org/documentation/user-guide/rmi-replicated-caching">see this resource</a>.</p>

<h4 id="configuration-1">Configuration</h4>

<p>To see the relevant list of CAS properties, please <a href="../configuration/Configuration-Properties.html#ehcache-ticket-registry">review this guide</a>.</p>

<p>The Ehcache configuration for <code class="language-plaintext highlighter-rouge">ehcache-replicated.xml</code> mentioned in the config follows. 
Note that <code class="language-plaintext highlighter-rouge">${ehcache.otherServer}</code> would be replaced by a system property: <code class="language-plaintext highlighter-rouge">-Dehcache.otherserver=cas2</code>.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;ehcache</span> <span class="na">name=</span><span class="s">"ehCacheTicketRegistryCache"</span>
    <span class="na">updateCheck=</span><span class="s">"false"</span>
    <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="na">xsi:noNamespaceSchemaLocation=</span><span class="s">"http://ehcache.org/ehcache.xsd"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;diskStore</span> <span class="na">path=</span><span class="s">"java.io.tmpdir/cas"</span><span class="nt">/&gt;</span>

    <span class="c">&lt;!-- Automatic Peer Discovery
    &lt;cacheManagerPeerProviderFactory
    class="net.sf.ehcache.distribution.RMICacheManagerPeerProviderFactory"
    properties="peerDiscovery=automatic, multicastGroupAddress=230.0.0.1, multicastGroupPort=4446, timeToLive=32"
    propertySeparator="," /&gt;
    --&gt;</span>

    <span class="c">&lt;!-- Manual Peer Discovery --&gt;</span>
    <span class="nt">&lt;cacheManagerPeerProviderFactory</span>
        <span class="na">class=</span><span class="s">"net.sf.ehcache.distribution.RMICacheManagerPeerProviderFactory"</span>
        <span class="na">properties=</span><span class="s">"peerDiscovery=manual,rmiUrls=//${ehcache.otherServer}:41001/proxyGrantingTicketsCache| \
            //${ehcache.otherServer}:41001/ticketGrantingTicketsCache|//${ehcache.otherServer}:41001/proxyTicketsCache| \
            //${ehcache.otherServer}:41001/oauthCodesCache|//${ehcache.otherServer}:41001/samlArtifactsCache| \
            //${ehcache.otherServer}:41001/oauthDeviceUserCodesCache|//${ehcache.otherServer}:41001/samlAttributeQueryCache| \
            //${ehcache.otherServer}:41001/oauthAccessTokensCache|//${ehcache.otherServer}:41001/serviceTicketsCache| \
            //${ehcache.otherServer}:41001/oauthRefreshTokensCache|//${ehcache.otherServer}:41001/transientSessionTicketsCache| \
            //${ehcache.otherServer}:41001/oauthDeviceTokensCache"</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;cacheManagerPeerListenerFactory</span>
        <span class="na">class=</span><span class="s">"net.sf.ehcache.distribution.RMICacheManagerPeerListenerFactory"</span>
        <span class="na">properties=</span><span class="s">"port=41001,remoteObjectPort=41002"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/ehcache&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="eviction-policy-1">Eviction Policy</h3>

<p>Ehcache manages the internal eviction policy of cached objects via the idle and alive settings.
These settings control the general policy of the cache that is used to store various ticket types. In general,
you need to ensure the cache is alive long enough to support the individual expiration policy of tickets, and let
CAS clean the tickets as part of its own cleaner.</p>

<h3 id="troubleshooting-guidelines">Troubleshooting Guidelines</h3>

<ul>
  <li>
    <p>You will need to ensure that network communication across CAS nodes is allowed and no firewall or other component
 is blocking traffic.</p>
  </li>
  <li>If you are running this on a server with active firewalls, you will probably need to specify
a fixed <code class="language-plaintext highlighter-rouge">remoteObjectPort</code>, within the <code class="language-plaintext highlighter-rouge">cacheManagerPeerListenerFactory</code>.</li>
  <li>Depending on environment settings and version of Ehcache used, you may also have to adjust the
<code class="language-plaintext highlighter-rouge">shared</code> setting .</li>
  <li>Ensure that each cache manager specified a name that matches the Ehcache configuration itself.</li>
  <li>You may also need to adjust your expiration policy to allow for a larger time span, specially
for service tickets depending on network traffic and communication delay across CAS nodes particularly
in the event that a node is trying to join the cluster.</li>
</ul>

                </div>
            </section>
        </main>
    </div>
</div>


<footer>
    <div class="container">
        CAS is supported by the <a href="https://www.apereo.org/">Apereo Foundation</a>.
    </div>
</footer>

<script>
    let pageSection = 'Ticketing';
</script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.3.2/js/tether.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js"></script>

<script src="../../javascripts/URI.js"></script>
<script src="../../javascripts/main.js"></script>

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script>
<script type="text/javascript" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
</body>

</html>
