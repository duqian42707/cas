<!DOCTYPE html>
<html>

<head>
    <!-- Required meta tags always come first -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="CAS - Enterprise Single Sign-On for the Web"/>
    <meta name="keywords" content="authentication, login, cas, central authentication service, web, java, protocol, thymeleaf,
                   open source, boot, spring, authorization, google, facebook, twitter, higher-ed, enterprise,
                   access management, single signon, sso, RBAC, ABAC, attributes, SAML, OpenID, openid connect,
                   JWT, ADFS"/>
    <meta name="robots" content="index,follow"/>

    
    

        
    


    

    <script>
        ((i, s, o, g, r, a, m) => {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-83384532-2', 'auto');
        ga('send', 'pageview');

    </script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3"/>

    <link rel="stylesheet" type="text/css" media="screen" href="../../stylesheets/stylesheet.css">
    <link rel="stylesheet" type="text/css" media="print" href="../../stylesheets/print.css">

    <link href='https://fonts.googleapis.com/css?family=Lato:400,300,700' rel='stylesheet'>
    <link href='https://fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic&subset=latin-ext,latin' rel='stylesheet'>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@100;200;300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css" rel="stylesheet">

    <title>CAS - Securing Configuration Properties</title>

</head>

<body>
<!-- HEADER -->
<header class="hidden-sm-down">
    <div class="container">
        <div class="row">
            <div class="col-xs-4 col-md-2">
                <a href="../../index.html">
                    <img class="undecorated" src="../../images/cas_logo.png"/>
                </a>
            </div>
            <div class="col-xs-8 col-md-6">
                <h1>Enterprise Single Sign-On for All</h1>
            </div>
            <div class="hidden-sm-down col-md-4">
                <a id="forkme_banner" href="https://github.com/apereo/cas">View on GitHub</a>
            </div>

        </div>
    </div>
</header>

<!-- NAVBAR -->

<nav class="navbar navbar-expand-md navbar-dark bg-primary bg-dark">
    <div class="container">
        <button class="navbar-toggler collapsed" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarsExample04" aria-controls="navbarsExample04" aria-expanded="false"
                aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="navbar-collapse collapse" id="navbarsExample04">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active"><a href="../../index.html" class="zoom nav-link">Home</a></li>
                <li class="nav-item"><a href="https://github.com/apereo/cas/releases" class="zoom nav-link">Releases</a></li>
                <li class="nav-item"><a href="../../Support.html" class="zoom nav-link">Support</a></li>
                <li class="nav-item"><a href="../../Mailing-Lists.html" class="zoom nav-link">Mailing Lists</a></li>
                <li class="nav-item">
                    <a class="zoom nav-link" href="../../Demos.html">Demos</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="zoom nav-link dropdown-toggle mr-md-2" href="#" id="cas-versions" data-bs-toggle="dropdown"
                       aria-haspopup="true" aria-expanded="false">Versions</a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="cas-versions">
                        
                        
                        <a class="dropdown-item" href="/cas/development/">Development</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.6.x/">v6.6.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.5.x/">v6.5.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.4.x/">v6.4.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.3.x/">v6.3.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.2.x/">v6.2.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.1.x/">v6.1.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.0.x/">v6.0.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.3.x/">v5.3.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.2.x/">v5.2.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.1.x/">v5.1.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.0.x/">v5.0.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/4.2.x/">v4.2.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/4.1.x/">v4.1.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/4.0.x/">v4.0.x</a>
                        
                        

                    </div>
                </li>
                <li class="nav-item"><a href="https://apereo.github.io" target="_blank" class="zoom nav-link">Blog</a></li>
            </ul>

        </div>

    </div>
</nav>


<div class="container-fluid">
    <div class="row flex-xl-nowrap">
        <div class="col-12 col-md-3 col-xl-2 docs-sidebar pb-5" id="sidebar"></div>


        <div class="d-none d-xl-block col-xl-2 docs-toc">
    <div id="pageContents">
        <ul class="section-nav"></ul>
    </div>
</div>


        <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 cas-docs-content" role="main">


            

            <section>
                <nav id="docsNavBar">
                    <span id="toolbarIcons"></span>
                </nav>

                <div id="cas-docs-container">
                    <h1 id="configuration-security">Configuration Security</h1>

<p>This document describes how to retrieve and secure CAS configuration and properties.</p>

<h2 id="standalone">Standalone</h2>

<p>If you are running CAS in standalone mode without the presence of the configuration server,
you can take advantage of built-in <a href="http://www.jasypt.org/">Jasypt</a> functionality to decrypt sensitive CAS settings.</p>

<p>Jasypt supplies command-line tools useful for performing encryption, decryption, etc. In order to use the tools, you should download the Jasypt distribution. Once unzipped, you will find a <code class="language-plaintext highlighter-rouge">jasypt-$VERSION/bin</code> directory a number of <code class="language-plaintext highlighter-rouge">bat|sh</code> scripts that you can use for encryption/decryption operations <code class="language-plaintext highlighter-rouge">(encrypt|decrypt).(bat|sh)</code>.</p>

<p>Encrypted settings need to be placed into CAS configuration files as:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="py">cas.something.sensitive</span><span class="p">=</span><span class="s">{cipher}FKSAJDFGYOS8F7GLHAKERGFHLSAJ</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>You also need to instruct CAS to use the proper algorithm, decryption key and other relevant parameters
when attempting to decrypt settings. To see the relevant list of CAS properties for this 
feature, please <a href="Configuration-Properties.html#configuration-security">review this guide</a>.</p>

<h2 id="spring-cloud">Spring Cloud</h2>

<p>Securing CAS settings and decrypting them is entirely handled by
the <a href="https://github.com/spring-cloud/spring-cloud-config">Spring Cloud</a> project
as <a href="Configuration-Server-Management.html">described in this guide</a>.</p>

<p>The CAS configuration server exposes <code class="language-plaintext highlighter-rouge">/encrypt</code> and <code class="language-plaintext highlighter-rouge">/decrypt</code> endpoints to support encrypting and decrypting values.
Both endpoints accept a <code class="language-plaintext highlighter-rouge">POST</code> payload; you can use <code class="language-plaintext highlighter-rouge">/encrypt</code> to secure and encrypt settings and place them inside your CAS configuration.
CAS will auto-decrypt at the appropriate moment.</p>

<p>To see the relevant list of CAS properties for this feature, please <a href="Configuration-Properties.html#configuration-security">review this guide</a>.</p>

<div class="alert alert-warning"><strong>JCE Requirements</strong><p>to use the encryption and decryption
features you need the full-strength "Java Cryptography Extension (JCE) Unlimited Strength Jurisdiction Policy Files"
installed in your JVM version (if it’s not there by default).</p></div>

<p>To encrypt a given setting, use:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>curl https://config.server.endpoint/encrypt <span class="nt">-d</span> sensitiveValue
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Then, copy the encrypted setting into your CAS configuration using the method specified below.</p>

<div class="alert alert-warning"><strong>URL Encoding</strong><p>Be careful with <code>curl</code>.
You may have to use <code>--data-urlencode</code> or set an explicit <code>Content-Type: text/plain</code>
to account for special characters such as <code>+</code>.</p></div>

<p>If you wish to manually encrypt and decrypt settings to ensure the functionality is sane, use:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="nb">export </span><span class="nv">ENCRYPTED</span><span class="o">=</span><span class="sb">`</span>curl https://config.server.endpoint/encrypt <span class="nt">-d</span> sensitiveValue | python <span class="nt">-c</span> <span class="s1">'import sys,urllib;print urllib.quote(sys.stdin.read().strip())'</span><span class="sb">`</span>
<span class="nb">echo</span> <span class="nv">$ENCRYPTED</span>
curl https://config.server.endpoint/decrypt <span class="nt">-d</span> <span class="nv">$ENCRYPTED</span> | python <span class="nt">-c</span> <span class="s1">'import sys,urllib;print urllib.quote(sys.stdin.read().strip())'</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Properties that are prefixed with <code class="language-plaintext highlighter-rouge">{cipher}</code> are automatically decrypted by the CAS configuration server at runtime, such as:</p>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="s">cas</span>
    <span class="s">something</span>
        <span class="s">sensitive</span><span class="err">:</span> <span class="s1">'</span><span class="s">{cipher}FKSAJDFGYOS8F7GLHAKERGFHLSAJ'</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Or:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="c"># Note that there are no quotes around the value!
</span><span class="py">cas.something.sensitive</span><span class="p">=</span><span class="s">{cipher}FKSAJDFGYOS8F7GLHAKERGFHLSAJ</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="vault">Vault</h2>

<p>You can also store sensitive settings inside <a href="https://www.vaultproject.io/">Vault</a>.
Vault can store your existing secrets, or it can dynamically generate new secrets
to control access to third-party resources or provide time-limited credentials for your infrastructure.
To lean more about Vault and its installation process, please visit the project website.</p>

<p>Once vault is accessible and configured inside CAS, support is provided via the following dependency:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;dependency&gt;</span>
     <span class="nt">&lt;groupId&gt;</span>org.apereo.cas<span class="nt">&lt;/groupId&gt;</span>
     <span class="nt">&lt;artifactId&gt;</span>cas-server-support-configuration-cloud-vault<span class="nt">&lt;/artifactId&gt;</span>
     <span class="nt">&lt;version&gt;</span>${cas.version}<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>To see the relevant list of CAS properties for this feature, please <a href="Configuration-Properties.html#vault">review this guide</a>.</p>

<p>With CAS, secrets are picked up at startup of the application server. CAS uses the data and settings
from the application name (i.e. <code class="language-plaintext highlighter-rouge">cas</code>) and active profiles to determine contexts paths in
which secrets should be stored and later fetched.</p>

<p>These context paths typically are:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>/secret/<span class="o">{</span>application<span class="o">}</span>/<span class="o">{</span>profile<span class="o">}</span>
/secret/<span class="o">{</span>application<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>As an example, you may write the following CAS setting to Vault:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>vault write secret/cas/native &lt;setting-name&gt;<span class="o">=</span>&lt;value&gt;
</pre></td></tr></tbody></table></code></pre></div></div>

<p>CAS will execute the equivalent of the following command to read settings later when needed:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>vault <span class="nb">read </span>secret/cas/native
</pre></td></tr></tbody></table></code></pre></div></div>

<p>All settings and secrets that are stored inside Vault may be reloaded at any given time.
To lean more about how CAS allows you to reload configuration changes, please <a href="Configuration-Management-Reload.html">review this guide</a>.
To lean more about how configuration is managed and profiled by CAS, please <a href="Configuration-Management.html">review this guide</a>.</p>

<h3 id="troubleshooting">Troubleshooting</h3>

<p>To enable additional logging, modify the logging configuration file to add the following:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;AsyncLogger</span> <span class="na">name=</span><span class="s">"org.springframework.cloud.vault"</span> <span class="na">level=</span><span class="s">"debug"</span> <span class="na">additivity=</span><span class="s">"false"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;AppenderRef</span> <span class="na">ref=</span><span class="s">"console"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;AppenderRef</span> <span class="na">ref=</span><span class="s">"file"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/AsyncLogger&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

                </div>
            </section>
        </main>
    </div>
</div>


<footer>
    <div class="container">
        CAS is supported by the <a href="https://www.apereo.org/">Apereo Foundation</a>.
    </div>
</footer>

<script>
    let pageSection = '';
</script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.3.2/js/tether.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js"></script>

<script src="../../javascripts/URI.js"></script>
<script src="../../javascripts/main.js"></script>

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script>
<script type="text/javascript" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
</body>

</html>
