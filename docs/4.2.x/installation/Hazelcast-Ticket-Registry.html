<!DOCTYPE html>
<html>

<head>
    <!-- Required meta tags always come first -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="CAS - Enterprise Single Sign-On for the Web"/>
    <meta name="keywords" content="authentication, login, cas, central authentication service, web, java, protocol, thymeleaf,
                   open source, boot, spring, authorization, google, facebook, twitter, higher-ed, enterprise,
                   access management, single signon, sso, RBAC, ABAC, attributes, SAML, OpenID, openid connect,
                   JWT, ADFS"/>
    <meta name="robots" content="index,follow"/>

    
    

        
    


    

    <script>
        ((i, s, o, g, r, a, m) => {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-83384532-2', 'auto');
        ga('send', 'pageview');

    </script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3"/>

    <link rel="stylesheet" type="text/css" media="screen" href="../../stylesheets/stylesheet.css">
    <link rel="stylesheet" type="text/css" media="print" href="../../stylesheets/print.css">

    <link href='https://fonts.googleapis.com/css?family=Lato:400,300,700' rel='stylesheet'>
    <link href='https://fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic&subset=latin-ext,latin' rel='stylesheet'>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@100;200;300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css" rel="stylesheet">

    <title>CAS - Hazelcast Ticket Registry</title>

</head>

<body>
<!-- HEADER -->
<header class="hidden-sm-down">
    <div class="container">
        <div class="row">
            <div class="col-xs-4 col-md-2">
                <a href="../../index.html">
                    <img class="undecorated" src="../../images/cas_logo.png"/>
                </a>
            </div>
            <div class="col-xs-8 col-md-6">
                <h1>Enterprise Single Sign-On for All</h1>
            </div>
            <div class="hidden-sm-down col-md-4">
                <a id="forkme_banner" href="https://github.com/apereo/cas">View on GitHub</a>
            </div>

        </div>
    </div>
</header>

<!-- NAVBAR -->

<nav class="navbar navbar-expand-md navbar-dark bg-primary bg-dark">
    <div class="container">
        <button class="navbar-toggler collapsed" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarsExample04" aria-controls="navbarsExample04" aria-expanded="false"
                aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="navbar-collapse collapse" id="navbarsExample04">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active"><a href="../../index.html" class="zoom nav-link">Home</a></li>
                <li class="nav-item"><a href="https://github.com/apereo/cas/releases" class="zoom nav-link">Releases</a></li>
                <li class="nav-item"><a href="../../Support.html" class="zoom nav-link">Support</a></li>
                <li class="nav-item"><a href="../../Mailing-Lists.html" class="zoom nav-link">Mailing Lists</a></li>
                <li class="nav-item">
                    <a class="zoom nav-link" href="../../Demos.html">Demos</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="zoom nav-link dropdown-toggle mr-md-2" href="#" id="cas-versions" data-bs-toggle="dropdown"
                       aria-haspopup="true" aria-expanded="false">Versions</a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="cas-versions">
                        
                        
                        <a class="dropdown-item" href="/cas/development/">Development</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.6.x/">v6.6.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.5.x/">v6.5.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.4.x/">v6.4.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.3.x/">v6.3.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.2.x/">v6.2.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.1.x/">v6.1.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.0.x/">v6.0.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.3.x/">v5.3.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.2.x/">v5.2.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.1.x/">v5.1.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.0.x/">v5.0.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/4.2.x/">v4.2.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/4.1.x/">v4.1.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/4.0.x/">v4.0.x</a>
                        
                        

                    </div>
                </li>
                <li class="nav-item"><a href="https://apereo.github.io" target="_blank" class="zoom nav-link">Blog</a></li>
            </ul>

        </div>

    </div>
</nav>


<div class="container-fluid">
    <div class="row flex-xl-nowrap">
        <div class="col-12 col-md-3 col-xl-2 docs-sidebar pb-5" id="sidebar"></div>


        <div class="d-none d-xl-block col-xl-2 docs-toc">
    <div id="pageContents">
        <ul class="section-nav"></ul>
    </div>
</div>


        <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 cas-docs-content" role="main">


            

            <section>
                <nav id="docsNavBar">
                    <span id="toolbarIcons"></span>
                </nav>

                <div id="cas-docs-container">
                    <h1 id="hazelcast-ticket-registry">Hazelcast Ticket Registry</h1>

<p>Hazelcast Ticket Registry is a distributed ticket registry implementation based on <a href="http://hazelcast.org/">Hazelcast distributed grid library</a>. The registry implementation is cluster-aware and is able to auto-join a cluster of all the CAS nodes that expose this registry. Hazelcast will use port auto-increment feature to assign a TCP port to each member of a cluster starting from initially provided arbitrary port (<code class="language-plaintext highlighter-rouge">5701</code> by default).</p>

<p>Hazelcast will evenly distribute the ticket data among all the members of a cluster in a very efficient manner. Also, by default, the data collection on each node is configured with 1 backup copy, so that Hazelcast will use it to make strong data consistency guarantees i.e. the loss of data on live nodes will not occur should any other <em>primary data owner</em> members die. The data will be re-partitioned among the remaining live cluster members.</p>

<p>This ticket registry implementation is enabled by simply including the module in the Maven overlay pom:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.jasig.cas<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>cas-server-integration-hazelcast<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>${cas.version}<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="configuration">Configuration</h2>

<p>Enable the registry via:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;alias</span> <span class="na">name=</span><span class="s">"hazelcastTicketRegistry"</span> <span class="na">alias=</span><span class="s">"ticketRegistry"</span> <span class="nt">/&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>This module has a flexible configuration strategy which by default auto-configures <code class="language-plaintext highlighter-rouge">HazelcastInstance</code> used by the TicketRegistry
implementation to retrieve Hazelcast’s <code class="language-plaintext highlighter-rouge">IMap</code> instance for its distributed tickets storage. Some aspects of <code class="language-plaintext highlighter-rouge">HazelcastInstance</code>
configuration in this auto-configuration mode are controlled by the following exposed properties which could be set via
an external <code class="language-plaintext highlighter-rouge">cas.properties</code> file (with sensible defaults for all the properties if not explicitly set):</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="c"># hz.config.location=file:/etc/cas/hazelcast.xml
# hz.mapname=tickets
# hz.cluster.logging.type=slf4j
# hz.cluster.portAutoIncrement=true
# hz.cluster.port=5701
# hz.cluster.members=cas1.example.com,cas2.example.com
# hz.cluster.tcpip.enabled=true
# hz.cluster.multicast.enabled=false
# hz.cluster.max.heapsize.percentage=85
# hz.cluster.max.heartbeat.seconds=300
# hz.cluster.eviction.percentage=10
# hz.cluster.eviction.policy=LRU
# hz.cluster.instance.name=${host.name}
# hz.cluster.logging.type=slf4j
# hz.cluster.backupCount=1
# hz.cluster.asyncBackupCount=0
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>Should the more fine-grained configuration need arise, there is an option to use a native Hazelcast configuration XML format
where all the configuration options for <code class="language-plaintext highlighter-rouge">HazelcastInstance</code> exposed by Hazelcast are available. In order to trigger this configuration mode,
there are two basic steps required:</p>

<ul>
  <li>
    <p>Place native <code class="language-plaintext highlighter-rouge">hazelcast.xml</code> file containing the custom configuration for Hazelcast Instance into an external filesystem location
of choice (<code class="language-plaintext highlighter-rouge">/etc/cas/hazelcast.xml</code> by convention).</p>
  </li>
  <li>
    <p>Indicate the location of the external native config file by the following property:</p>
  </li>
</ul>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="py">hz.config.location</span><span class="p">=</span><span class="s">file:/etc/cas/hazelcast.xml</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Here’s a simple example of <code class="language-plaintext highlighter-rouge">hazelcast.xml</code> that configures AWS cluster join strategy instead of a default TCP/IP one:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;hazelcast</span> <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.hazelcast.com/schema/config hazelcast-config-3.6.xsd"</span>
           <span class="na">xmlns=</span><span class="s">"http://www.hazelcast.com/schema/config"</span>
           <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;network&gt;</span>
        <span class="nt">&lt;port</span> <span class="na">auto-increment=</span><span class="s">"true"</span> <span class="na">port-count=</span><span class="s">"100"</span><span class="nt">&gt;</span>5701<span class="nt">&lt;/port&gt;</span>
        <span class="nt">&lt;join&gt;</span>
            <span class="nt">&lt;multicast</span> <span class="na">enabled=</span><span class="s">"false"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;multicast-group&gt;</span>224.2.2.3<span class="nt">&lt;/multicast-group&gt;</span>
                <span class="nt">&lt;multicast-port&gt;</span>55327<span class="nt">&lt;/multicast-port&gt;</span>
            <span class="nt">&lt;/multicast&gt;</span>
            <span class="nt">&lt;tcp-ip</span> <span class="na">enabled=</span><span class="s">"false"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;member-list&gt;</span>
                    <span class="nt">&lt;member&gt;</span>127.0.0.1<span class="nt">&lt;/member&gt;</span>
                <span class="nt">&lt;/member-list&gt;</span>
            <span class="nt">&lt;/tcp-ip&gt;</span>
            <span class="nt">&lt;aws</span> <span class="na">enabled=</span><span class="s">"true"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;access-key&gt;</span>my-access-key<span class="nt">&lt;/access-key&gt;</span>
                <span class="nt">&lt;secret-key&gt;</span>my-secret-key<span class="nt">&lt;/secret-key&gt;</span>
                <span class="c">&lt;!--optional, default is us-east-1 --&gt;</span>
                <span class="nt">&lt;region&gt;</span>us-west-1<span class="nt">&lt;/region&gt;</span>
                <span class="c">&lt;!--optional, default is ec2.amazonaws.com. If set, region shouldn't be set as it will override this property --&gt;</span>
                <span class="nt">&lt;host-header&gt;</span>ec2.amazonaws.com<span class="nt">&lt;/host-header&gt;</span>
                <span class="c">&lt;!-- optional, only instances belonging to this group will be discovered, default will try all running instances --&gt;</span>
                <span class="nt">&lt;security-group-name&gt;</span>hazelcast-sg<span class="nt">&lt;/security-group-name&gt;</span>
                <span class="nt">&lt;tag-key&gt;</span>type<span class="nt">&lt;/tag-key&gt;</span>
                <span class="nt">&lt;tag-value&gt;</span>hz-nodes<span class="nt">&lt;/tag-value&gt;</span>
            <span class="nt">&lt;/aws&gt;</span>
        <span class="nt">&lt;/join&gt;</span>
    <span class="nt">&lt;/network&gt;</span>

    <span class="nt">&lt;map</span> <span class="na">name=</span><span class="s">"tickets"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;max-idle-seconds&gt;</span>28800<span class="nt">&lt;/max-idle-seconds&gt;</span>
        <span class="c">&lt;!--
            Valid values are:
            NONE (no eviction),
            LRU (Least Recently Used),
            LFU (Least Frequently Used).
            NONE is the default.
        --&gt;</span>
        <span class="nt">&lt;eviction-policy&gt;</span>LFU<span class="nt">&lt;/eviction-policy&gt;</span>
        <span class="c">&lt;!--
            Maximum size of the map. When max size is reached,
            map is evicted based on the policy defined.
            Any integer between 0 and Integer.MAX_VALUE. 0 means
            Integer.MAX_VALUE. Default is 0.
        --&gt;</span>
        <span class="nt">&lt;max-size</span> <span class="na">policy=</span><span class="s">"USED_HEAP_PERCENTAGE"</span><span class="nt">&gt;</span>85<span class="nt">&lt;/max-size&gt;</span>
        <span class="c">&lt;!--
            When max. size is reached, specified percentage of
            the map will be evicted. Any integer between 0 and 100.
            If 25 is set for example, 25% of the entries will
            get evicted.
        --&gt;</span>
        <span class="nt">&lt;eviction-percentage&gt;</span>10<span class="nt">&lt;/eviction-percentage&gt;</span>
    <span class="nt">&lt;/map&gt;</span>

<span class="nt">&lt;/hazelcast&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>For more information on the Hazelcast configuration options available, refer to <a href="http://docs.hazelcast.org/docs/3.6/manual/html/configuringhazelcast.html">the Hazelcast documentation</a></p>

<h2 id="logging">Logging</h2>
<p>To enable additional logging for the registry, configure the log4j configuration file to add the following
levels:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>...
<span class="nt">&lt;AsyncLogger</span> <span class="na">name=</span><span class="s">"com.hazelcast"</span> <span class="na">level=</span><span class="s">"debug"</span> <span class="na">additivity=</span><span class="s">"false"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;AppenderRef</span> <span class="na">ref=</span><span class="s">"console"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;AppenderRef</span> <span class="na">ref=</span><span class="s">"file"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/AsyncLogger&gt;</span>
...
</pre></td></tr></tbody></table></code></pre></div></div>

                </div>
            </section>
        </main>
    </div>
</div>


<footer>
    <div class="container">
        CAS is supported by the <a href="https://www.apereo.org/">Apereo Foundation</a>.
    </div>
</footer>

<script>
    let pageSection = '';
</script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.3.2/js/tether.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js"></script>

<script src="../../javascripts/URI.js"></script>
<script src="../../javascripts/main.js"></script>

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script>
<script type="text/javascript" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
</body>

</html>
