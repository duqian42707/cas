<!DOCTYPE html>
<html>

<head>
    <!-- Required meta tags always come first -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="CAS - Enterprise Single Sign-On for the Web"/>
    <meta name="keywords" content="authentication, login, cas, central authentication service, web, java, protocol, thymeleaf,
                   open source, boot, spring, authorization, google, facebook, twitter, higher-ed, enterprise,
                   access management, single signon, sso, RBAC, ABAC, attributes, SAML, OpenID, openid connect,
                   JWT, ADFS"/>
    <meta name="robots" content="index,follow"/>

    
    

        
    


    

    <script>
        ((i, s, o, g, r, a, m) => {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-83384532-2', 'auto');
        ga('send', 'pageview');

    </script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3"/>

    <link rel="stylesheet" type="text/css" media="screen" href="../../stylesheets/stylesheet.css">
    <link rel="stylesheet" type="text/css" media="print" href="../../stylesheets/print.css">

    <link href='https://fonts.googleapis.com/css?family=Lato:400,300,700' rel='stylesheet'>
    <link href='https://fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic&subset=latin-ext,latin' rel='stylesheet'>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@100;200;300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css" rel="stylesheet">

    <title>CAS - Database Authentication</title>

</head>

<body>
<!-- HEADER -->
<header class="hidden-sm-down">
    <div class="container">
        <div class="row">
            <div class="col-xs-4 col-md-2">
                <a href="../../index.html">
                    <img class="undecorated" src="../../images/cas_logo.png"/>
                </a>
            </div>
            <div class="col-xs-8 col-md-6">
                <h1>Enterprise Single Sign-On for All</h1>
            </div>
            <div class="hidden-sm-down col-md-4">
                <a id="forkme_banner" href="https://github.com/apereo/cas">View on GitHub</a>
            </div>

        </div>
    </div>
</header>

<!-- NAVBAR -->

<nav class="navbar navbar-expand-md navbar-dark bg-primary bg-dark">
    <div class="container">
        <button class="navbar-toggler collapsed" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarsExample04" aria-controls="navbarsExample04" aria-expanded="false"
                aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="navbar-collapse collapse" id="navbarsExample04">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active"><a href="../../index.html" class="zoom nav-link">Home</a></li>
                <li class="nav-item"><a href="https://github.com/apereo/cas/releases" class="zoom nav-link">Releases</a></li>
                <li class="nav-item"><a href="../../Support.html" class="zoom nav-link">Support</a></li>
                <li class="nav-item"><a href="../../Mailing-Lists.html" class="zoom nav-link">Mailing Lists</a></li>
                <li class="nav-item">
                    <a class="zoom nav-link" href="../../Demos.html">Demos</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="zoom nav-link dropdown-toggle mr-md-2" href="#" id="cas-versions" data-bs-toggle="dropdown"
                       aria-haspopup="true" aria-expanded="false">Versions</a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="cas-versions">
                        
                        
                        <a class="dropdown-item" href="/cas/development/">Development</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.6.x/">v6.6.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.5.x/">v6.5.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.4.x/">v6.4.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.3.x/">v6.3.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.2.x/">v6.2.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.1.x/">v6.1.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.0.x/">v6.0.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.3.x/">v5.3.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.2.x/">v5.2.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.1.x/">v5.1.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.0.x/">v5.0.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/4.2.x/">v4.2.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/4.1.x/">v4.1.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/4.0.x/">v4.0.x</a>
                        
                        

                    </div>
                </li>
                <li class="nav-item"><a href="https://apereo.github.io" target="_blank" class="zoom nav-link">Blog</a></li>
            </ul>

        </div>

    </div>
</nav>


<div class="container-fluid">
    <div class="row flex-xl-nowrap">
        <div class="col-12 col-md-3 col-xl-2 docs-sidebar pb-5" id="sidebar"></div>


        <div class="d-none d-xl-block col-xl-2 docs-toc">
    <div id="pageContents">
        <ul class="section-nav"></ul>
    </div>
</div>


        <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 cas-docs-content" role="main">


            

            <section>
                <nav id="docsNavBar">
                    <span id="toolbarIcons"></span>
                </nav>

                <div id="cas-docs-container">
                    <h1 id="database-authentication">Database Authentication</h1>
<p>Database authentication components are enabled by including the following dependencies in the Maven WAR overlay:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.jasig.cas<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>cas-server-support-jdbc<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>${cas.version}<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="connection-pooling">Connection Pooling</h2>
<p>All database authentication components require a <code class="language-plaintext highlighter-rouge">DataSource</code> for acquiring connections to the underlying database.
The use of connection pooling is <em>strongly</em> recommended, and the <a href="http://www.mchange.com/projects/c3p0/">c3p0 library</a>
is a good choice that we discuss here.</p>

<h3 id="pooled-data-source-example">Pooled Data Source Example</h3>
<p>A bean named <code class="language-plaintext highlighter-rouge">dataSource</code> must be defined for CAS components that use a database.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"dataSource"</span>
  <span class="na">class=</span><span class="s">"com.mchange.v2.c3p0.ComboPooledDataSource"</span>
  <span class="na">p:driverClass=</span><span class="s">"${database.driverClass}"</span>
  <span class="na">p:jdbcUrl=</span><span class="s">"${database.url}"</span>
  <span class="na">p:user=</span><span class="s">"${database.user}"</span>
  <span class="na">p:password=</span><span class="s">"${database.password}"</span>
  <span class="na">p:initialPoolSize=</span><span class="s">"${database.pool.minSize}"</span>
  <span class="na">p:minPoolSize=</span><span class="s">"${database.pool.minSize}"</span>
  <span class="na">p:maxPoolSize=</span><span class="s">"${database.pool.maxSize}"</span>
  <span class="na">p:maxIdleTimeExcessConnections=</span><span class="s">"${database.pool.maxIdleTime}"</span>
  <span class="na">p:checkoutTimeout=</span><span class="s">"${database.pool.maxWait}"</span>
  <span class="na">p:acquireIncrement=</span><span class="s">"${database.pool.acquireIncrement}"</span>
  <span class="na">p:acquireRetryAttempts=</span><span class="s">"${database.pool.acquireRetryAttempts}"</span>
  <span class="na">p:acquireRetryDelay=</span><span class="s">"${database.pool.acquireRetryDelay}"</span>
  <span class="na">p:idleConnectionTestPeriod=</span><span class="s">"${database.pool.idleConnectionTestPeriod}"</span>
  <span class="na">p:preferredTestQuery=</span><span class="s">"${database.pool.connectionHealthQuery}"</span> <span class="nt">/&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The following properties may be used as a starting point for connection pool configuration/tuning.</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre></td><td class="rouge-code"><pre><span class="c"># == Basic database connection pool configuration ==
</span><span class="py">database.driverClass</span><span class="p">=</span><span class="s">org.postgresql.Driver</span>
<span class="py">database.url</span><span class="p">=</span><span class="s">jdbc:postgresql://database.example.com/cas?ssl=true</span>
<span class="py">database.user</span><span class="p">=</span><span class="s">somebody</span>
<span class="py">database.password</span><span class="p">=</span><span class="s">meaningless</span>
<span class="py">database.pool.minSize</span><span class="p">=</span><span class="s">6</span>
<span class="py">database.pool.maxSize</span><span class="p">=</span><span class="s">18</span>

<span class="c"># Maximum amount of time to wait in ms for a connection to become
# available when the pool is exhausted
</span><span class="py">database.pool.maxWait</span><span class="p">=</span><span class="s">10000</span>

<span class="c"># Amount of time in seconds after which idle connections
# in excess of minimum size are pruned.
</span><span class="py">database.pool.maxIdleTime</span><span class="p">=</span><span class="s">120</span>

<span class="c"># Number of connections to obtain on pool exhaustion condition.
# The maximum pool size is always respected when acquiring
# new connections.
</span><span class="py">database.pool.acquireIncrement</span><span class="p">=</span><span class="s">6</span>

<span class="c"># == Connection testing settings ==
</span>
<span class="c"># Period in s at which a health query will be issued on idle
# connections to determine connection liveliness.
</span><span class="py">database.pool.idleConnectionTestPeriod</span><span class="p">=</span><span class="s">30</span>

<span class="c"># Query executed periodically to test health
</span><span class="py">database.pool.connectionHealthQuery</span><span class="p">=</span><span class="s">select 1</span>

<span class="c"># == Database recovery settings ==
</span>
<span class="c"># Number of times to retry acquiring a _new_ connection
# when an error is encountered during acquisition.
</span><span class="py">database.pool.acquireRetryAttempts</span><span class="p">=</span><span class="s">5</span>

<span class="c"># Amount of time in ms to wait between successive aquire retry attempts.
</span><span class="py">database.pool.acquireRetryDelay</span><span class="p">=</span><span class="s">2000</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="database-components">Database Components</h2>
<p>CAS provides the following components to accommodate different database authentication needs.</p>

<h6 id="querydatabaseauthenticationhandler"><code class="language-plaintext highlighter-rouge">QueryDatabaseAuthenticationHandler</code></h6>
<p>Authenticates a user by comparing the (hashed) user password against the password on record determined by a
configurable database query.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;alias</span> <span class="na">name=</span><span class="s">"queryDatabaseAuthenticationHandler"</span> <span class="na">alias=</span><span class="s">"primaryAuthenticationHandler"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;alias</span> <span class="na">name=</span><span class="s">"dataSource"</span> <span class="na">alias=</span><span class="s">"queryDatabaseDataSource"</span> <span class="nt">/&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The following settings are applicable:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="c"># cas.jdbc.authn.query.sql=select password from users where username=?
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h6 id="searchmodesearchdatabaseauthenticationhandler"><code class="language-plaintext highlighter-rouge">SearchModeSearchDatabaseAuthenticationHandler</code></h6>
<p>Searches for a user record by querying against a username and password; the user is authenticated if at
least one result is found.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;alias</span> <span class="na">name=</span><span class="s">"searchModeSearchDatabaseAuthenticationHandler"</span> <span class="na">alias=</span><span class="s">"primaryAuthenticationHandler"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;alias</span> <span class="na">name=</span><span class="s">"dataSource"</span> <span class="na">alias=</span><span class="s">"searchModeDatabaseDataSource"</span> <span class="nt">/&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The following settings are applicable:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="c"># cas.jdbc.authn.search.password=
# cas.jdbc.authn.search.user=
# cas.jdbc.authn.search.table=
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h6 id="bindmodesearchdatabaseauthenticationhandler"><code class="language-plaintext highlighter-rouge">BindModeSearchDatabaseAuthenticationHandler</code></h6>
<p>Authenticates a user by attempting to create a database connection using the username and (hashed) password.</p>

<p>The following example does not perform any password encoding since most JDBC drivers natively encode plaintext
passwords to the appropriate format required by the underlying database. Note authentication is equivalent to the
ability to establish a connection with username/password credentials. This handler is the easiest to configure
(usually none required), but least flexible, of the database authentication components.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;alias</span> <span class="na">name=</span><span class="s">"bindModeSearchDatabaseAuthenticationHandler"</span> <span class="na">alias=</span><span class="s">"primaryAuthenticationHandler"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;alias</span> <span class="na">name=</span><span class="s">"dataSource"</span> <span class="na">alias=</span><span class="s">"bindSearchDatabaseDataSource"</span> <span class="nt">/&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h6 id="queryandencodedatabaseauthenticationhandler"><code class="language-plaintext highlighter-rouge">QueryAndEncodeDatabaseAuthenticationHandler</code></h6>
<p>A JDBC querying handler that will pull back the password and
the private salt value for a user and validate the encoded
password using the public salt value. Assumes everything
is inside the same database table. Supports settings for
number of iterations as well as private salt.</p>

<p>This password encoding method, combines the private Salt and the public salt which it
prepends to the password before hashing.
If multiple iterations are used, the bytecode Hash of the first iteration is
rehashed without the salt values.
The final hash is converted to Hex before comparing it to the database value.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;alias</span> <span class="na">name=</span><span class="s">"queryAndEncodeDatabaseAuthenticationHandler"</span> <span class="na">alias=</span><span class="s">"primaryAuthenticationHandler"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;alias</span> <span class="na">name=</span><span class="s">"dataSource"</span> <span class="na">alias=</span><span class="s">"queryEncodeDatabaseDataSource"</span> <span class="nt">/&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The following settings are applicable:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="c"># cas.jdbc.authn.query.encode.sql=
# cas.jdbc.authn.query.encode.alg=
# cas.jdbc.authn.query.encode.salt.static=
# cas.jdbc.authn.query.encode.password=
# cas.jdbc.authn.query.encode.salt=
# cas.jdbc.authn.query.encode.iterations.field=
# cas.jdbc.authn.query.encode.iterations=
</span></pre></td></tr></tbody></table></code></pre></div></div>

                </div>
            </section>
        </main>
    </div>
</div>


<footer>
    <div class="container">
        CAS is supported by the <a href="https://www.apereo.org/">Apereo Foundation</a>.
    </div>
</footer>

<script>
    let pageSection = '';
</script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.3.2/js/tether.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js"></script>

<script src="../../javascripts/URI.js"></script>
<script src="../../javascripts/main.js"></script>

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script>
<script type="text/javascript" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
</body>

</html>
