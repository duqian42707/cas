<!DOCTYPE html>
<html>

<head>
    <!-- Required meta tags always come first -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="CAS - Enterprise Single Sign-On for the Web"/>
    <meta name="keywords" content="authentication, login, cas, central authentication service, web, java, protocol, thymeleaf,
                   open source, boot, spring, authorization, google, facebook, twitter, higher-ed, enterprise,
                   access management, single signon, sso, RBAC, ABAC, attributes, SAML, OpenID, openid connect,
                   JWT, ADFS"/>
    <meta name="robots" content="index,follow"/>

    
    

        
    


    

    <script>
        ((i, s, o, g, r, a, m) => {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-83384532-2', 'auto');
        ga('send', 'pageview');

    </script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3"/>

    <link rel="stylesheet" type="text/css" media="screen" href="../../stylesheets/stylesheet.css">
    <link rel="stylesheet" type="text/css" media="print" href="../../stylesheets/print.css">

    <link href='https://fonts.googleapis.com/css?family=Lato:400,300,700' rel='stylesheet'>
    <link href='https://fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic&subset=latin-ext,latin' rel='stylesheet'>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@100;200;300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css" rel="stylesheet">

    <title>CAS - LDAP Authentication</title>

</head>

<body>
<!-- HEADER -->
<header class="hidden-sm-down">
    <div class="container">
        <div class="row">
            <div class="col-xs-4 col-md-2">
                <a href="../../index.html">
                    <img class="undecorated" src="../../images/cas_logo.png"/>
                </a>
            </div>
            <div class="col-xs-8 col-md-6">
                <h1>Enterprise Single Sign-On for All</h1>
            </div>
            <div class="hidden-sm-down col-md-4">
                <a id="forkme_banner" href="https://github.com/apereo/cas">View on GitHub</a>
            </div>

        </div>
    </div>
</header>

<!-- NAVBAR -->

<nav class="navbar navbar-expand-md navbar-dark bg-primary bg-dark">
    <div class="container">
        <button class="navbar-toggler collapsed" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarsExample04" aria-controls="navbarsExample04" aria-expanded="false"
                aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="navbar-collapse collapse" id="navbarsExample04">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active"><a href="../../index.html" class="zoom nav-link">Home</a></li>
                <li class="nav-item"><a href="https://github.com/apereo/cas/releases" class="zoom nav-link">Releases</a></li>
                <li class="nav-item"><a href="../../Support.html" class="zoom nav-link">Support</a></li>
                <li class="nav-item"><a href="../../Mailing-Lists.html" class="zoom nav-link">Mailing Lists</a></li>
                <li class="nav-item">
                    <a class="zoom nav-link" href="../../Demos.html">Demos</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="zoom nav-link dropdown-toggle mr-md-2" href="#" id="cas-versions" data-bs-toggle="dropdown"
                       aria-haspopup="true" aria-expanded="false">Versions</a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="cas-versions">
                        
                        
                        <a class="dropdown-item" href="/cas/development/">Development</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.6.x/">v6.6.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.5.x/">v6.5.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.4.x/">v6.4.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.3.x/">v6.3.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.2.x/">v6.2.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.1.x/">v6.1.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.0.x/">v6.0.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.3.x/">v5.3.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.2.x/">v5.2.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.1.x/">v5.1.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.0.x/">v5.0.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/4.2.x/">v4.2.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/4.1.x/">v4.1.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/4.0.x/">v4.0.x</a>
                        
                        

                    </div>
                </li>
                <li class="nav-item"><a href="https://apereo.github.io" target="_blank" class="zoom nav-link">Blog</a></li>
            </ul>

        </div>

    </div>
</nav>


<div class="container-fluid">
    <div class="row flex-xl-nowrap">
        <div class="col-12 col-md-3 col-xl-2 docs-sidebar pb-5" id="sidebar"></div>


        <div class="d-none d-xl-block col-xl-2 docs-toc">
    <div id="pageContents">
        <ul class="section-nav"></ul>
    </div>
</div>


        <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 cas-docs-content" role="main">


            

            <section>
                <nav id="docsNavBar">
                    <span id="toolbarIcons"></span>
                </nav>

                <div id="cas-docs-container">
                    <h1 id="ldap-authentication">LDAP Authentication</h1>
<p>LDAP integration is enabled by including the following dependency in the Maven WAR overlay:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;dependency&gt;</span>
     <span class="nt">&lt;groupId&gt;</span>org.jasig.cas<span class="nt">&lt;/groupId&gt;</span>
     <span class="nt">&lt;artifactId&gt;</span>cas-server-support-ldap<span class="nt">&lt;/artifactId&gt;</span>
     <span class="nt">&lt;version&gt;</span>${cas.version}<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="configuration">Configuration</h2>
<p>The <code class="language-plaintext highlighter-rouge">LdapAuthenticationHandler</code> must first be configured to handle the task of credential verification. The following
configuration needs to be put into the <code class="language-plaintext highlighter-rouge">deployerConfigContext.xml</code> file:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"ldapAuthenticationHandler"</span>
<span class="na">class=</span><span class="s">"org.jasig.cas.authentication.LdapAuthenticationHandler"</span>
      <span class="na">p:principalIdAttribute=</span><span class="s">"sAMAccountName"</span>
      <span class="na">c:authenticator-ref=</span><span class="s">"authenticator"</span> <span class="nt">/&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The above configuration attempts to authenticate credentials via an <code class="language-plaintext highlighter-rouge">authenticator</code> to be defined later, and constructs a final CAS authenticated subject based on the <code class="language-plaintext highlighter-rouge">sAMAccountName</code>. The attribute configuration is an optional setting.</p>

<p>The <code class="language-plaintext highlighter-rouge">ldapAuthenticationHandler</code> defined above needs to also be added to the list of available active authentication handlers in the same file:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;util:map</span> <span class="na">id=</span><span class="s">"authenticationHandlersResolvers"</span><span class="nt">&gt;</span>
   ...
   <span class="nt">&lt;entry</span> <span class="na">key-ref=</span><span class="s">"ldapAuthenticationHandler"</span> <span class="na">value-ref=</span><span class="s">"primaryPrincipalResolver"</span> <span class="nt">/&gt;</span>
   ...
<span class="nt">&lt;/util:map&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="attribute-retrieval">Attribute Retrieval</h2>
<p>The <code class="language-plaintext highlighter-rouge">LdapAuthenticationHandler</code> is also capable of resolving and retrieving principal attributes independently without the need for <a href="../integration/Attribute-Resolution.html">extra principal resolver machinery</a>.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"ldapAuthenticationHandler"</span>
<span class="na">class=</span><span class="s">"org.jasig.cas.authentication.LdapAuthenticationHandler"</span>
      <span class="na">p:principalIdAttribute=</span><span class="s">"sAMAccountName"</span>
      <span class="na">c:authenticator-ref=</span><span class="s">"authenticator"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"principalAttributeMap"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;map&gt;</span>
            <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">"displayName"</span> <span class="na">value=</span><span class="s">"simpleName"</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">"mail"</span> <span class="na">value=</span><span class="s">"email"</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">"memberOf"</span> <span class="na">value=</span><span class="s">"membership"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/map&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The above configuration defines a map of attributes. Keys are LDAP attribute names and values are CAS attribute names which allow you to optionally, retrieve a given attribute and release it under a virtual name. (i.e. Retrieve <code class="language-plaintext highlighter-rouge">mail</code> from LDAP and remap/rename it to <code class="language-plaintext highlighter-rouge">email</code> to be released later). If you have no need for this virtual mapping mechanism, you could directly specify the attributes as a list, in which case the above configuration would become:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"ldapAuthenticationHandler"</span>
    <span class="na">class=</span><span class="s">"org.jasig.cas.authentication.LdapAuthenticationHandler"</span>
    <span class="na">p:principalIdAttribute=</span><span class="s">"sAMAccountName"</span>
    <span class="na">c:authenticator-ref=</span><span class="s">"authenticator"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"principalAttributeList"</span><span class="nt">&gt;</span>
       <span class="nt">&lt;list&gt;</span>
          <span class="nt">&lt;value&gt;</span>displayName<span class="nt">&lt;/value&gt;</span>
          <span class="nt">&lt;value&gt;</span>mail<span class="nt">&lt;/value&gt;</span>
          <span class="nt">&lt;value&gt;</span>memberOf<span class="nt">&lt;/value&gt;</span>
       <span class="nt">&lt;/list&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>If you do decide to let the authentication handler retrieve attributes instead of a separate principal resolver, you will need to ensure the linked resolver is made inactive:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;util:map</span> <span class="na">id=</span><span class="s">"authenticationHandlersResolvers"</span><span class="nt">&gt;</span>
   ...
   <span class="nt">&lt;entry</span> <span class="na">key-ref=</span><span class="s">"ldapAuthenticationHandler"</span> <span class="na">value=</span><span class="s">"#{null}"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/util:map&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="schema-declaration">Schema Declaration</h2>
<p>LDAP authentication is declared using a custom schema to reduce configuration noise. Before configuration, ensure that 
the XML configuration file contains the <code class="language-plaintext highlighter-rouge">ldaptive</code> namespace declarations:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">"http://www.springframework.org/schema/beans"</span>
       <span class="na">xmlns:ldaptive=</span><span class="s">"http://www.ldaptive.org/schema/spring-ext"</span>
       <span class="na">xsi:schemaLocation=</span><span class="s">"
       http://www.ldaptive.org/schema/spring-ext
       http://www.ldaptive.org/schema/spring-ext.xsd"</span><span class="nt">&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="directory-authenticator">Directory Authenticator</h2>
<p><code class="language-plaintext highlighter-rouge">LdapAuthenticationHandler</code> authenticates a username/password against an LDAP directory such as Active Directory or OpenLDAP. There are numerous directory architectures and we provide configuration for four common cases:</p>

<ol>
  <li><a href="#active-directory-authentication">Active Directory</a> - Users authenticate with <em>sAMAccountName</em>.</li>
  <li><a href="#ldap-requiring-authenticated-search">Authenticated Search</a> - Manager bind/search followed by user simple bind.</li>
  <li><a href="#ldap-supporting-anonymous-search">Anonymous Search</a> - Anonymous search followed by user simple bind.</li>
  <li><a href="#ldap-supporting-direct-bind">Direct Bind</a> - Compute user DN from format string and perform simple bind.</li>
</ol>

<p>See the <a href="http://www.ldaptive.org/">ldaptive documentation</a> for more information or to accommodate other situations.</p>

<h2 id="active-directory-authentication">Active Directory Authentication</h2>
<p>The following configuration authenticates users with a custom filter,
which requires manager/administrator credentials in most cases. If the filter is left blank,
the authentication is executed by <em>UPN</em> without performing a search. It is
therefore the most performant and secure solution for the typical Active Directory deployment.
Simply copy the configuration to <code class="language-plaintext highlighter-rouge">deployerConfigContext.xml</code> and provide values for property placeholders.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;ldaptive:ad-authenticator</span> <span class="na">id=</span><span class="s">"authenticator"</span>
        <span class="na">ldapUrl=</span><span class="s">"${ldap.url}"</span>
        <span class="na">userFilter=</span><span class="s">"${ldap.authn.searchFilter}"</span>
        <span class="na">bindDn=</span><span class="s">"${ldap.managerDn}"</span>
        <span class="na">bindCredential=</span><span class="s">"${ldap.managerPassword}"</span>
        <span class="na">allowMultipleDns=</span><span class="s">"${ldap.allowMultipleDns:false}"</span>
        <span class="na">connectTimeout=</span><span class="s">"${ldap.connectTimeout}"</span>
        <span class="na">validateOnCheckOut=</span><span class="s">"${ldap.pool.validateOnCheckout}"</span>
        <span class="na">failFastInitialize=</span><span class="s">"true"</span>
        <span class="na">blockWaitTime=</span><span class="s">"${ldap.pool.blockWaitTime}"</span>
        <span class="na">idleTime=</span><span class="s">"${ldap.pool.idleTime}"</span>
        <span class="na">baseDn=</span><span class="s">"${ldap.baseDn}"</span>
        <span class="na">maxPoolSize=</span><span class="s">"${ldap.pool.maxSize}"</span>
        <span class="na">minPoolSize=</span><span class="s">"${ldap.pool.minSize}"</span>
        <span class="na">validatePeriodically=</span><span class="s">"${ldap.pool.validatePeriodically}"</span>
        <span class="na">validatePeriod=</span><span class="s">"${ldap.pool.validatePeriod}"</span>
        <span class="na">prunePeriod=</span><span class="s">"${ldap.pool.prunePeriod}"</span>
        <span class="na">useSSL=</span><span class="s">"${ldap.use.ssl:false}"</span>
        <span class="na">subtreeSearch=</span><span class="s">"${ldap.subtree.search:true}"</span>
        <span class="na">useStartTLS=</span><span class="s">"${ldap.useStartTLS}"</span> <span class="nt">/&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="ldap-authenticated-search">LDAP Authenticated Search</h2>
<p>The following configuration snippet provides a template for LDAP authentication performed with manager credentials
followed by a bind. Copy the configuration to <code class="language-plaintext highlighter-rouge">deployerConfigContext.xml</code> and provide values for property placeholders.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;ldaptive:bind-search-authenticator</span> <span class="na">id=</span><span class="s">"authenticator"</span>
        <span class="na">ldapUrl=</span><span class="s">"${ldap.url}"</span>
        <span class="na">baseDn=</span><span class="s">"${ldap.baseDn}"</span>
        <span class="na">userFilter=</span><span class="s">"${ldap.authn.searchFilter}"</span>
        <span class="na">bindDn=</span><span class="s">"${ldap.managerDn}"</span>
        <span class="na">bindCredential=</span><span class="s">"${ldap.managerPassword}"</span>
        <span class="na">connectTimeout=</span><span class="s">"${ldap.connectTimeout}"</span>
        <span class="na">useStartTLS=</span><span class="s">"${ldap.useStartTLS}"</span>
        <span class="na">blockWaitTime=</span><span class="s">"${ldap.pool.blockWaitTime}"</span>
        <span class="na">maxPoolSize=</span><span class="s">"${ldap.pool.maxSize}"</span>
        <span class="na">allowMultipleDns=</span><span class="s">"${ldap.allowMultipleDns:false}"</span>
        <span class="na">usePasswordPolicy=</span><span class="s">"${ldap.usePpolicy:false}"</span>
        <span class="na">minPoolSize=</span><span class="s">"${ldap.pool.minSize}"</span>
        <span class="na">validateOnCheckOut=</span><span class="s">"${ldap.pool.validateOnCheckout}"</span>
        <span class="na">validatePeriodically=</span><span class="s">"${ldap.pool.validatePeriodically}"</span>
        <span class="na">validatePeriod=</span><span class="s">"${ldap.pool.validatePeriod}"</span>
        <span class="na">idleTime=</span><span class="s">"${ldap.pool.idleTime}"</span>
        <span class="na">prunePeriod=</span><span class="s">"${ldap.pool.prunePeriod}"</span>
        <span class="na">failFastInitialize=</span><span class="s">"true"</span>
        <span class="na">subtreeSearch=</span><span class="s">"${ldap.subtree.search:true}"</span>
        <span class="na">useSSL=</span><span class="s">"${ldap.use.ssl:false}"</span>
<span class="nt">/&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="ldap-anonymous-search">LDAP Anonymous Search</h2>
<p>The following configuration snippet provides a template for LDAP authentication performed with an anonymous search
followed by a bind. Copy the configuration to <code class="language-plaintext highlighter-rouge">deployerConfigContext.xml</code> and provide values for property placeholders.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;ldaptive:anonymous-search-authenticator</span> <span class="na">id=</span><span class="s">"authenticator"</span>
       <span class="na">ldapUrl=</span><span class="s">"${ldap.url}"</span>
       <span class="na">connectTimeout=</span><span class="s">"${ldap.connectTimeout}"</span>
       <span class="na">validateOnCheckOut=</span><span class="s">"${ldap.pool.validateOnCheckout}"</span>
       <span class="na">failFastInitialize=</span><span class="s">"true"</span>
       <span class="na">blockWaitTime=</span><span class="s">"${ldap.pool.blockWaitTime}"</span>
       <span class="na">idleTime=</span><span class="s">"${ldap.pool.idleTime}"</span>
       <span class="na">maxPoolSize=</span><span class="s">"${ldap.pool.maxSize}"</span>
       <span class="na">minPoolSize=</span><span class="s">"${ldap.pool.minSize}"</span>
       <span class="na">validatePeriodically=</span><span class="s">"${ldap.pool.validatePeriodically}"</span>
       <span class="na">validatePeriod=</span><span class="s">"${ldap.pool.validatePeriod}"</span>
       <span class="na">prunePeriod=</span><span class="s">"${ldap.pool.prunePeriod}"</span>
       <span class="na">useSSL=</span><span class="s">"${ldap.use.ssl:false}"</span>
       <span class="na">useStartTLS=</span><span class="s">"${ldap.useStartTLS}"</span>
       <span class="na">usePasswordPolicy=</span><span class="s">"${ldap.usePpolicy:true}"</span>
       <span class="na">allowMultipleDns=</span><span class="s">"${ldap.allowMultipleDns:false}"</span>
       <span class="na">baseDn=</span><span class="s">"${ldap.baseDn}"</span>
       <span class="na">subtreeSearch=</span><span class="s">"${ldap.subtree.search:true}"</span>
       <span class="na">userFilter=</span><span class="s">"${ldap.authn.searchFilter}"</span>
<span class="nt">/&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="ldap-direct-bind">LDAP Direct Bind</h2>
<p>The following configuration snippet provides a template for LDAP authentication where no search is required to
compute the DN needed for a bind operation. There are two requirements for this use case:</p>

<ol>
  <li>All users are under a single branch in the directory, e.g. <code class="language-plaintext highlighter-rouge">ou=Users,dc=example,dc=org</code>.</li>
  <li>The username provided on the CAS login form is part of the DN, e.g. <code class="language-plaintext highlighter-rouge">uid=%s,ou=Users,dc=exmaple,dc=org</code>.</li>
</ol>

<p>Copy the configuration to <code class="language-plaintext highlighter-rouge">deployerConfigContext.xml</code> and provide values for property placeholders.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;ldaptive:direct-authenticator</span> <span class="na">id=</span><span class="s">"authenticator"</span>
        <span class="na">format=</span><span class="s">"${ldap.authn.searchFilter}"</span>
        <span class="na">ldapUrl=</span><span class="s">"${ldap.url}"</span>
        <span class="na">connectTimeout=</span><span class="s">"${ldap.connectTimeout}"</span>
        <span class="na">validateOnCheckOut=</span><span class="s">"${ldap.pool.validateOnCheckout}"</span>
        <span class="na">failFastInitialize=</span><span class="s">"true"</span>
        <span class="na">blockWaitTime=</span><span class="s">"${ldap.pool.blockWaitTime}"</span>
        <span class="na">idleTime=</span><span class="s">"${ldap.pool.idleTime}"</span>
        <span class="na">usePasswordPolicy=</span><span class="s">"${ldap.usePpolicy:false}"</span>
        <span class="na">maxPoolSize=</span><span class="s">"${ldap.pool.maxSize}"</span>
        <span class="na">minPoolSize=</span><span class="s">"${ldap.pool.minSize}"</span>
        <span class="na">validatePeriodically=</span><span class="s">"${ldap.pool.validatePeriodically}"</span>
        <span class="na">validatePeriod=</span><span class="s">"${ldap.pool.validatePeriod}"</span>
        <span class="na">prunePeriod=</span><span class="s">"${ldap.pool.prunePeriod}"</span>
        <span class="na">useSSL=</span><span class="s">"${ldap.use.ssl:false}"</span>
        <span class="na">useStartTLS=</span><span class="s">"${ldap.useStartTLS}"</span> 
<span class="nt">/&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="ldap-provider-configuration">LDAP Provider Configuration</h2>
<p>In certain cases, it may be desirable to use a specific provider implementation when
attempting to establish connections to LDAP. In order to do this, the <code class="language-plaintext highlighter-rouge">authenticator</code>
configuration must be modified to include a reference to the selected provider.</p>

<p>Here’s an example for configuring an UnboundID provider:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>...
<span class="nt">&lt;ldaptive:ad-authenticator</span> <span class="na">id=</span><span class="s">"authenticator"</span>
    <span class="err">...</span>
    <span class="na">provider=</span><span class="s">"org.ldaptive.provider.unboundid.UnboundIDProvider"</span>
    <span class="err">...</span>
<span class="nt">/&gt;</span>
...
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Note that additional dependencies must be available to CAS at runtime depending on the probider, so it’s able to locate the provider implementation and supply that to connections.</p>

<h2 id="ldap-properties-starter">LDAP Properties Starter</h2>
<p>The following LDAP configuration properties provide a reasonable starting point for configuring the LDAP
authentication handler. The <code class="language-plaintext highlighter-rouge">ldap.url</code> property must be changed at a minumum. LDAP properties may be added to the
<code class="language-plaintext highlighter-rouge">cas.properties</code> configuration file; alternatively they may be isolated in an <code class="language-plaintext highlighter-rouge">ldap.properties</code> file and loaded
into the Spring application context by modifying the <code class="language-plaintext highlighter-rouge">propertyFileConfigurer.xml</code> configuration file.</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
</pre></td><td class="rouge-code"><pre><span class="c">#========================================
# General properties
#========================================
</span><span class="py">ldap.url</span><span class="p">=</span><span class="s">ldap://localhost:1389</span>

<span class="c"># Start TLS for SSL connections
</span><span class="py">ldap.useStartTLS</span><span class="p">=</span><span class="s">false</span>

<span class="c"># Directory root DN
</span><span class="py">ldap.rootDn</span><span class="p">=</span><span class="s">dc=example,dc=org</span>

<span class="c"># Base DN of users to be authenticated
</span><span class="py">ldap.baseDn</span><span class="p">=</span><span class="s">ou=people,dc=example,dc=org</span>

<span class="c"># LDAP connection timeout in milliseconds
</span><span class="py">ldap.connectTimeout</span><span class="p">=</span><span class="s">3000</span>

<span class="c"># Manager credential DN
</span><span class="py">ldap.managerDn</span><span class="p">=</span><span class="s">cn=Directory Manager,dc=example,dc=org</span>

<span class="c"># Manager credential password
</span><span class="py">ldap.managerPassword</span><span class="p">=</span><span class="s">Password</span>

<span class="c">#========================================
# LDAP connection pool configuration
#========================================
</span><span class="py">ldap.pool.minSize</span><span class="p">=</span><span class="s">1</span>
<span class="py">ldap.pool.maxSize</span><span class="p">=</span><span class="s">10</span>
<span class="py">ldap.pool.validateOnCheckout</span><span class="p">=</span><span class="s">false</span>
<span class="py">ldap.pool.validatePeriodically</span><span class="p">=</span><span class="s">true</span>

<span class="c"># Amount of time in milliseconds to block on pool exhausted condition
# before giving up.
</span><span class="py">ldap.pool.blockWaitTime</span><span class="p">=</span><span class="s">3000</span>

<span class="c"># Frequency of connection validation in seconds
# Only applies if validatePeriodically=true
</span><span class="py">ldap.pool.validatePeriod</span><span class="p">=</span><span class="s">300</span>

<span class="c"># Attempt to prune connections every N seconds
</span><span class="py">ldap.pool.prunePeriod</span><span class="p">=</span><span class="s">300</span>

<span class="c"># Maximum amount of time an idle connection is allowed to be in
# pool before it is liable to be removed/destroyed
</span><span class="py">ldap.pool.idleTime</span><span class="p">=</span><span class="s">600</span>

<span class="c">#========================================
# Authentication
#========================================
</span><span class="py">ldap.authn.searchFilter</span><span class="p">=</span><span class="s">cn={user}</span>

<span class="c"># Ldap domain used to resolve dn
</span><span class="py">ldap.domain</span><span class="p">=</span><span class="s">example.org</span>

<span class="c"># Should LDAP Password Policy be enabled?
</span><span class="py">ldap.usePpolicy</span><span class="p">=</span><span class="s">false</span>

<span class="c"># Allow multiple DNs during authentication?
</span><span class="py">ldap.allowMultipleDns</span><span class="p">=</span><span class="s">false</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="ldap-password-policy-enforcement">LDAP Password Policy Enforcement</h2>
<p>The purpose of the LPPE is twofold:</p>

<ul>
  <li>Detect a number of scenarios that would otherwise prevent user authentication, specifically using an Ldap instance as the primary source of user accounts.</li>
  <li>Warn users whose account status is near a configurable expiration date and redirect the flow to an external identity management system.</li>
</ul>

<h3 id="reflecting-ldap-account-status">Reflecting LDAP Account Status</h3>
<p>The below scenarios are by default considered errors preventing authentication in a generic manner through the normal CAS login flow. LPPE intercepts the authentication flow, detecting the above standard error codes. Error codes are then translated into proper messages in the CAS login flow and would allow the user to take proper action, fully explaining the nature of the problem.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">ACCOUNT_LOCKED</code></li>
  <li><code class="language-plaintext highlighter-rouge">ACCOUNT_DISABLED</code></li>
  <li><code class="language-plaintext highlighter-rouge">INVALID_LOGON_HOURS</code></li>
  <li><code class="language-plaintext highlighter-rouge">INVALID_WORKSTATION</code></li>
  <li><code class="language-plaintext highlighter-rouge">PASSWORD_MUST_CHANGE</code></li>
  <li><code class="language-plaintext highlighter-rouge">PASSWORD_EXPIRED</code></li>
</ul>

<p>The translation of LDAP errors into CAS workflow is all handled by <a href="http://www.ldaptive.org/docs/guide/authentication/accountstate">ldaptive</a>.</p>

<h3 id="account-expiration-notification">Account Expiration Notification</h3>
<p>LPPE is also able to warn the user when the account is about to expire. The expiration policy is determined through pre-configured Ldap attributes with default values in place.</p>

<div class="alert alert-danger"><strong>No Password Management!</strong><p>LPPE is not about password management. If you are looking for that sort of capability integrating with CAS, you might be interested in:

<ul>
    <li><a href="https://github.com/pwm-project/pwm">PWM Project</a></li>‎
</ul></p></div>

<h2 id="configuration-1">Configuration</h2>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;alias</span> <span class="na">name=</span><span class="s">"ldapPasswordPolicyConfiguration"</span> <span class="na">alias=</span><span class="s">"passwordPolicyConfiguration"</span> <span class="nt">/&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The following settings are applicable:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="c"># password.policy.warnAll=false
# password.policy.warningDays=30
# password.policy.url=https://password.example.edu/change
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>Next, in your <code class="language-plaintext highlighter-rouge">ldapAuthenticationHandler</code> bean, configure the password policy configuration above:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"ldapAuthenticationHandler"</span>
      <span class="na">class=</span><span class="s">"org.jasig.cas.authentication.LdapAuthenticationHandler"</span>
      <span class="na">p:passwordPolicyConfiguration-ref=</span><span class="s">"passwordPolicyConfiguration"</span><span class="nt">&gt;</span>
      ...
<span class="nt">&lt;/bean&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Next, make sure <code class="language-plaintext highlighter-rouge">Authenticator</code> is set to enable/use password policy:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;ldaptive:bind-search-authenticator</span> <span class="na">id=</span><span class="s">"authenticator"</span>
      <span class="err">...</span>
      <span class="na">usePasswordPolicy=</span><span class="s">"${ldap.usePpolicy:true}"</span>
      <span class="err">...</span>
<span class="nt">/&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="components">Components</h3>

<h4 id="defaultaccountstatehandler"><code class="language-plaintext highlighter-rouge">DefaultAccountStateHandler</code></h4>
<p>The default account state handler, that calculates the password expiration warning period,
maps LDAP errors to the CAS workflow.</p>

<h4 id="optionalwarningaccountstatehandler"><code class="language-plaintext highlighter-rouge">OptionalWarningAccountStateHandler</code></h4>
<p>Supports both opt-in and opt-out warnings on a per-user basis.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;alias</span> <span class="na">name=</span><span class="s">"optionalWarningAccountStateHandler"</span> <span class="na">alias=</span><span class="s">"passwordPolicyConfiguration"</span> <span class="nt">/&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="c"># password.policy.warn.attribute.name=attributeName
# password.policy.warn.attribute.value=attributeValue
# password.policy.warn.display.matched=true
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="troubleshooting">Troubleshooting</h2>
<p>To enable additional logging, modify the log4j configuration file to add the following:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;Logger</span> <span class="na">name=</span><span class="s">"org.ldaptive"</span> <span class="na">level=</span><span class="s">"debug"</span> <span class="na">additivity=</span><span class="s">"false"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;AppenderRef</span> <span class="na">ref=</span><span class="s">"console"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;AppenderRef</span> <span class="na">ref=</span><span class="s">"file"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/Logger&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

                </div>
            </section>
        </main>
    </div>
</div>


<footer>
    <div class="container">
        CAS is supported by the <a href="https://www.apereo.org/">Apereo Foundation</a>.
    </div>
</footer>

<script>
    let pageSection = '';
</script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.3.2/js/tether.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js"></script>

<script src="../../javascripts/URI.js"></script>
<script src="../../javascripts/main.js"></script>

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script>
<script type="text/javascript" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
</body>

</html>
