<!DOCTYPE html>
<html>

<head>
    <!-- Required meta tags always come first -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="CAS - Enterprise Single Sign-On for the Web"/>
    <meta name="keywords" content="authentication, login, cas, central authentication service, web, java, protocol, thymeleaf,
                   open source, boot, spring, authorization, google, facebook, twitter, higher-ed, enterprise,
                   access management, single signon, sso, RBAC, ABAC, attributes, SAML, OpenID, openid connect,
                   JWT, ADFS"/>
    <meta name="robots" content="index,follow"/>

    
    

        
    


    

    <script>
        ((i, s, o, g, r, a, m) => {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-83384532-2', 'auto');
        ga('send', 'pageview');

    </script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3"/>

    <link rel="stylesheet" type="text/css" media="screen" href="../../stylesheets/stylesheet.css">
    <link rel="stylesheet" type="text/css" media="print" href="../../stylesheets/print.css">

    <link href='https://fonts.googleapis.com/css?family=Lato:400,300,700' rel='stylesheet'>
    <link href='https://fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic&subset=latin-ext,latin' rel='stylesheet'>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@100;200;300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css" rel="stylesheet">

    <title>CAS - Logging Configuration</title>

</head>

<body>
<!-- HEADER -->
<header class="hidden-sm-down">
    <div class="container">
        <div class="row">
            <div class="col-xs-4 col-md-2">
                <a href="../../index.html">
                    <img class="undecorated" src="../../images/cas_logo.png"/>
                </a>
            </div>
            <div class="col-xs-8 col-md-6">
                <h1>Enterprise Single Sign-On for All</h1>
            </div>
            <div class="hidden-sm-down col-md-4">
                <a id="forkme_banner" href="https://github.com/apereo/cas">View on GitHub</a>
            </div>

        </div>
    </div>
</header>

<!-- NAVBAR -->

<nav class="navbar navbar-expand-md navbar-dark bg-primary bg-dark">
    <div class="container">
        <button class="navbar-toggler collapsed" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarsExample04" aria-controls="navbarsExample04" aria-expanded="false"
                aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="navbar-collapse collapse" id="navbarsExample04">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active"><a href="../../index.html" class="zoom nav-link">Home</a></li>
                <li class="nav-item"><a href="https://github.com/apereo/cas/releases" class="zoom nav-link">Releases</a></li>
                <li class="nav-item"><a href="../../Support.html" class="zoom nav-link">Support</a></li>
                <li class="nav-item"><a href="../../Mailing-Lists.html" class="zoom nav-link">Mailing Lists</a></li>
                <li class="nav-item">
                    <a class="zoom nav-link" href="../../Demos.html">Demos</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="zoom nav-link dropdown-toggle mr-md-2" href="#" id="cas-versions" data-bs-toggle="dropdown"
                       aria-haspopup="true" aria-expanded="false">Versions</a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="cas-versions">
                        
                        
                        <a class="dropdown-item" href="/cas/development/">Development</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.6.x/">v6.6.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.5.x/">v6.5.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.4.x/">v6.4.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.3.x/">v6.3.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.2.x/">v6.2.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.1.x/">v6.1.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.0.x/">v6.0.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.3.x/">v5.3.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.2.x/">v5.2.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.1.x/">v5.1.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.0.x/">v5.0.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/4.2.x/">v4.2.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/4.1.x/">v4.1.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/4.0.x/">v4.0.x</a>
                        
                        

                    </div>
                </li>
                <li class="nav-item"><a href="https://apereo.github.io" target="_blank" class="zoom nav-link">Blog</a></li>
            </ul>

        </div>

    </div>
</nav>


<div class="container-fluid">
    <div class="row flex-xl-nowrap">
        <div class="col-12 col-md-3 col-xl-2 docs-sidebar pb-5" id="sidebar"></div>


        <div class="d-none d-xl-block col-xl-2 docs-toc">
    <div id="pageContents">
        <ul class="section-nav"></ul>
    </div>
</div>


        <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 cas-docs-content" role="main">


            

            <section>
                <nav id="docsNavBar">
                    <span id="toolbarIcons"></span>
                </nav>

                <div id="cas-docs-container">
                    <h1 id="logging">Logging</h1>
<p>CAS provides a logging facility that logs important informational events like authentication success and
failure; it can be customized to produce additional information for troubleshooting. CAS uses the Slf4J
Logging framework as a facade for the <a href="http://logging.apache.orgâ€Ž">Log4J engine</a> by default.</p>

<p>The log4j configuration file is located in <code class="language-plaintext highlighter-rouge">WEB-INF/classes/log4j2.xml</code>.
By default logging is set to <code class="language-plaintext highlighter-rouge">INFO</code> for all functionality related to <code class="language-plaintext highlighter-rouge">org.jasig.cas</code> code and <code class="language-plaintext highlighter-rouge">WARN</code> for
messages related to Spring framework, etc. For debugging and diagnostic purposes you may want to set
these levels to  <code class="language-plaintext highlighter-rouge">DEBUG</code>.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre>...

<span class="nt">&lt;AsyncLogger</span> <span class="na">name=</span><span class="s">"org.jasig"</span> <span class="na">level=</span><span class="s">"info"</span> <span class="na">additivity=</span><span class="s">"false"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;AppenderRef</span> <span class="na">ref=</span><span class="s">"console"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;AppenderRef</span> <span class="na">ref=</span><span class="s">"file"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/AsyncLogger&gt;</span>

<span class="nt">&lt;AsyncLogger</span> <span class="na">name=</span><span class="s">"org.springframework"</span> <span class="na">level=</span><span class="s">"warn"</span> <span class="nt">/&gt;</span>
...
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="alert alert-warning"><strong>Usage Warning!</strong><p>When in production though,
you probably want to run them both as `WARN`.</p></div>

<h2 id="configuration">Configuration</h2>
<p>It is often helpful to externalize <code class="language-plaintext highlighter-rouge">log4j2.xml</code> to a system path to preserve settings between upgrades.
The location of <code class="language-plaintext highlighter-rouge">log4j2.xml</code> file by default is on the runtime classpath. 
These may be overridden via the following system property passed to the container:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nt">-Dlog4j</span>.configurationFile<span class="o">=</span>/etc/cas/log4j2.xml
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">log4j2.xml</code> file by default at <code class="language-plaintext highlighter-rouge">WEB-INF/classes</code> provides the following <code class="language-plaintext highlighter-rouge">appender</code> elements that
decide where and how messages from components should be displayed. Two are provided by default that
output messages to the system console and a <code class="language-plaintext highlighter-rouge">cas.log</code> file:</p>

<h3 id="multiple-logger-bindings">Multiple Logger Bindings</h3>
<p>CAS by default attempts to scan the runtime application context looking for suitable logger frameworks. 
By default, the framework that is chosen is Log4j. If there are multiple logging frameworks found 
on the application classpath at runtime, you can instruct CAS to specifically select Log4j as the logging framework
via the following property passed to the JVM runtime instance:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nt">-DloggerFactory</span><span class="o">=</span><span class="s2">"org.apache.logging.slf4j.Log4jLoggerFactory"</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="alternative-loggers">Alternative Loggers</h3>
<p>If you wish to use an alternative logging framework other than Log4j, you will need to exclude
all <code class="language-plaintext highlighter-rouge">log4j</code> JAR artifacts and the <code class="language-plaintext highlighter-rouge">cas-server-core-logging</code> module from your configuration. Ensure
an alternative framework such as Logback is provided instead to the application runtime and the necessary
configuration is available per the framework.</p>

<h3 id="refresh-interval">Refresh Interval</h3>
<p>The <code class="language-plaintext highlighter-rouge">log4j2.xml</code> itself controls the refresh interval of the logging configuration. Log4j has the ability
to automatically detect changes to the configuration file and reconfigure itself. If the <code class="language-plaintext highlighter-rouge">monitorInterval</code>
attribute is specified on the configuration element and is set to a non-zero value then the file will be
checked the next time a log event is evaluated and/or logged and the <code class="language-plaintext highlighter-rouge">monitorInterval</code> has elapsed since
the last check. This will allow you to adjust the log levels and configuration without restarting the
server environment.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="c">&lt;!-- Specify the refresh internal in seconds. --&gt;</span>
<span class="nt">&lt;Configuration</span> <span class="na">monitorInterval=</span><span class="s">"60"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Appenders&gt;</span>
        ...
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="appenders">Appenders</h3>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;Console</span> <span class="na">name=</span><span class="s">"console"</span> <span class="na">target=</span><span class="s">"SYSTEM_OUT"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;PatternLayout</span> <span class="na">pattern=</span><span class="s">"%d %p [%c] - &amp;lt;%m&amp;gt;%n"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/Console&gt;</span>
<span class="nt">&lt;RollingFile</span> <span class="na">name=</span><span class="s">"file"</span> <span class="na">fileName=</span><span class="s">"cas.log"</span> <span class="na">append=</span><span class="s">"true"</span>
             <span class="na">filePattern=</span><span class="s">"cas-%d{yyyy-MM-dd-HH}-%i.log"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;PatternLayout</span> <span class="na">pattern=</span><span class="s">"%d %p [%c] - %m%n"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Policies&gt;</span>
        <span class="nt">&lt;OnStartupTriggeringPolicy</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;SizeBasedTriggeringPolicy</span> <span class="na">size=</span><span class="s">"10 MB"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;TimeBasedTriggeringPolicy</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/Policies&gt;</span>
<span class="nt">&lt;/RollingFile&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="asyncloggers">AsyncLoggers</h3>
<p>Additional AsyncLoggers are available to specify the logging level for component categories.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;AsyncLogger</span> <span class="na">name=</span><span class="s">"org.jasig"</span> <span class="na">level=</span><span class="s">"info"</span> <span class="na">additivity=</span><span class="s">"false"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;AppenderRef</span> <span class="na">ref=</span><span class="s">"console"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;AppenderRef</span> <span class="na">ref=</span><span class="s">"file"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/AsyncLogger&gt;</span>
<span class="nt">&lt;AsyncLogger</span> <span class="na">name=</span><span class="s">"org.springframework"</span> <span class="na">level=</span><span class="s">"warn"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;AsyncLogger</span> <span class="na">name=</span><span class="s">"org.springframework.webflow"</span> <span class="na">level=</span><span class="s">"warn"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;AsyncLogger</span> <span class="na">name=</span><span class="s">"org.springframework.web"</span> <span class="na">level=</span><span class="s">"warn"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;AsyncLogger</span> <span class="na">name=</span><span class="s">"org.springframework.security"</span> <span class="na">level=</span><span class="s">"warn"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;AsyncLogger</span> <span class="na">name=</span><span class="s">"org.jasig.cas.web.flow"</span> <span class="na">level=</span><span class="s">"info"</span> <span class="na">additivity=</span><span class="s">"true"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;AppenderRef</span> <span class="na">ref=</span><span class="s">"file"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/AsyncLogger&gt;</span>
<span class="nt">&lt;AsyncLogger</span> <span class="na">name=</span><span class="s">"org.jasig.inspektr.audit.support"</span> <span class="na">level=</span><span class="s">"info"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;AppenderRef</span> <span class="na">ref=</span><span class="s">"file"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/AsyncLogger&gt;</span>
<span class="nt">&lt;Root</span> <span class="na">level=</span><span class="s">"error"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;AppenderRef</span> <span class="na">ref=</span><span class="s">"console"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/Root&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>If you wish enable another package for logging, you can simply add another <code class="language-plaintext highlighter-rouge">AsyncLogger</code>
element to the configuration. Here is an example:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;AsyncLogger</span> <span class="na">name=</span><span class="s">"org.ldaptive"</span> <span class="na">level=</span><span class="s">"debug"</span> <span class="na">additivity=</span><span class="s">"false"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;AppenderRef</span> <span class="na">ref=</span><span class="s">"console"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;AppenderRef</span> <span class="na">ref=</span><span class="s">"file"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/AsyncLogger&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="log-data-sanitation">Log Data Sanitation</h2>
<p>For security purposes, CAS by default will attempt to remove TGT and PGT ids from all log data.
This will of course include messages that are routed to a log destination by the logging framework as
 well as all audit messages. A sample follows below:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="o">=============================================================</span>
WHO: audit:unknown
WHAT: TGT-<span class="k">****************************************************</span>123456-cas01.example.org
ACTION: TICKET_GRANTING_TICKET_DESTROYED
APPLICATION: CAS
WHEN: Sat Jul 12 04:10:35 PDT 2014
CLIENT IP ADDRESS: ...
SERVER IP ADDRESS: ...
<span class="o">=============================================================</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Certain number of characters are left at the trailing end of the ticket id to assist with
troubleshooting and diagnostics. This is achieved by providing a specific binding for the SLF4j configuration.</p>

<h2 id="asyncloggers-shutdown-with-tomcat">AsyncLoggers Shutdown with Tomcat</h2>

<p>Log4j automatically inserts itself into the runtime application context in a Servlet 3 environment (i.e. Tomcat 8.x) and will clean up 
the logging context once the container is instructed to shut down. However, Tomcat ignores all JAR files named <code class="language-plaintext highlighter-rouge">log4j*.jar</code>, which prevents 
this feature from working. You may need to change the <code class="language-plaintext highlighter-rouge">catalina.properties</code> and remove <code class="language-plaintext highlighter-rouge">log4j*.jar</code> from the <code class="language-plaintext highlighter-rouge">jarsToSkip</code> property. 
You may need to do something similar on other containers if they skip scanning Log4j JAR files.</p>

<p>Failure to do so will stop Tomcat to gracefully shut down and causes logger context threads to hang.</p>

                </div>
            </section>
        </main>
    </div>
</div>


<footer>
    <div class="container">
        CAS is supported by the <a href="https://www.apereo.org/">Apereo Foundation</a>.
    </div>
</footer>

<script>
    let pageSection = '';
</script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.3.2/js/tether.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js"></script>

<script src="../../javascripts/URI.js"></script>
<script src="../../javascripts/main.js"></script>

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script>
<script type="text/javascript" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
</body>

</html>
