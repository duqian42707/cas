<!DOCTYPE html>
<html>

<head>
    <!-- Required meta tags always come first -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="CAS - Enterprise Single Sign-On for the Web"/>
    <meta name="keywords" content="authentication, login, cas, central authentication service, web, java, protocol, thymeleaf,
                   open source, boot, spring, authorization, google, facebook, twitter, higher-ed, enterprise,
                   access management, single signon, sso, RBAC, ABAC, attributes, SAML, OpenID, openid connect,
                   JWT, ADFS"/>
    <meta name="robots" content="index,follow"/>

    
    

        
    


    

    <script>
        ((i, s, o, g, r, a, m) => {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-83384532-2', 'auto');
        ga('send', 'pageview');

    </script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3"/>

    <link rel="stylesheet" type="text/css" media="screen" href="../../stylesheets/stylesheet.css">
    <link rel="stylesheet" type="text/css" media="print" href="../../stylesheets/print.css">

    <link href='https://fonts.googleapis.com/css?family=Lato:400,300,700' rel='stylesheet'>
    <link href='https://fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic&subset=latin-ext,latin' rel='stylesheet'>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@100;200;300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css" rel="stylesheet">

    <title>CAS - ClearPass</title>

</head>

<body>
<!-- HEADER -->
<header class="hidden-sm-down">
    <div class="container">
        <div class="row">
            <div class="col-xs-4 col-md-2">
                <a href="../../index.html">
                    <img class="undecorated" src="../../images/cas_logo.png"/>
                </a>
            </div>
            <div class="col-xs-8 col-md-6">
                <h1>Enterprise Single Sign-On for All</h1>
            </div>
            <div class="hidden-sm-down col-md-4">
                <a id="forkme_banner" href="https://github.com/apereo/cas">View on GitHub</a>
            </div>

        </div>
    </div>
</header>

<!-- NAVBAR -->

<nav class="navbar navbar-expand-md navbar-dark bg-primary bg-dark">
    <div class="container">
        <button class="navbar-toggler collapsed" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarsExample04" aria-controls="navbarsExample04" aria-expanded="false"
                aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="navbar-collapse collapse" id="navbarsExample04">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active"><a href="../../index.html" class="zoom nav-link">Home</a></li>
                <li class="nav-item"><a href="https://github.com/apereo/cas/releases" class="zoom nav-link">Releases</a></li>
                <li class="nav-item"><a href="../../Support.html" class="zoom nav-link">Support</a></li>
                <li class="nav-item"><a href="../../Mailing-Lists.html" class="zoom nav-link">Mailing Lists</a></li>
                <li class="nav-item">
                    <a class="zoom nav-link" href="../../Demos.html">Demos</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="zoom nav-link dropdown-toggle mr-md-2" href="#" id="cas-versions" data-bs-toggle="dropdown"
                       aria-haspopup="true" aria-expanded="false">Versions</a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="cas-versions">
                        
                        
                        <a class="dropdown-item" href="/cas/development/">Development</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.6.x/">v6.6.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.5.x/">v6.5.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.4.x/">v6.4.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.3.x/">v6.3.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.2.x/">v6.2.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.1.x/">v6.1.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.0.x/">v6.0.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.3.x/">v5.3.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.2.x/">v5.2.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.1.x/">v5.1.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.0.x/">v5.0.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/4.2.x/">v4.2.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/4.1.x/">v4.1.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/4.0.x/">v4.0.x</a>
                        
                        

                    </div>
                </li>
                <li class="nav-item"><a href="https://apereo.github.io" target="_blank" class="zoom nav-link">Blog</a></li>
            </ul>

        </div>

    </div>
</nav>


<div class="container-fluid">
    <div class="row flex-xl-nowrap">
        <div class="col-12 col-md-3 col-xl-2 docs-sidebar pb-5" id="sidebar"></div>


        <div class="d-none d-xl-block col-xl-2 docs-toc">
    <div id="pageContents">
        <ul class="section-nav"></ul>
    </div>
</div>


        <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 cas-docs-content" role="main">


            

            <section>
                <nav id="docsNavBar">
                    <span id="toolbarIcons"></span>
                </nav>

                <div id="cas-docs-container">
                    <h1 id="clearpass-credential-caching-and-replay">ClearPass: Credential Caching and Replay</h1>

<div class="alert alert-warning"><strong>Deprecated!</strong><p>Exercising ClearPass via the architecture and configuration that is described below is <strong>deprecated</strong>. Consider <a href="ClearPass.html">using the alternative</a> that would allow adopters to consume the credential directly in the CAS validation response.</p></div>

<p>To enable single sign-on into some legacy application it may be necessary to provide them with the actual cleartext password. While such approach inevitably increases security risk, at times this may be a necessary evil in order to integrate applications with CAS.</p>

<div class="alert alert-warning"><strong>Usage Warning!</strong><p>ClearPass is turned off by default. No applications will be able to obtain the user credentials unless ClearPass is explicitly turned on by the below configuration.</p></div>

<h2 id="architecture">Architecture</h2>

<p>A service may obtain cleartext credentials for an authenticated user by presenting a valid proxy ticket obtained specifically for the CAS cleartext extension service end-point that is ClearPass. Tickets issued for a ClearPass response are validated in the same way you would access a traditional proxied service. ClearPass ensures this by just being another CAS Client. Credentials are cached inside an Ehcache-backed map with support for encryption of the obtained password in memory.</p>

<p>Upon receiving the request, ClearPass ensures that the following validation criteria are met:</p>

<ul>
  <li>The proxy ticket was obtained for the URL specifying location of the ClearPass service</li>
  <li>The proxy is valid according to standard CAS spec</li>
  <li>The proxy ticket is indeed a proxy ticket, not a service ticket</li>
  <li>Each member of the proxy chain has been given explicit permission to receive cleartext credentials</li>
</ul>

<h2 id="validation-responses">Validation Responses</h2>

<p>Upon successful validation the ClearPass service provides credentials in the following response:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;cas:clearPassResponse</span> <span class="na">xmlns:cas=</span><span class="s">'http://www.yale.edu/tp/cas'</span><span class="nt">&gt;</span>
    <span class="nt">&lt;cas:clearPassSuccess&gt;</span>
        <span class="nt">&lt;cas:credentials&gt;</span>actual_password<span class="nt">&lt;/cas:credentials&gt;</span>
    <span class="nt">&lt;/cas:clearPassSuccess&gt;</span>
<span class="nt">&lt;/cas:clearPassResponse&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>If the validation fails, the traditional response is a 403 Status code being returned. If there are failures for any other reason other than authorization, the following error response is returned:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;cas:clearPassResponse</span> <span class="na">xmlns:cas=</span><span class="s">'http://www.yale.edu/tp/cas'</span><span class="nt">&gt;</span>
    <span class="nt">&lt;cas:clearPassFailure&gt;</span>description of the problem<span class="nt">&lt;/cas:clearPassFailure&gt;</span>
<span class="nt">&lt;/cas:clearPassResponse&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="components">Components</h2>

<p>Support is enabled by including the following dependency in the Maven WAR overlay:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.jasig.cas<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>cas-server-extension-clearpass<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>${cas.version}<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework.security<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-security-config<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>${spring.version}<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework.security<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-security-web<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>${spring.version}<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

...

<span class="nt">&lt;properties&gt;</span>
    <span class="nt">&lt;spring.version&gt;</span>4.0.4.RELEASE<span class="nt">&lt;/spring.version&gt;</span>
<span class="nt">&lt;/properties&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="single-node-configuration">Single Node Configuration</h2>

<h3 id="allow-credential-caching">Allow Credential Caching</h3>

<p>Update <code class="language-plaintext highlighter-rouge">deployerConfigContext.xml</code> to match the following:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;util:list</span> <span class="na">id=</span><span class="s">"authenticationMetadataPopulators"</span><span class="nt">&gt;</span>
...
    <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">"org.jasig.cas.extension.clearpass.CacheCredentialsMetaDataPopulator"</span>
      <span class="na">c:credentialCache-ref=</span><span class="s">"encryptedMap"</span> <span class="nt">/&gt;</span>
...
<span class="nt">&lt;/util:list&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="enable-clearpass-endpoints">Enable ClearPass Endpoints</h3>

<p>In your Maven overlay, modify the <code class="language-plaintext highlighter-rouge">web.xml</code> to include the following:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;servlet-mapping&gt;</span>
  <span class="nt">&lt;servlet-name&gt;</span>cas<span class="nt">&lt;/servlet-name&gt;</span>
  <span class="nt">&lt;url-pattern&gt;</span>/clearPass<span class="nt">&lt;/url-pattern&gt;</span>
<span class="nt">&lt;/servlet-mapping&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Be sure to put this snippet with the other servlet-mappings.</p>

<p>Next, add the following filter and filter-mapping:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;filter&gt;</span>
  <span class="nt">&lt;filter-name&gt;</span>clearPassFilterChainProxy<span class="nt">&lt;/filter-name&gt;</span>
  <span class="nt">&lt;filter-class&gt;</span>org.springframework.web.filter.DelegatingFilterProxy<span class="nt">&lt;/filter-class&gt;</span>
<span class="nt">&lt;/filter&gt;</span>
 
<span class="nt">&lt;filter-mapping&gt;</span>
  <span class="nt">&lt;filter-name&gt;</span>clearPassFilterChainProxy<span class="nt">&lt;/filter-name&gt;</span>
  <span class="nt">&lt;url-pattern&gt;</span>/clearPass<span class="nt">&lt;/url-pattern&gt;</span>
<span class="nt">&lt;/filter-mapping&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Be sure to put this snippet with the other filter and filter-mappings.</p>

<h3 id="configure-clearpass">Configure ClearPass</h3>

<p>Obtain a copy of the <a href="https://github.com/apereo/cas/blob/4.2.x/cas-server-webapp/src/main/webapp/WEB-INF/unused-spring-configuration/clearpass-configuration.xml"><code class="language-plaintext highlighter-rouge">clearpass-configuration.xml</code></a>
file inside the <code class="language-plaintext highlighter-rouge">WEB-INF/unused-spring-configuration</code> of the project. Place that in your project’s <code class="language-plaintext highlighter-rouge">WEB-INF/spring-configuration</code> directory.</p>

<p>Next, declare the following bean inside the file:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"clearPassProxyList"</span> <span class="na">class=</span><span class="s">"org.jasig.cas.client.validation.ProxyList"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;constructor-arg&gt;</span>
        <span class="nt">&lt;list&gt;</span>
            <span class="nt">&lt;value&gt;</span>https://proxy.server.edu/uPortal/CasProxyServlet<span class="nt">&lt;/value&gt;</span>
            <span class="nt">&lt;value&gt;</span>...<span class="nt">&lt;/value&gt;</span>
        <span class="nt">&lt;/list&gt;</span>
    <span class="nt">&lt;/constructor-arg&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The above bean defines the list of proxying services authorized to obtain ClearPass credentials. Also note that
proxy urls in the above list have to be fully specified and must produce an exact match. Otherwise, the CAS server
will report back that the proxy chain is invalid for the requesting proxy url.</p>

<p>Alternatively, you may replace:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"allowedProxyChains"</span> <span class="na">ref=</span><span class="s">"clearPassProxyList"</span> <span class="nt">/&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>with:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"acceptAnyProxy"</span> <span class="na">value=</span><span class="s">"true"</span> <span class="nt">/&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>…to allow all proxying services to be able to obtain ClearPass credentials.</p>

<div class="alert alert-warning"><strong>Usage Warning!</strong><p>It's not appropriate in your environment to allow any service that can obtain a proxy ticket to proxy to ClearPass. Explicitly authorizing proxy chains to access ClearPass (and denying all unauthorized proxy chains) is an important access control on release of the end-user's password.</p></div>

<h3 id="change-ticket-registry">Change Ticket Registry</h3>

<p>Change your <code class="language-plaintext highlighter-rouge">deployerConfigContext.xml</code> file to match the following:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;alias</span> <span class="na">name=</span><span class="s">"defaultTicketRegistry"</span> <span class="na">alias=</span><span class="s">"ticketRegistryValue"</span> <span class="nt">/&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="web-session-configuration">Web Session Configuration</h3>

<p>You must make sure your <code class="language-plaintext highlighter-rouge">web.xml</code> contains the following XML piece:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;session-config&gt;</span>
    <span class="c">&lt;!-- Default to 5 minute session timeouts --&gt;</span>
    <span class="nt">&lt;session-timeout&gt;</span>5<span class="nt">&lt;/session-timeout&gt;</span>
<span class="nt">&lt;/session-config&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>By default, <code class="language-plaintext highlighter-rouge">COOKIE</code> tracking mode is turned on with an <code class="language-plaintext highlighter-rouge">http-only</code> configuration. Those need to be removed.</p>

<h2 id="multiple-nodes-configuration">Multiple Nodes Configuration</h2>

<p>ClearPass stores the password information it collects in a non-distributed EhCache-based Map. This works fine in single-server CAS environments but causes issues in multi-server CAS environments. In a normal multi-server CAS environment you would use a distributed ticket registry like Memcache or EhCache so that all CAS servers would have knowledge of all the tickets. After the distributed Ticket Registry is setup you should replace ClearPass’s default in-memory Map with a Map implemenation that matches your ticket registry.</p>

<h3 id="ehcache-based-map">EhCache-based Map</h3>

<p>By default ClearPass is setup to use a non-distrbuted EhCache to store its passwords. If you are using EhCache you will want to ensure that your ehcacheClearPass.xml file is setup to replicate the ClearPass Ehcache to all your CAS servers.</p>

<h4 id="configuration">Configuration</h4>

<h5 id="sample-clearpass-configurationxml">Sample <code class="language-plaintext highlighter-rouge">clearpass-configuration.xml</code></h5>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
</pre></td><td class="rouge-code"><pre><span class="c">&lt;!--  Credentials Cache implementation --&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"ehCacheManager"</span> <span class="na">class=</span><span class="s">"org.springframework.cache.ehcache.EhCacheManagerFactoryBean"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"configLocation"</span> <span class="na">value=</span><span class="s">"file:/etc/cas/clearpass-replicated.xml"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"shared"</span> <span class="na">value=</span><span class="s">"false"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"cacheManagerName"</span> <span class="na">value=</span><span class="s">"clearPassEhCacheManager"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"clearPassEhCache"</span> <span class="na">class=</span><span class="s">"org.springframework.cache.ehcache.EhCacheFactoryBean"</span>
    <span class="na">p:cacheManager-ref=</span><span class="s">"ehCacheManager"</span>
    <span class="na">p:bootstrapCacheLoader-ref=</span><span class="s">"ticketCacheBootstrapCacheLoader"</span> 
    <span class="na">p:cacheEventListeners-ref=</span><span class="s">"ticketRMISynchronousCacheReplicator"</span>
    <span class="na">p:cacheName=</span><span class="s">"org.jasig.cas.extension.clearpass.CACHE"</span>
    <span class="na">p:timeToIdle=</span><span class="s">"7201"</span>
    <span class="na">p:timeToLive=</span><span class="s">"7201"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"ticketRMISynchronousCacheReplicator"</span> <span class="na">class=</span><span class="s">"net.sf.ehcache.distribution.RMISynchronousCacheReplicator"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">"replicatePuts"</span> <span class="na">value=</span><span class="s">"true"</span><span class="nt">/&gt;</span> 
    <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">"replicatePutsViaCopy"</span> <span class="na">value=</span><span class="s">"true"</span><span class="nt">/&gt;</span> 
    <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">"replicateUpdates"</span> <span class="na">value=</span><span class="s">"true"</span><span class="nt">/&gt;</span>  
    <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">"replicateUpdatesViaCopy"</span> <span class="na">value=</span><span class="s">"true"</span><span class="nt">/&gt;</span>  
    <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">"replicateRemovals"</span> <span class="na">value=</span><span class="s">"true"</span><span class="nt">/&gt;</span>       
<span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"ticketCacheBootstrapCacheLoader"</span> <span class="na">class=</span><span class="s">"net.sf.ehcache.distribution.RMIBootstrapCacheLoader"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">"asynchronous"</span> <span class="na">value=</span><span class="s">"true"</span><span class="nt">/&gt;</span>  
    <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">"maximumChunkSize"</span> <span class="na">value=</span><span class="s">"5000000"</span><span class="nt">/&gt;</span>  
<span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"credentialsCache"</span> <span class="na">class=</span><span class="s">"org.jasig.cas.extensions.clearpass.EhcacheBackedMap"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">"0"</span> <span class="na">ref=</span><span class="s">"clearPassEhCache"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"ticketRegistry"</span> <span class="na">class=</span><span class="s">"org.jasig.cas.extensions.clearpass.TicketRegistryDecorator"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">"0"</span> <span class="na">ref=</span><span class="s">"ticketRegistryValue"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">"1"</span> <span class="na">ref=</span><span class="s">"credentialsCache"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="c">&lt;!-- implementation of the clear pass vending service --&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"clearPassController"</span> <span class="na">class=</span><span class="s">"org.jasig.cas.extensions.clearpass.ClearPassController"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">"0"</span> <span class="na">ref=</span><span class="s">"credentialsCache"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"handlerMappingClearPass"</span> <span class="na">class=</span><span class="s">"org.springframework.web.servlet.handler.SimpleUrlHandlerMapping"</span>
    <span class="na">p:alwaysUseFullPath=</span><span class="s">"true"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"mappings"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;props&gt;</span>
            <span class="nt">&lt;prop</span> <span class="na">key=</span><span class="s">"/clearPass"</span><span class="nt">&gt;</span>
                clearPassController
            <span class="nt">&lt;/prop&gt;</span>
        <span class="nt">&lt;/props&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h5 id="sample-clearpass-replicatedxml">Sample <code class="language-plaintext highlighter-rouge">clearpass-replicated.xml</code></h5>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;ehcache</span> <span class="na">name=</span><span class="s">"clearPassEhCacheManager"</span> <span class="na">updateCheck=</span><span class="s">"false"</span> 
        <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span> 
         <span class="na">xsi:noNamespaceSchemaLocation=</span><span class="s">"http://ehcache.sf.net/ehcache.xsd"</span><span class="nt">&gt;</span>

   <span class="nt">&lt;diskStore</span> <span class="na">path=</span><span class="s">"java.io.tmpdir/cas"</span><span class="nt">/&gt;</span>
    
     <span class="nt">&lt;cacheManagerPeerProviderFactory</span> 
                <span class="na">class=</span><span class="s">"net.sf.ehcache.distribution.RMICacheManagerPeerProviderFactory"</span>
                <span class="na">properties=</span><span class="s">"peerDiscovery=manual,
                rmiUrls=//10.1.1.123:40002/org.jasig.cas.extension.clearpass.CACHE"</span> <span class="nt">/&gt;</span>
   
   <span class="c">&lt;!-- Port where it listens for peers. Should be different from peer provider port defined above --&gt;</span>
   <span class="nt">&lt;cacheManagerPeerListenerFactory</span> 
            <span class="na">class=</span><span class="s">"net.sf.ehcache.distribution.RMICacheManagerPeerListenerFactory"</span>
            <span class="na">properties=</span><span class="s">"port=40002"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/ehcache&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Note that the above uses manual peer discovery with RMI replication to transfer cached objects that are obtained by ClearPass. 
The IP addresses need to be changed for each CAS node to point to each other.</p>

<h3 id="memcached--map">Memcached  Map</h3>
<p>The spymemcached java client includes a Memcached Map implementation called <code class="language-plaintext highlighter-rouge">CacheMap</code>.</p>

<h4 id="configuration-1">Configuration</h4>

<h5 id="sample-clearpass-configurationxml-1">Sample <code class="language-plaintext highlighter-rouge">clearpass-configuration.xml</code></h5>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"CPserialTranscoder"</span> <span class="na">class=</span><span class="s">"net.spy.memcached.transcoders.SerializingTranscoder"</span>
    <span class="na">p:compressionThreshold=</span><span class="s">"2048"</span> <span class="nt">/&gt;</span>
     
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"memcachedMap"</span> <span class="na">class=</span><span class="s">"net.spy.memcached.CacheMap"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">"0"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">"net.spy.memcached.spring.MemcachedClientFactoryBean"</span>
          <span class="na">p:servers=</span><span class="s">"memcache1.college.edu:11211,memcache2.college.edu:11211"</span>
          <span class="na">p:protocol=</span><span class="s">"BINARY"</span>
          <span class="na">p:locatorType=</span><span class="s">"ARRAY_MOD"</span>
          <span class="na">p:failureMode=</span><span class="s">"Redistribute"</span>
          <span class="na">p:transcoder-ref=</span><span class="s">"CPserialTranscoder"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"hashAlg"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;util:constant</span> <span class="na">static-field=</span><span class="s">"net.spy.memcached.DefaultHashAlgorithm.FNV1A_64_HASH"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>
  <span class="nt">&lt;/constructor-arg&gt;</span>
  <span class="c">&lt;!-- this is the timeout for the cache in seconds --&gt;</span>
  <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">"1"</span> <span class="na">value=</span><span class="s">"7200"</span> <span class="nt">/&gt;</span>
  <span class="c">&lt;!-- this is the prefix for the keys stored in the map --&gt;</span> 
  <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">"2"</span> <span class="na">value=</span><span class="s">"clearPass_"</span> <span class="nt">/&gt;</span> 
<span class="nt">&lt;/bean&gt;</span>  
 
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"credentialsCache"</span> <span class="na">class=</span><span class="s">"org.jasig.cas.extension.clearpass.EncryptedMapDecorator"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">"0"</span> <span class="na">ref=</span><span class="s">"memcachedMap"</span> <span class="nt">/&gt;</span>
  <span class="c">&lt;!-- Replace the salt and secret key with one of your choosing --&gt;</span>      
  <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">"1"</span> <span class="na">value=</span><span class="s">"salt1234"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">"2"</span> <span class="na">value=</span><span class="s">"seCretKey0123456"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"ticketRegistry"</span> <span class="na">class=</span><span class="s">"org.jasig.cas.extension.clearpass.TicketRegistryDecorator"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">"0"</span> <span class="na">ref=</span><span class="s">"ticketRegistryValue"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">"1"</span> <span class="na">ref=</span><span class="s">"credentialsCache"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Note that if you are using an SSH tunnel for your Memcached connections the Encrypted Map Decorator would not be necessary.</p>

                </div>
            </section>
        </main>
    </div>
</div>


<footer>
    <div class="container">
        CAS is supported by the <a href="https://www.apereo.org/">Apereo Foundation</a>.
    </div>
</footer>

<script>
    let pageSection = '';
</script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.3.2/js/tether.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js"></script>

<script src="../../javascripts/URI.js"></script>
<script src="../../javascripts/main.js"></script>

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script>
<script type="text/javascript" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
</body>

</html>
