<!DOCTYPE html>
<html>

<head>
    <!-- Required meta tags always come first -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="CAS - Enterprise Single Sign-On for the Web"/>
    <meta name="keywords" content="authentication, login, cas, central authentication service, web, java, protocol, thymeleaf,
                   open source, boot, spring, authorization, google, facebook, twitter, higher-ed, enterprise,
                   access management, single signon, sso, RBAC, ABAC, attributes, SAML, OpenID, openid connect,
                   JWT, ADFS"/>
    <meta name="robots" content="index,follow"/>

    
    

        
    


    

    <script>
        ((i, s, o, g, r, a, m) => {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-83384532-2', 'auto');
        ga('send', 'pageview');

    </script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3"/>

    <link rel="stylesheet" type="text/css" media="screen" href="../../stylesheets/stylesheet.css">
    <link rel="stylesheet" type="text/css" media="print" href="../../stylesheets/print.css">

    <link href='https://fonts.googleapis.com/css?family=Lato:400,300,700' rel='stylesheet'>
    <link href='https://fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic&subset=latin-ext,latin' rel='stylesheet'>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@100;200;300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css" rel="stylesheet">

    <title>CAS - Logging Configuration</title>

</head>

<body>
<!-- HEADER -->
<header class="hidden-sm-down">
    <div class="container">
        <div class="row">
            <div class="col-xs-4 col-md-2">
                <a href="../../index.html">
                    <img class="undecorated" src="../../images/cas_logo.png"/>
                </a>
            </div>
            <div class="col-xs-8 col-md-6">
                <h1>Enterprise Single Sign-On for All</h1>
            </div>
            <div class="hidden-sm-down col-md-4">
                <a id="forkme_banner" href="https://github.com/apereo/cas">View on GitHub</a>
            </div>

        </div>
    </div>
</header>

<!-- NAVBAR -->

<nav class="navbar navbar-expand-md navbar-dark bg-primary bg-dark">
    <div class="container">
        <button class="navbar-toggler collapsed" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarsExample04" aria-controls="navbarsExample04" aria-expanded="false"
                aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="navbar-collapse collapse" id="navbarsExample04">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active"><a href="../../index.html" class="zoom nav-link">Home</a></li>
                <li class="nav-item"><a href="https://github.com/apereo/cas/releases" class="zoom nav-link">Releases</a></li>
                <li class="nav-item"><a href="../../Support.html" class="zoom nav-link">Support</a></li>
                <li class="nav-item"><a href="../../Mailing-Lists.html" class="zoom nav-link">Mailing Lists</a></li>
                <li class="nav-item">
                    <a class="zoom nav-link" href="../../Demos.html">Demos</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="zoom nav-link dropdown-toggle mr-md-2" href="#" id="cas-versions" data-bs-toggle="dropdown"
                       aria-haspopup="true" aria-expanded="false">Versions</a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="cas-versions">
                        
                        
                        <a class="dropdown-item" href="/cas/development/">Development</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.6.x/">v6.6.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.5.x/">v6.5.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.4.x/">v6.4.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.3.x/">v6.3.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.2.x/">v6.2.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.1.x/">v6.1.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.0.x/">v6.0.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.3.x/">v5.3.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.2.x/">v5.2.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.1.x/">v5.1.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.0.x/">v5.0.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/4.2.x/">v4.2.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/4.1.x/">v4.1.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/4.0.x/">v4.0.x</a>
                        
                        

                    </div>
                </li>
                <li class="nav-item"><a href="https://apereo.github.io" target="_blank" class="zoom nav-link">Blog</a></li>
            </ul>

        </div>

    </div>
</nav>


<div class="container-fluid">
    <div class="row flex-xl-nowrap">
        <div class="col-12 col-md-3 col-xl-2 docs-sidebar pb-5" id="sidebar"></div>


        <div class="d-none d-xl-block col-xl-2 docs-toc">
    <div id="pageContents">
        <ul class="section-nav"></ul>
    </div>
</div>


        <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 cas-docs-content" role="main">


            

            <section>
                <nav id="docsNavBar">
                    <span id="toolbarIcons"></span>
                </nav>

                <div id="cas-docs-container">
                    <h1 id="logging">Logging</h1>

<p>CAS provides a logging facility that logs important informational events like authentication success and
failure; it can be customized to produce additional information for troubleshooting. CAS uses the Slf4j
Logging framework as a facade for the <a href="http://logging.apache.org">Log4j engine</a> by default.</p>

<p>The default log4j configuration file is located in <code class="language-plaintext highlighter-rouge">src/main/resources/log4j2.xml</code>.
By default logging is set to <code class="language-plaintext highlighter-rouge">INFO</code> for all functionality related to <code class="language-plaintext highlighter-rouge">org.apereo.cas</code> code.
For debugging and diagnostic purposes you may want to set these levels to <code class="language-plaintext highlighter-rouge">DEBUG</code>.</p>

<div class="alert alert-warning"><strong>Production</strong><p>You should always run everything under
<code>WARN</code>. In production warnings and errors are things you care about. Everything else is just diagnostics. Only
turn up <code>DEBUG</code> or <code>INFO</code> if you need to research a particular issue.</p></div>

<h2 id="configuration">Configuration</h2>

<p>It is often helpful to externalize the <code class="language-plaintext highlighter-rouge">log4j2.xml</code> file to a system path to preserve settings between upgrades.
The location of <code class="language-plaintext highlighter-rouge">log4j2.xml</code> file by default is on the runtime classpath and can be controlled
via the CAS properties.</p>

<p>To see the relevant list of CAS properties, please <a href="../configuration/Configuration-Properties.html#logging">review this guide</a>.</p>

<h3 id="log-levels">Log Levels</h3>

<p>While log levels can directly be massaged via the native <code class="language-plaintext highlighter-rouge">log4j2.xml</code> syntax, they may also be modified
using the usual CAS properties. To see the relevant list of CAS properties, please <a href="../configuration/Configuration-Properties.html#logging">review this guide</a>.</p>

<h3 id="refresh-interval">Refresh Interval</h3>

<p>The <code class="language-plaintext highlighter-rouge">log4j2.xml</code> itself controls the refresh interval of the logging configuration. Log4j has the ability
to automatically detect changes to the configuration file and reconfigure itself. If the <code class="language-plaintext highlighter-rouge">monitorInterval</code>
attribute is specified on the configuration element and is set to a non-zero value then the file will be
checked the next time a log event is evaluated and/or logged and the <code class="language-plaintext highlighter-rouge">monitorInterval</code> has elapsed since
the last check. This will allow you to adjust the log levels and configuration without restarting the
server environment.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="c">&lt;!-- Specify the refresh internal in seconds. --&gt;</span>
<span class="nt">&lt;Configuration</span> <span class="na">monitorInterval=</span><span class="s">"15"</span> <span class="err">...</span><span class="nt">&gt;</span>
    ...
<span class="nt">&lt;/Configuration&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="appenders">Appenders</h3>

<p>Appenders are responsible for delivering log events to their destination. Appenders usually are only responsible for writing the event data to the 
target destination. In most cases they delegate responsibility for formatting the event to a layout. Some appenders wrap other appenders so that they can modify the log event, 
handle a failure in an <code class="language-plaintext highlighter-rouge">Appender</code>, route the event to a subordinate <code class="language-plaintext highlighter-rouge">Appender</code> based on advanced filtering criteria or provide similar 
functionality that does not directly format the event for viewing. <code class="language-plaintext highlighter-rouge">Appender</code>s always have a name so that they can be referenced from <code class="language-plaintext highlighter-rouge">Logger</code>s.</p>

<p>The following <code class="language-plaintext highlighter-rouge">Appender</code> elements are only a partial collection of available options.</p>

<table>
  <thead>
    <tr>
      <th>Layout</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">AsyncAppender</code></td>
      <td>Accepts references to other Appenders and causes LogEvents to be written to them on a separate Thread.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">CassandraAppender</code></td>
      <td>Writes its output to an Apache Cassandra database. A keyspace and table must be configured ahead of time, and the columns should be mapped in a configuration file.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">ConsoleAppender</code></td>
      <td>Writes its output to either <code class="language-plaintext highlighter-rouge">System.out</code> or <code class="language-plaintext highlighter-rouge">System.err</code> with <code class="language-plaintext highlighter-rouge">System.out</code> being the default target.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">FailoverAppender</code></td>
      <td>Wraps a set of appenders. If the primary Appender fails the secondary appenders will be tried in order until one succeeds or there are no more secondaries to try.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">FileAppender</code></td>
      <td>Writes to the File named in the <code class="language-plaintext highlighter-rouge">fileName</code> parameter.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">CsvParameterLayout</code></td>
      <td>Converts an event’s parameters into a CSV record, ignoring the message.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">JDBCAppender</code></td>
      <td>Writes log events to a relational database table using standard JDBC.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">JPAAppender</code></td>
      <td>Writes log events to a relational database table using the Java Persistence API <code class="language-plaintext highlighter-rouge">2.1</code>.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">HttpAppender</code></td>
      <td>Sends log events over HTTP. A Layout must be provided to format the log event.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">KafkaAppender</code></td>
      <td>Logs events to an Apache Kafka topic. Each log event is sent as a Kafka record.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">NoSQLAppender</code></td>
      <td>Writes log events to a NoSQL database; Provider implementations currently exist for MongoDB and Apache CouchDB.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">RoutingAppender</code></td>
      <td>Evaluates log events and then routes them to a subordinate <code class="language-plaintext highlighter-rouge">Appender</code>.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">SMTPAppender</code></td>
      <td>Sends an e-mail when a specific logging event occurs, typically on errors or fatal errors.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">JeroMQ</code></td>
      <td>The ZeroMQ appender uses the JeroMQ library to send log events to one or more ZeroMQ endpoints.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">RollingFileAppender</code></td>
      <td>Writes to the File named in the fileName parameter and rolls the file over according the <code class="language-plaintext highlighter-rouge">TriggeringPolicy</code> and the <code class="language-plaintext highlighter-rouge">RolloverPolicy</code>.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">RewriteAppender</code></td>
      <td>Allows the log event to be manipulated before it is processed by another <code class="language-plaintext highlighter-rouge">Appender</code>. This can be used to mask sensitive information such as passwords or to inject information into each event.</td>
    </tr>
  </tbody>
</table>

<p>For full details, please review the official <a href="http://logging.apache.org">Log4j documentation</a></p>

<h3 id="log-patterns">Log Patterns</h3>

<p>By default most appenders that are provided via the <code class="language-plaintext highlighter-rouge">log4j2.xml</code> file use
pattern-based layouts to format log messages. The following alternative layouts may also be used:</p>

<table>
  <thead>
    <tr>
      <th>Layout</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">CsvParameterLayout</code></td>
      <td>Converts an event’s parameters into a CSV record, ignoring the message.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">GelfLayout</code></td>
      <td>Lays out events in the Graylog Extended Log Format (<code class="language-plaintext highlighter-rouge">GELF</code>).</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">HTMLLayout</code></td>
      <td>Generates an HTML page and adds each LogEvent to a row in a table</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">JSONLayout</code></td>
      <td>Creates log events in well-formed or fragmented JSON.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">PatternLayout</code></td>
      <td>Formats the log even based on a conversion pattern.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">RFC5424Layout</code></td>
      <td>Formats log events in accordance with <a href="http://tools.ietf.org/html/rfc5424">RFC 5424</a>, the enhanced Syslog specification.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">SerializedLayout</code></td>
      <td>Log events are transformed into byte arrays useful in JMS or socket connections.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">SyslogLayout</code></td>
      <td>Formats log events as BSD Syslog records.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">XMLLayout</code></td>
      <td>Creates log events in well-formed or fragmented XML.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">YamlLayout</code></td>
      <td>Creates log events in YAML.</td>
    </tr>
  </tbody>
</table>

<p>To learn more about nuances and configuration settings for each, please refer to the <a href="http://logging.apache.org">official Log4J guides</a>.</p>

<h2 id="log-file-rotation">Log File Rotation</h2>

<p>The default configuration specifies triggering policies for rolling over logs, at startup, size or at specific times. These policies apply to <code class="language-plaintext highlighter-rouge">RollingFile</code> appenders.</p>

<p>For example, the following XML fragment defines policies that rollover the log when the JVM starts, when the log size reaches <code class="language-plaintext highlighter-rouge">10</code> megabytes, and when the current date no longer matches the log’s start date.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;RollingFile</span> <span class="na">name=</span><span class="s">"file"</span> <span class="na">fileName=</span><span class="s">"${baseDir}/cas.log"</span> <span class="na">append=</span><span class="s">"true"</span>
                    <span class="na">filePattern=</span><span class="s">"${baseDir}/cas-%d{yyyy-MM-dd-HH}-%i.log"</span><span class="nt">&gt;</span>
    ...
    <span class="nt">&lt;Policies&gt;</span>
        <span class="nt">&lt;OnStartupTriggeringPolicy</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;SizeBasedTriggeringPolicy</span> <span class="na">size=</span><span class="s">"10 MB"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;TimeBasedTriggeringPolicy</span> <span class="na">interval=</span><span class="s">"24"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/Policies&gt;</span>
    ...
<span class="nt">&lt;/RollingFile&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The triggering policies determines <strong>if</strong> a rollover should be performed and rollover strategy can also be design to indicate <strong>how</strong> that should be done. If no strategy is configured, the default will be used.</p>

<p>To find more a comprehensive documentation, please <a href="http://logging.apache.org">review the guides here</a>.</p>

<h3 id="rollover-strategy">Rollover Strategy</h3>

<p>Customized rollover strategies provide a delete action that gives users more control over what files are deleted at rollover time than what was possible with the DefaultRolloverStrategy max attribute. The delete action lets users configure one or more conditions that select the files to delete relative to a base directory.</p>

<p>For example, the following appender at rollover time deletes all files under the base directory that match the <code class="language-plaintext highlighter-rouge">*/*.log</code> glob and are <code class="language-plaintext highlighter-rouge">7</code> days old or older.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;RollingFile</span> <span class="na">name=</span><span class="s">"file"</span> <span class="na">fileName=</span><span class="s">"${baseDir}/cas.log"</span> <span class="na">append=</span><span class="s">"true"</span>
             <span class="na">filePattern=</span><span class="s">"${baseDir}/cas-%d{yyyy-MM-dd-HH}-%i.log"</span><span class="nt">&gt;</span>
    ...
    <span class="nt">&lt;DefaultRolloverStrategy</span> <span class="na">max=</span><span class="s">"5"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;Delete</span> <span class="na">basePath=</span><span class="s">"${baseDir}"</span> <span class="na">maxDepth=</span><span class="s">"2"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;IfFileName</span> <span class="na">glob=</span><span class="s">"*/*.log"</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;IfLastModified</span> <span class="na">age=</span><span class="s">"7d"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/Delete&gt;</span>
    <span class="nt">&lt;/DefaultRolloverStrategy&gt;</span>
    ...
<span class="nt">&lt;/RollingFile&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>To find more a comprehensive documentation, please <a href="http://logging.apache.org">review the guides here</a>.</p>

<h2 id="log-data-sanitation">Log Data Sanitation</h2>

<p>For security purposes, CAS by default will attempt to remove ticket-granting ticket and proxy-granting ticket ids from all log data.
This will of course include messages that are routed to a log destination by the logging framework as well as all audit messages.</p>

<p>A sample follows below:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>WHO: audit:unknown
WHAT: TGT-<span class="k">******************</span>123456-cas01.example.org
ACTION: TICKET_GRANTING_TICKET_DESTROYED
APPLICATION: CAS
WHEN: Sat Jul 12 04:10:35 PDT 2014
CLIENT IP ADDRESS: ...
SERVER IP ADDRESS: ...
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Certain number of characters are left at the trailing end of the ticket id to assist with troubleshooting and diagnostics.</p>

<p>To see the relevant list of CAS properties, please <a href="../configuration/Configuration-Properties.html#logging">review this guide</a>.</p>

                </div>
            </section>
        </main>
    </div>
</div>


<footer>
    <div class="container">
        CAS is supported by the <a href="https://www.apereo.org/">Apereo Foundation</a>.
    </div>
</footer>

<script>
    let pageSection = 'Logs & Audits';
</script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.3.2/js/tether.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js"></script>

<script src="../../javascripts/URI.js"></script>
<script src="../../javascripts/main.js"></script>

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script>
<script type="text/javascript" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
</body>

</html>
