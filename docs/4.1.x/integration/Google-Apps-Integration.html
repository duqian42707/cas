<!DOCTYPE html>
<html>

<head>
    <!-- Required meta tags always come first -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="CAS - Enterprise Single Sign-On for the Web"/>
    <meta name="keywords" content="authentication, login, cas, central authentication service, web, java, protocol, thymeleaf,
                   open source, boot, spring, authorization, google, facebook, twitter, higher-ed, enterprise,
                   access management, single signon, sso, RBAC, ABAC, attributes, SAML, OpenID, openid connect,
                   JWT, ADFS"/>
    <meta name="robots" content="index,follow"/>

    
    

        
    


    

    <script>
        ((i, s, o, g, r, a, m) => {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-83384532-2', 'auto');
        ga('send', 'pageview');

    </script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3"/>

    <link rel="stylesheet" type="text/css" media="screen" href="../../stylesheets/stylesheet.css">
    <link rel="stylesheet" type="text/css" media="print" href="../../stylesheets/print.css">

    <link href='https://fonts.googleapis.com/css?family=Lato:400,300,700' rel='stylesheet'>
    <link href='https://fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic&subset=latin-ext,latin' rel='stylesheet'>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@100;200;300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css" rel="stylesheet">

    <title>CAS - Google Apps Integration</title>

</head>

<body>
<!-- HEADER -->
<header class="hidden-sm-down">
    <div class="container">
        <div class="row">
            <div class="col-xs-4 col-md-2">
                <a href="../../index.html">
                    <img class="undecorated" src="../../images/cas_logo.png"/>
                </a>
            </div>
            <div class="col-xs-8 col-md-6">
                <h1>Enterprise Single Sign-On for All</h1>
            </div>
            <div class="hidden-sm-down col-md-4">
                <a id="forkme_banner" href="https://github.com/apereo/cas">View on GitHub</a>
            </div>

        </div>
    </div>
</header>

<!-- NAVBAR -->

<nav class="navbar navbar-expand-md navbar-dark bg-primary bg-dark">
    <div class="container">
        <button class="navbar-toggler collapsed" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarsExample04" aria-controls="navbarsExample04" aria-expanded="false"
                aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="navbar-collapse collapse" id="navbarsExample04">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active"><a href="../../index.html" class="zoom nav-link">Home</a></li>
                <li class="nav-item"><a href="https://github.com/apereo/cas/releases" class="zoom nav-link">Releases</a></li>
                <li class="nav-item"><a href="../../Support.html" class="zoom nav-link">Support</a></li>
                <li class="nav-item"><a href="../../Mailing-Lists.html" class="zoom nav-link">Mailing Lists</a></li>
                <li class="nav-item">
                    <a class="zoom nav-link" href="../../Demos.html">Demos</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="zoom nav-link dropdown-toggle mr-md-2" href="#" id="cas-versions" data-bs-toggle="dropdown"
                       aria-haspopup="true" aria-expanded="false">Versions</a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="cas-versions">
                        
                        
                        <a class="dropdown-item" href="/cas/development/">Development</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.6.x/">v6.6.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.5.x/">v6.5.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.4.x/">v6.4.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.3.x/">v6.3.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.2.x/">v6.2.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.1.x/">v6.1.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.0.x/">v6.0.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.3.x/">v5.3.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.2.x/">v5.2.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.1.x/">v5.1.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.0.x/">v5.0.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/4.2.x/">v4.2.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/4.1.x/">v4.1.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/4.0.x/">v4.0.x</a>
                        
                        

                    </div>
                </li>
                <li class="nav-item"><a href="https://apereo.github.io" target="_blank" class="zoom nav-link">Blog</a></li>
            </ul>

        </div>

    </div>
</nav>


<div class="container-fluid">
    <div class="row flex-xl-nowrap">
        <div class="col-12 col-md-3 col-xl-2 docs-sidebar pb-5" id="sidebar"></div>


        <div class="d-none d-xl-block col-xl-2 docs-toc">
    <div id="pageContents">
        <ul class="section-nav"></ul>
    </div>
</div>


        <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 cas-docs-content" role="main">


            

            <section>
                <nav id="docsNavBar">
                    <span id="toolbarIcons"></span>
                </nav>

                <div id="cas-docs-container">
                    <h1 id="overview">Overview</h1>
<p>Google Apps for Education (or any of the Google Apps) utilizes SAML 2.0 to provide an integration point for external authentication services. SAML2 support for Google Apps integration is built via a special <code class="language-plaintext highlighter-rouge">ArgumentExtractor</code> and accompanying <code class="language-plaintext highlighter-rouge">Service</code> to provide process and understand SAML 2.0 requests from Google.</p>

<p>Support is enabled by including the following dependency in the Maven WAR overlay:</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.jasig.cas<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>cas-server-support-saml<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>${cas.version}<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></figure>

<h2 id="generate-publicprivate-keys">Generate Public/Private Keys</h2>
<p>The first step is to generate DSA/RSA public and private keys. These are used to sign and read the Assertions. After keys are created, the public key needs to be registered with Google.</p>

<p>The keys will also need to be available to the CAS application (but not publicly available over the Internet) via the classpath (i.e. <code class="language-plaintext highlighter-rouge">WEB-INF/classes</code>) though any location accessible by the user running the web server instance and not served publicly to the Internet is acceptable.  Thus, inside <code class="language-plaintext highlighter-rouge">WEB-INF</code> is nice because <code class="language-plaintext highlighter-rouge">WEB-INF</code> is scoped to the web application but not normally served. <code class="language-plaintext highlighter-rouge">/etc/cas/keys/</code> is also fine as well and protects the key from being overwritten on deploy of a new CAS webapp version.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">openssl genrsa <span class="nt">-out</span> private.key 1024
openssl rsa <span class="nt">-pubout</span> <span class="nt">-in</span> private.key <span class="nt">-out</span> public.key <span class="nt">-inform</span> PEM <span class="nt">-outform</span> DER
openssl pkcs8 <span class="nt">-topk8</span> <span class="nt">-inform</span> PER <span class="nt">-outform</span> DER <span class="nt">-nocrypt</span> <span class="nt">-in</span> private.key <span class="nt">-out</span> private.p8
openssl req <span class="nt">-new</span> <span class="nt">-x509</span> <span class="nt">-key</span> private.key <span class="nt">-out</span> x509.pem <span class="nt">-days</span> 365</code></pre></figure>

<p>The <code class="language-plaintext highlighter-rouge">public.key</code> and <code class="language-plaintext highlighter-rouge">private.p8</code> go into classpath. The <code class="language-plaintext highlighter-rouge">x509.pem</code> file should be uploaded into Google Apps under Security/SSO.</p>

<h2 id="configure-cas">Configure CAS</h2>
<p>Google Accounts integration within CAS is enabled by simply adding an additional <code class="language-plaintext highlighter-rouge">ArgumentExtractor</code>. <code class="language-plaintext highlighter-rouge">WEB-INF/spring-configuration/argumentExtractorsConfiguration.xml</code> should be modified to add the following:</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"googleAccountsArgumentExtractor"</span> 
    <span class="na">class=</span><span class="s">"org.jasig.cas.support.saml.web.support.GoogleAccountsArgumentExtractor"</span>
      <span class="na">p:skewAllowance=</span><span class="s">"${cas.saml.response.skewAllowance:0}"</span>
      <span class="na">c:privateKey-ref=</span><span class="s">"privateKeyFactoryBean"</span>
      <span class="na">c:publicKey-ref=</span><span class="s">"publicKeyFactoryBean"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"privateKeyFactoryBean"</span> <span class="na">class=</span><span class="s">"org.jasig.cas.util.PrivateKeyFactoryBean"</span>
      <span class="na">p:location=</span><span class="s">"classpath:private.p8"</span>
      <span class="na">p:algorithm=</span><span class="s">"RSA"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"publicKeyFactoryBean"</span>	<span class="na">class=</span><span class="s">"org.jasig.cas.util.PublicKeyFactoryBean"</span>
      <span class="na">p:location=</span><span class="s">"classpath:public.key"</span>
      <span class="na">p:algorithm=</span><span class="s">"RSA"</span> <span class="nt">/&gt;</span>
      
<span class="nt">&lt;util:list</span> <span class="na">id=</span><span class="s">"argumentExtractors"</span><span class="nt">&gt;</span>
...
    <span class="nt">&lt;ref</span> <span class="na">bean=</span><span class="s">"googleAccountsArgumentExtractor"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/util:list&gt;</span></code></pre></figure>

<p>Replace the <code class="language-plaintext highlighter-rouge">public.key</code> and <code class="language-plaintext highlighter-rouge">private.key</code> with the names of your key files. If they are not available on the classpath, change the location to point to the location of the keys. If you are using DSA instead of RSA, change the algorithm as appropriate.</p>

<p>Ensure the 
You’ll also need to add a new generator in the <code class="language-plaintext highlighter-rouge">WEB-INF/spring-configuration/uniqueIdGenerators.xml</code> file:</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;util:map</span> <span class="na">id=</span><span class="s">"uniqueIdGeneratorsMap"</span><span class="nt">&gt;</span>
...
  <span class="nt">&lt;entry</span>
    <span class="na">key=</span><span class="s">"org.jasig.cas.support.saml.authentication.principal.GoogleAccountsService"</span>
    <span class="na">value-ref=</span><span class="s">"serviceTicketUniqueIdGenerator"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/util:map&gt;</span></code></pre></figure>

<p>Also, ensure that Google Apps is registered in your Service Registry, by the <code class="language-plaintext highlighter-rouge">serviceId</code>: <code class="language-plaintext highlighter-rouge">https://www.google.com/a/YourGoogleDomain/acs</code></p>

<h2 id="configure-username-attribute">Configure Username Attribute</h2>
<p>As an optional step, you can configure an alternate username to be send to Google in the SAML reply. This alternate user name
can be specified in the CAS service registry via <a href="../installation/Service-Management.html">username attribute providers</a>
for the registered Google Apps service.</p>

<h2 id="configure-google">Configure Google</h2>
<p>You’ll need to provide Google with the URL for your SAML-based SSO service, as well as the URL your users will be redirected to when they log out of a hosted Google application.
Use the following URLs when you are configuring for Google Apps:</p>

<ul>
  <li>Sign-in page URL: <code class="language-plaintext highlighter-rouge">https://sso.school.edu/cas/login</code></li>
  <li>Sign-out page URL: <code class="language-plaintext highlighter-rouge">https://sso.school.edu/cas/logout</code></li>
  <li>Change password URL: <code class="language-plaintext highlighter-rouge">https://mgmt.password.edu/</code></li>
</ul>

<h2 id="test">Test</h2>
<p>Attempt to access a Google-hosted application, such as Google Calendar with the url: <code class="language-plaintext highlighter-rouge">http://calendar.google.com/a/YourGoogleDomain</code></p>

                </div>
            </section>
        </main>
    </div>
</div>


<footer>
    <div class="container">
        CAS is supported by the <a href="https://www.apereo.org/">Apereo Foundation</a>.
    </div>
</footer>

<script>
    let pageSection = '';
</script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.3.2/js/tether.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js"></script>

<script src="../../javascripts/URI.js"></script>
<script src="../../javascripts/main.js"></script>

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script>
<script type="text/javascript" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
</body>

</html>
