<!DOCTYPE html>
<html>

<head>
    <!-- Required meta tags always come first -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="CAS - Enterprise Single Sign-On for the Web"/>
    <meta name="keywords" content="authentication, login, cas, central authentication service, web, java, protocol, thymeleaf,
                   open source, boot, spring, authorization, google, facebook, twitter, higher-ed, enterprise,
                   access management, single signon, sso, RBAC, ABAC, attributes, SAML, OpenID, openid connect,
                   JWT, ADFS"/>
    <meta name="robots" content="index,follow"/>

    
    

        
    


    

    <script>
        ((i, s, o, g, r, a, m) => {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-83384532-2', 'auto');
        ga('send', 'pageview');

    </script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3"/>

    <link rel="stylesheet" type="text/css" media="screen" href="../../stylesheets/stylesheet.css">
    <link rel="stylesheet" type="text/css" media="print" href="../../stylesheets/print.css">

    <link href='https://fonts.googleapis.com/css?family=Lato:400,300,700' rel='stylesheet'>
    <link href='https://fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic&subset=latin-ext,latin' rel='stylesheet'>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@100;200;300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css" rel="stylesheet">

    <title>CAS - X.509 Authentication</title>

</head>

<body>
<!-- HEADER -->
<header class="hidden-sm-down">
    <div class="container">
        <div class="row">
            <div class="col-xs-4 col-md-2">
                <a href="../../index.html">
                    <img class="undecorated" src="../../images/cas_logo.png"/>
                </a>
            </div>
            <div class="col-xs-8 col-md-6">
                <h1>Enterprise Single Sign-On for All</h1>
            </div>
            <div class="hidden-sm-down col-md-4">
                <a id="forkme_banner" href="https://github.com/apereo/cas">View on GitHub</a>
            </div>

        </div>
    </div>
</header>

<!-- NAVBAR -->

<nav class="navbar navbar-expand-md navbar-dark bg-primary bg-dark">
    <div class="container">
        <button class="navbar-toggler collapsed" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarsExample04" aria-controls="navbarsExample04" aria-expanded="false"
                aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="navbar-collapse collapse" id="navbarsExample04">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active"><a href="../../index.html" class="zoom nav-link">Home</a></li>
                <li class="nav-item"><a href="https://github.com/apereo/cas/releases" class="zoom nav-link">Releases</a></li>
                <li class="nav-item"><a href="../../Support.html" class="zoom nav-link">Support</a></li>
                <li class="nav-item"><a href="../../Mailing-Lists.html" class="zoom nav-link">Mailing Lists</a></li>
                <li class="nav-item">
                    <a class="zoom nav-link" href="../../Demos.html">Demos</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="zoom nav-link dropdown-toggle mr-md-2" href="#" id="cas-versions" data-bs-toggle="dropdown"
                       aria-haspopup="true" aria-expanded="false">Versions</a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="cas-versions">
                        
                        
                        <a class="dropdown-item" href="/cas/development/">Development</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.6.x/">v6.6.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.5.x/">v6.5.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.4.x/">v6.4.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.3.x/">v6.3.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.2.x/">v6.2.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.1.x/">v6.1.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.0.x/">v6.0.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.3.x/">v5.3.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.2.x/">v5.2.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.1.x/">v5.1.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.0.x/">v5.0.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/4.2.x/">v4.2.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/4.1.x/">v4.1.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/4.0.x/">v4.0.x</a>
                        
                        

                    </div>
                </li>
                <li class="nav-item"><a href="https://apereo.github.io" target="_blank" class="zoom nav-link">Blog</a></li>
            </ul>

        </div>

    </div>
</nav>


<div class="container-fluid">
    <div class="row flex-xl-nowrap">
        <div class="col-12 col-md-3 col-xl-2 docs-sidebar pb-5" id="sidebar"></div>


        <div class="d-none d-xl-block col-xl-2 docs-toc">
    <div id="pageContents">
        <ul class="section-nav"></ul>
    </div>
</div>


        <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 cas-docs-content" role="main">


            

            <section>
                <nav id="docsNavBar">
                    <span id="toolbarIcons"></span>
                </nav>

                <div id="cas-docs-container">
                    <h1 id="x509-authentication">X.509 Authentication</h1>
<p>CAS X.509 authentication components provide a mechanism to authenticate users who present client certificates during
the SSL/TLS handshake process. The X.509 components require configuration ouside the CAS application since the
SSL handshake happens outside the servlet layer where the CAS application resides. There is no particular requirement
on deployment architecture (i.e. Apache reverse proxy, load balancer SSL termination) other than any client
certificate presented in the SSL handshake be accessible to the servlet container as a request attribute named
<code class="language-plaintext highlighter-rouge">javax.servlet.request.X509Certificate</code>. This happens naturally for configurations that terminate SSL connections
directly at the servlet container and when using Apache/mod_jk; for other architectures it may be necessary to do
additional work.</p>

<h2 id="x509-components">X.509 Components</h2>
<p>X.509 support is enabled by including the following dependency in the Maven WAR overlay:</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.jasig.cas<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>cas-server-support-x509<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>${cas.version}<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></figure>

<p>CAS provides an X.509 authentication handler, a handful of X.509-specific principal resolvers, some certificate
revocation machinery, and some Webflow actions to provide for non-interactive authentication.</p>

<h6 id="x509credentialsauthenticationhandler"><code class="language-plaintext highlighter-rouge">X509CredentialsAuthenticationHandler</code></h6>
<p>The X.509 handler technically performs additional checks <em>after</em> the real SSL client authentication process performed
by the Web server terminating the SSL connection. Since an SSL peer may be configured to accept a wide range of
certificates, the CAS X.509 handler provides a number of properties that place additional restrictions on
acceptable client certificates.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">trustedIssuerDnPattern</code> - Regular expression defining allowed issuer DNs. (must be specified)</li>
  <li><code class="language-plaintext highlighter-rouge">subjectDnPattern</code> - Regular expression defining allowed subject DNs. (default=<code class="language-plaintext highlighter-rouge">.*</code>)</li>
  <li><code class="language-plaintext highlighter-rouge">maxPathLength</code> - Maximum number of certs allowed in certificate chain. (default=1)</li>
  <li><code class="language-plaintext highlighter-rouge">maxPathLengthAllowUnspecified</code> - True to allow unspecified path length, false otherwise. (default=false)</li>
  <li><code class="language-plaintext highlighter-rouge">checkKeyUsage</code> - True to enforce certificate <code class="language-plaintext highlighter-rouge">keyUsage</code> field (if present), false otherwise. (default=false)</li>
  <li><code class="language-plaintext highlighter-rouge">requireKeyUsage</code> - True to require the existence of a <code class="language-plaintext highlighter-rouge">keyUsage</code> certificate field, false otherwise. (default=false)</li>
  <li><code class="language-plaintext highlighter-rouge">revocationChecker</code> - Instance of <code class="language-plaintext highlighter-rouge">RevocationChecker</code> used for certificate expiration checks.
(default=<code class="language-plaintext highlighter-rouge">NoOpRevocationChecker</code>)</li>
</ul>

<h3 id="principal-resolver-components">Principal Resolver Components</h3>

<h6 id="x509subjectprincipalresolver"><code class="language-plaintext highlighter-rouge">X509SubjectPrincipalResolver</code></h6>
<p>Creates a principal ID from a format string composed of components from the subject distinguished name.
The following configuration snippet produces prinicpals of the form <em>cn@example.com</em>. For example, given a
certificate with the subject <em>DC=edu, DC=vt/UID=jacky, CN=Jascarnella Ellagwonto</em> it would produce the ID
<em>jacky@vt.edu</em>.</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"x509SubjectResolver"</span>
      <span class="na">class=</span><span class="s">"org.jasig.cas.adaptors.x509.authentication.principal.X509SubjectPrincipalResolver"</span>
      <span class="na">p:descriptor=</span><span class="s">"$CN@$DC.$DC"</span> <span class="nt">/&gt;</span></code></pre></figure>

<p>See the Javadocs for a thorough discussion of the format string specification.</p>

<h6 id="x509subjectdnprincipalresolver"><code class="language-plaintext highlighter-rouge">X509SubjectDNPrincipalResolver</code></h6>
<p>Creates a principal ID from the certificate subject distinguished name.</p>

<h6 id="x509serialnumberprincipalresolver"><code class="language-plaintext highlighter-rouge">X509SerialNumberPrincipalResolver</code></h6>
<p>Creates a principal ID from the certificate serial number.</p>

<h6 id="x509serialnumberandissuerdnprincipalresolver"><code class="language-plaintext highlighter-rouge">X509SerialNumberAndIssuerDNPrincipalResolver</code></h6>
<p>Creates a principal ID by concatenating the certificate serial number, a delimiter, and the issuer DN.
The serial number may be prefixed with an optional string. See the Javadocs for more information.</p>

<h6 id="x509subjectalternativenameupnprincipalresolver"><code class="language-plaintext highlighter-rouge">X509SubjectAlternativeNameUPNPrincipalResolver</code></h6>
<p>Adds support the embedding of a <code class="language-plaintext highlighter-rouge">UserPrincipalName</code> object as a <code class="language-plaintext highlighter-rouge">SubjectAlternateName</code> extension within an X509 certificate,
allowing properly-empowered certificates to be used for network logon (via SmartCards, or alternately by ‘soft certs’ in certain environments).
This resolver extracts the Subject Alternative Name UPN extension from the provided certificate if available as a resolved principal id.</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"authenticationManager"</span>
      <span class="na">class=</span><span class="s">"org.jasig.cas.authentication.PolicyBasedAuthenticationManager"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;constructor-arg&gt;</span>
        <span class="nt">&lt;map&gt;</span>
            <span class="nt">&lt;entry</span> <span class="na">key-ref=</span><span class="s">"x509AuthenticationHandler"</span>
                   <span class="na">value-ref=</span><span class="s">"x509UPNPrincipalResolver"</span> <span class="nt">/&gt;</span>
            ...
        <span class="nt">&lt;/map&gt;</span>
    <span class="nt">&lt;/constructor-arg&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
...

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"x509AuthenticationHandler"</span>
      <span class="na">class=</span><span class="s">"org.jasig.cas.adaptors.x509.authentication.handler.support.X509CredentialsAuthenticationHandler"</span><span class="nt">&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"x509UPNPrincipalResolver"</span>
      <span class="na">class=</span><span class="s">"org.jasig.cas.adaptors.x509.authentication.principal.X509SubjectAlternativeNameUPNPrincipalResolver"</span><span class="nt">&gt;</span></code></pre></figure>

<h3 id="certificate-revocation-checking-components">Certificate Revocation Checking Components</h3>
<p>CAS provides a flexible policy engine for certificate revocation checking. This facility arose due to lack of
configurability in the revocation machinery built into the JSSE.</p>

<p>The following configuration is shared by all components:</p>

<table>
  <thead>
    <tr>
      <th>Field</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">unavailableCRLPolicy</code></td>
      <td>Policy applied when CRL data is unavailable upon fetching. (default=<code class="language-plaintext highlighter-rouge">DenyRevocationPolicy</code>)</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">expiredCRLPolicy</code></td>
      <td>Policy applied when CRL data is expired. (default=<code class="language-plaintext highlighter-rouge">ThresholdExpiredCRLRevocationPolicy</code>)</td>
    </tr>
  </tbody>
</table>

<p>The following policies are available by default:</p>

<table>
  <thead>
    <tr>
      <th>Policy</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">AllowRevocationPolicy</code></td>
      <td>Allow policy</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">DenyRevocationPolicy</code></td>
      <td>Deny policy</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">ThresholdExpiredCRLRevocationPolicy</code></td>
      <td>Deny if CRL is more than X seconds expired.</td>
    </tr>
  </tbody>
</table>

<h4 id="resourcecrlrevocationchecker"><code class="language-plaintext highlighter-rouge">ResourceCRLRevocationChecker</code></h4>
<p>Performs a certificate revocation check against a CRL hosted at a fixed location. Any resource type supported by the
Spring <a href=""><code class="language-plaintext highlighter-rouge">Resource</code></a> class may be specified for the CRL resource. The CRL is fetched at periodic intervals and cached.</p>

<p>Configuration properties:</p>

<table>
  <thead>
    <tr>
      <th>Field</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">crls</code></td>
      <td>Spring resource describing the location/kind of CRL resource. This MUST be specified. A single CRL resource can be alternatively specified via the <code class="language-plaintext highlighter-rouge">crl</code> parameter.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">refreshInterval</code></td>
      <td>Periodic CRL refresh interval in seconds. (default=3600)</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">fetcher</code></td>
      <td>Component responsible for fetching of the CRL resource. (default=<code class="language-plaintext highlighter-rouge">ResourceCRLFetcher</code>)</td>
    </tr>
  </tbody>
</table>

<p><code class="language-plaintext highlighter-rouge">ResourceCRLRevocationChecker</code> Example:</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"crlResource"</span>
      <span class="na">class=</span><span class="s">"org.springframework.core.io.UrlResource"</span>
      <span class="na">c:path=</span><span class="s">"https://pki.example.com/exampleca/crl"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"allowPolicy"</span>
      <span class="na">class=</span><span class="s">"org.jasig.cas.adaptors.x509.authentication.handler.support.AllowRevocationPolicy"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"thresholdPolicy"</span>
      <span class="na">class=</span><span class="s">"org.jasig.cas.adaptors.x509.authentication.handler.support.ThresholdExpiredCRLRevocationPolicy"</span>
      <span class="na">p:threshold=</span><span class="s">"3600"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"revocationChecker"</span>
      <span class="na">class=</span><span class="s">"org.jasig.cas.adaptors.x509.authentication.handler.support.ResourceCRLRevocationChecker"</span>
      <span class="na">c:crl-ref=</span><span class="s">"crlResource"</span>
      <span class="na">p:refreshInterval=</span><span class="s">"600"</span>
      <span class="na">p:unavailableCRLPolicy-ref=</span><span class="s">"allowPolicy"</span>
      <span class="na">p:thresholdPolicy-ref=</span><span class="s">"thresholdPolicy"</span> <span class="nt">/&gt;</span></code></pre></figure>

<h4 id="crldistributionpointrevocationchecker"><code class="language-plaintext highlighter-rouge">CRLDistributionPointRevocationChecker</code></h4>
<p>Performs certificate revocation checking against the CRL URI(s) mentioned in the certificate <em>cRLDistributionPoints</em>
extension field. The component leverages a cache to prevent excessive IO against CRL endpoints; CRL data is fetched
if does not exist in the cache or if it is expired.</p>

<p>Configuration properties:</p>

<table>
  <thead>
    <tr>
      <th>Field</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">cache</code></td>
      <td>Ehcache <code class="language-plaintext highlighter-rouge">Cache</code> component.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">fetcher</code></td>
      <td>Component responsible for fetching of the CRL resource. (default=<code class="language-plaintext highlighter-rouge">ResourceCRLFetcher</code>)</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">throwOnFetchFailure</code></td>
      <td>Throws errors if fetching of the CRL resource fails.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">checkAll</code></td>
      <td>Flag to indicate whether all CRLs should be checked for the certificate resource.</td>
    </tr>
  </tbody>
</table>

<p><code class="language-plaintext highlighter-rouge">CRLDistributionPointRevocationChecker</code> Example:</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="c">&lt;!-- timeToLive, timeToIdle are in seconds --&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"crlCache"</span> <span class="na">class=</span><span class="s">"org.springframework.cache.ehcache.EhCacheFactoryBean"</span>
      <span class="na">p:cacheName=</span><span class="s">"CRLCache"</span>
      <span class="na">p:eternal=</span><span class="s">"false"</span>
      <span class="na">p:overflowToDisk=</span><span class="s">"false"</span>
      <span class="na">p:maxElementsInMemory=</span><span class="s">"100"</span>
      <span class="na">p:timeToLive=</span><span class="s">"36000"</span>
      <span class="na">p:timeToIdle=</span><span class="s">"36000"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"cacheManager"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">"org.springframework.cache.ehcache.EhCacheManagerFactoryBean"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"denyPolicy"</span>
      <span class="na">class=</span><span class="s">"org.jasig.cas.adaptors.x509.authentication.handler.support.DenyRevocationPolicy"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"thresholdPolicy"</span>
      <span class="na">class=</span><span class="s">"org.jasig.cas.adaptors.x509.authentication.handler.support.ThresholdExpiredCRLRevocationPolicy"</span>
      <span class="na">p:threshold=</span><span class="s">"3600"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"revocationChecker"</span>
      <span class="na">class=</span><span class="s">"org.jasig.cas.adaptors.x509.authentication.handler.support.CRLDistributionPointRevocationChecker"</span>
      <span class="na">c:cache-ref=</span><span class="s">"crlCache"</span>
      <span class="na">p:checkAll=</span><span class="s">"false"</span>
      <span class="na">p:unavailableCRLPolicy-ref=</span><span class="s">"denyPolicy"</span>
      <span class="na">p:thresholdPolicy-ref=</span><span class="s">"thresholdPolicy"</span> <span class="nt">/&gt;</span></code></pre></figure>

<h4 id="crl-fetching-configuration">CRL Fetching Configuration</h4>
<p>By default, all revocation checks use the <code class="language-plaintext highlighter-rouge">ResourceCRLFetcher</code> component to fetch the CRL resource from the specified location. The following alternatives are available:</p>

<h5 id="ldaptiveresourcecrlfetcher"><code class="language-plaintext highlighter-rouge">LdaptiveResourceCRLFetcher</code></h5>
<p>Fetches a CRL resource from a preconfigured attribute, in the event that the CRL resource is an LDAP instance:</p>

<h5 id="poolingldaptiveresourcecrlfetcher"><code class="language-plaintext highlighter-rouge">PoolingLdaptiveResourceCRLFetcher</code></h5>
<p>Fetches a CRL resource from a preconfigured attribute, in the event that the CRL resource is an LDAP instance. This component is able to use connection pooling.</p>

<h5 id="example-configuration">Example Configuration</h5>
<p>The following example demonstrates the configuration required to fetch a CRL resource from LDAP. Both fetchers are demonstrated here, but only one generally is necessary.</p>

<p>The example below searches an LDAP instance found in the X509 certificate, based on the filter and the baseDN given. It then attempts to obtain the binary attribute <code class="language-plaintext highlighter-rouge">certificateRevocationList</code> and fetch the resource. The value will be decoded to Base64 first by the fetcher.</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">"org.jasig.cas"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;context:annotation-config</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;context:property-placeholder</span> <span class="na">location=</span><span class="s">"classpath:/ldap.properties"</span><span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"ldapCertFetcher"</span>
      <span class="na">class=</span><span class="s">"org.jasig.cas.adaptors.x509.authentication.handler.support.ldap.LdaptiveResourceCRLFetcher"</span>
      <span class="na">c:connectionConfig-ref=</span><span class="s">"provisioningConnectionConfig"</span>
      <span class="na">c:searchExecutor-ref=</span><span class="s">"searchExecutor"</span>  <span class="nt">/&gt;</span>

<span class="c">&lt;!-- Enabled connection pooling --&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"poolingLdapCertFetcher"</span>
      <span class="na">class=</span><span class="s">"org.jasig.cas.adaptors.x509.authentication.handler.support.ldap.PoolingLdaptiveResourceCRLFetcher"</span>
      <span class="na">c:connectionConfig-ref=</span><span class="s">"provisioningConnectionConfig"</span>
      <span class="na">c:searchExecutor-ref=</span><span class="s">"searchExecutor"</span>
      <span class="na">c:connectionPool-ref=</span><span class="s">"connectionPool"</span><span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"baseDn"</span> <span class="na">class=</span><span class="s">"java.lang.String"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;constructor-arg</span> <span class="na">type=</span><span class="s">"java.lang.String"</span> <span class="na">value=</span><span class="s">"${ldap.baseDn}"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;util:list</span> <span class="na">id=</span><span class="s">"returnAttributes"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;value&gt;</span>certificateRevocationList<span class="nt">&lt;/value&gt;</span>
<span class="nt">&lt;/util:list&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"searchFilter"</span> <span class="na">class=</span><span class="s">"org.ldaptive.SearchFilter"</span>
      <span class="na">p:filter=</span><span class="s">"${ldap.searchfilter.cert}"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"searchExecutor"</span> <span class="na">class=</span><span class="s">"org.ldaptive.SearchExecutor"</span>
      <span class="na">p:baseDn-ref=</span><span class="s">"baseDn"</span>
      <span class="na">p:searchFilter-ref=</span><span class="s">"searchFilter"</span>
      <span class="na">p:returnAttributes-ref=</span><span class="s">"returnAttributes"</span>
      <span class="na">p:binaryAttributes-ref=</span><span class="s">"returnAttributes"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"provisioningConnectionFactory"</span> <span class="na">class=</span><span class="s">"org.ldaptive.DefaultConnectionFactory"</span>
      <span class="na">p:connectionConfig-ref=</span><span class="s">"provisioningConnectionConfig"</span>
      <span class="na">p:provider-ref=</span><span class="s">"unboundidLdapProvider"</span>  <span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"unboundidLdapProvider"</span>
      <span class="na">class=</span><span class="s">"org.ldaptive.provider.unboundid.UnboundIDProvider"</span><span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"provisioningConnectionConfig"</span> <span class="na">class=</span><span class="s">"org.ldaptive.ConnectionConfig"</span>
      <span class="na">p:connectTimeout=</span><span class="s">"${ldap.connectTimeout}"</span>
      <span class="na">p:useStartTLS=</span><span class="s">"${ldap.useStartTLS: false}"</span>
      <span class="na">p:connectionInitializer-ref=</span><span class="s">"bindConnectionInitializer"</span>
      <span class="na">p:sslConfig-ref=</span><span class="s">"provisionSslConfig"</span><span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"provisionSslConfig"</span> <span class="na">class=</span><span class="s">"org.ldaptive.ssl.SslConfig"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"credentialConfig"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">"org.ldaptive.ssl.KeyStoreCredentialConfig"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"bindConnectionInitializer"</span>
      <span class="na">class=</span><span class="s">"org.ldaptive.BindConnectionInitializer"</span>
      <span class="na">p:bindDn=</span><span class="s">"${ldap.managerDn}"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"bindCredential"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">"org.ldaptive.Credential"</span>
              <span class="na">c:password=</span><span class="s">"${ldap.managerPassword}"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"connectionPool"</span>
      <span class="na">class=</span><span class="s">"org.ldaptive.pool.BlockingConnectionPool"</span>
      <span class="na">lazy-init=</span><span class="s">"true"</span>
      <span class="na">init-method=</span><span class="s">"initialize"</span>
      <span class="na">destroy-method=</span><span class="s">"close"</span>
      <span class="na">p:poolConfig-ref=</span><span class="s">"ldapPoolConfig"</span>
      <span class="na">p:blockWaitTime=</span><span class="s">"${ldap.pool.blockWaitTime}"</span>
      <span class="na">p:validator-ref=</span><span class="s">"searchValidator"</span>
      <span class="na">p:pruneStrategy-ref=</span><span class="s">"pruneStrategy"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"pruneStrategy"</span> <span class="na">class=</span><span class="s">"org.ldaptive.pool.IdlePruneStrategy"</span>
      <span class="na">p:prunePeriod=</span><span class="s">"${ldap.pool.prunePeriod}"</span>
      <span class="na">p:idleTime=</span><span class="s">"${ldap.pool.idleTime}"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"searchValidator"</span> <span class="na">class=</span><span class="s">"org.ldaptive.pool.SearchValidator"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"ldapPoolConfig"</span> <span class="na">class=</span><span class="s">"org.ldaptive.pool.PoolConfig"</span>
      <span class="na">p:minPoolSize=</span><span class="s">"${ldap.pool.minSize}"</span>
      <span class="na">p:maxPoolSize=</span><span class="s">"${ldap.pool.maxSize}"</span>
      <span class="na">p:validateOnCheckOut=</span><span class="s">"${ldap.pool.validateOnCheckout}"</span>
      <span class="na">p:validatePeriodically=</span><span class="s">"${ldap.pool.validatePeriodically}"</span>
      <span class="na">p:validatePeriod=</span><span class="s">"${ldap.pool.validatePeriod}"</span> <span class="nt">/&gt;</span></code></pre></figure>

<h3 id="webflow-components">Webflow Components</h3>
<p>A single Webflow component, <code class="language-plaintext highlighter-rouge">X509CertificateCredentialsNonInteractiveAction</code>, is required to extract the certificate
from the HTTP request context and perform non-interactive authentication.</p>

<h2 id="x509-configuration">X.509 Configuration</h2>
<p>X.509 configuration requires substantial configuration outside the CAS Web application. The configuration of Web
server SSL components varies dramatically with software and is outside the scope of this document. We offer some
general advice for SSL configuration:</p>

<ul>
  <li>Configuring SSL components for optional client certificate behavior generally provides better user experience.
Requiring client certificates prevents SSL negotiation in cases where the certificate is not present, which prevents
user-friendly server-side error messages.</li>
  <li>Accept certificates only from trusted issuers, generally those within your PKI.</li>
  <li>Specify all certificates in the certificate chain(s) of allowed issuers.</li>
</ul>

<h3 id="configure-authentication-components">Configure Authentication Components</h3>
<p>Use the following template to configure authentication in <code class="language-plaintext highlighter-rouge">deployerConfigContext.xml</code>:</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"crlResource"</span>
      <span class="na">class=</span><span class="s">"org.springframework.core.io.UrlResource"</span>
      <span class="na">c:path=</span><span class="s">"https://pki.example.com/exampleca/crl"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"allowPolicy"</span>
      <span class="na">class=</span><span class="s">"org.jasig.cas.adaptors.x509.authentication.handler.support.AllowRevocationPolicy"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"thresholdPolicy"</span>
      <span class="na">class=</span><span class="s">"org.jasig.cas.adaptors.x509.authentication.handler.support.ThresholdExpiredCRLRevocationPolicy"</span>
      <span class="na">p:threshold=</span><span class="s">"3600"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"revocationChecker"</span>
      <span class="na">class=</span><span class="s">"org.jasig.cas.adaptors.x509.authentication.handler.support.ResourceCRLRevocationChecker"</span>
      <span class="na">c:crl-ref=</span><span class="s">"crlResource"</span>
      <span class="na">p:refreshInterval=</span><span class="s">"600"</span>
      <span class="na">p:unavailableCRLPolicy-ref=</span><span class="s">"allowPolicy"</span>
      <span class="na">p:thresholdPolicy-ref=</span><span class="s">"thresholdPolicy"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"x509Handler"</span>
      <span class="na">class=</span><span class="s">"org.jasig.cas.adaptors.x509.authentication.handler.support.X509CredentialsAuthenticationHandler"</span>
      <span class="na">p:trustedIssuerDnPattern=</span><span class="s">"CN=(DEV )*Virginia Tech [A-Za-z ]*User CA.*"</span>
      <span class="na">p:maxPathLength=</span><span class="s">"2147483647"</span>
      <span class="na">p:maxPathLengthAllowUnspecified=</span><span class="s">"true"</span>
      <span class="na">p:checkKeyUsage=</span><span class="s">"true"</span>
      <span class="na">p:requireKeyUsage=</span><span class="s">"true"</span>
      <span class="na">p:revocationChecker-ref=</span><span class="s">"revocationChecker"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"x509PrincipalResolver"</span>
      <span class="na">class=</span><span class="s">"org.jasig.cas.adaptors.x509.authentication.principal.X509SubjectPrincipalResolver"</span>
      <span class="na">p:descriptor=</span><span class="s">"$UID"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"authenticationManager"</span>
      <span class="na">class=</span><span class="s">"org.jasig.cas.authentication.PolicyBasedAuthenticationManager"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;constructor-arg&gt;</span>
    <span class="nt">&lt;map&gt;</span>
      <span class="nt">&lt;entry</span> <span class="na">key-ref=</span><span class="s">"x509Handler"</span> <span class="na">value-ref=</span><span class="s">"x509PrincipalResolver"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/map&gt;</span>
  <span class="nt">&lt;/constructor-arg&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"authenticationMetaDataPopulators"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;list&gt;</span>
      <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">"org.jasig.cas.authentication.SuccessfulHandlerMetaDataPopulator"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/list&gt;</span>
  <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span></code></pre></figure>

<h3 id="x509-webflow-configuration">X.509 Webflow Configuration</h3>
<p>Uncomment the <code class="language-plaintext highlighter-rouge">startAuthenticate</code> state in <code class="language-plaintext highlighter-rouge">login-webflow.xml</code>:</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;action-state</span> <span class="na">id=</span><span class="s">"startAuthenticate"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;evaluate</span> <span class="na">expression=</span><span class="s">"x509Check"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;transition</span> <span class="na">on=</span><span class="s">"success"</span> <span class="na">to=</span><span class="s">"sendTicketGrantingTicket"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;transition</span> <span class="na">on=</span><span class="s">"warn"</span> <span class="na">to=</span><span class="s">"warn"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;transition</span> <span class="na">on=</span><span class="s">"error"</span> <span class="na">to=</span><span class="s">"generateLoginTicket"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/action-state&gt;</span></code></pre></figure>

<p>Replace all instances of the <code class="language-plaintext highlighter-rouge">generateLoginTicket</code> transition in other states with <code class="language-plaintext highlighter-rouge">startAuthenticate</code>.</p>

<p>Define the <code class="language-plaintext highlighter-rouge">x509Check</code> bean in <code class="language-plaintext highlighter-rouge">cas-servlet.xml</code>:</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"x509Check"</span>
   <span class="na">class=</span><span class="s">"org.jasig.cas.adaptors.x509.web.flow.X509CertificateCredentialsNonInteractiveAction"</span>
   <span class="na">p:centralAuthenticationService-ref=</span><span class="s">"centralAuthenticationService"</span> <span class="nt">/&gt;</span></code></pre></figure>


                </div>
            </section>
        </main>
    </div>
</div>


<footer>
    <div class="container">
        CAS is supported by the <a href="https://www.apereo.org/">Apereo Foundation</a>.
    </div>
</footer>

<script>
    let pageSection = '';
</script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.3.2/js/tether.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js"></script>

<script src="../../javascripts/URI.js"></script>
<script src="../../javascripts/main.js"></script>

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script>
<script type="text/javascript" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
</body>

</html>
