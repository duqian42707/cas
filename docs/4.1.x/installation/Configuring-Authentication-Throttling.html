<!DOCTYPE html>
<html>

<head>
    <!-- Required meta tags always come first -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="CAS - Enterprise Single Sign-On for the Web"/>
    <meta name="keywords" content="authentication, login, cas, central authentication service, web, java, protocol, thymeleaf,
                   open source, boot, spring, authorization, google, facebook, twitter, higher-ed, enterprise,
                   access management, single signon, sso, RBAC, ABAC, attributes, SAML, OpenID, openid connect,
                   JWT, ADFS"/>
    <meta name="robots" content="index,follow"/>

    
    

        
    


    

    <script>
        ((i, s, o, g, r, a, m) => {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-83384532-2', 'auto');
        ga('send', 'pageview');

    </script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3"/>

    <link rel="stylesheet" type="text/css" media="screen" href="../../stylesheets/stylesheet.css">
    <link rel="stylesheet" type="text/css" media="print" href="../../stylesheets/print.css">

    <link href='https://fonts.googleapis.com/css?family=Lato:400,300,700' rel='stylesheet'>
    <link href='https://fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic&subset=latin-ext,latin' rel='stylesheet'>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@100;200;300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css" rel="stylesheet">

    <title>CAS - Configuring Authentication Throttling</title>

</head>

<body>
<!-- HEADER -->
<header class="hidden-sm-down">
    <div class="container">
        <div class="row">
            <div class="col-xs-4 col-md-2">
                <a href="../../index.html">
                    <img class="undecorated" src="../../images/cas_logo.png"/>
                </a>
            </div>
            <div class="col-xs-8 col-md-6">
                <h1>Enterprise Single Sign-On for All</h1>
            </div>
            <div class="hidden-sm-down col-md-4">
                <a id="forkme_banner" href="https://github.com/apereo/cas">View on GitHub</a>
            </div>

        </div>
    </div>
</header>

<!-- NAVBAR -->

<nav class="navbar navbar-expand-md navbar-dark bg-primary bg-dark">
    <div class="container">
        <button class="navbar-toggler collapsed" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarsExample04" aria-controls="navbarsExample04" aria-expanded="false"
                aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="navbar-collapse collapse" id="navbarsExample04">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active"><a href="../../index.html" class="zoom nav-link">Home</a></li>
                <li class="nav-item"><a href="https://github.com/apereo/cas/releases" class="zoom nav-link">Releases</a></li>
                <li class="nav-item"><a href="../../Support.html" class="zoom nav-link">Support</a></li>
                <li class="nav-item"><a href="../../Mailing-Lists.html" class="zoom nav-link">Mailing Lists</a></li>
                <li class="nav-item">
                    <a class="zoom nav-link" href="../../Demos.html">Demos</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="zoom nav-link dropdown-toggle mr-md-2" href="#" id="cas-versions" data-bs-toggle="dropdown"
                       aria-haspopup="true" aria-expanded="false">Versions</a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="cas-versions">
                        
                        
                        <a class="dropdown-item" href="/cas/development/">Development</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.6.x/">v6.6.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.5.x/">v6.5.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.4.x/">v6.4.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.3.x/">v6.3.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.2.x/">v6.2.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.1.x/">v6.1.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.0.x/">v6.0.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.3.x/">v5.3.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.2.x/">v5.2.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.1.x/">v5.1.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.0.x/">v5.0.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/4.2.x/">v4.2.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/4.1.x/">v4.1.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/4.0.x/">v4.0.x</a>
                        
                        

                    </div>
                </li>
                <li class="nav-item"><a href="https://apereo.github.io" target="_blank" class="zoom nav-link">Blog</a></li>
            </ul>

        </div>

    </div>
</nav>


<div class="container-fluid">
    <div class="row flex-xl-nowrap">
        <div class="col-12 col-md-3 col-xl-2 docs-sidebar pb-5" id="sidebar"></div>


        <div class="d-none d-xl-block col-xl-2 docs-toc">
    <div id="pageContents">
        <ul class="section-nav"></ul>
    </div>
</div>


        <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 cas-docs-content" role="main">


            

            <section>
                <nav id="docsNavBar">
                    <span id="toolbarIcons"></span>
                </nav>

                <div id="cas-docs-container">
                    <h1 id="throttling-authentication-attempts">Throttling Authentication Attempts</h1>
<p>CAS provides a facility for limiting failed login attempts to support password guessing and related abuse scenarios.
A couple strategies are provided for tracking failed attempts:</p>

<ol>
  <li>Source IP - Limit successive failed logins against any username from the same IP address.</li>
  <li>Source IP and username - Limit succesive failed logins against a particular user from the same IP address.</li>
</ol>

<p>It would be straightforward to develop new components that implement alternative strategies.</p>

<p>All login throttling components that ship with CAS limit successive failed login attempts that exceed a threshold
rate in failures per second. The following properties are provided to define the failure rate.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">failureRangeInSeconds</code> - Period of time in seconds during which the threshold applies.</li>
  <li><code class="language-plaintext highlighter-rouge">failureThreshold</code> - Number of failed login attempts permitted in the above period.</li>
</ul>

<p>A failure rate of more than 1 per 3 seconds is indicative of an automated authentication attempt, which is a
reasonable basis for throttling policy. Regardless of policy care should be taken to weigh security against access;
overly restrictive policies may prevent legitimate authentication attempts.</p>

<h2 id="throttling-components">Throttling Components</h2>
<p>The CAS login throttling components are listed below along with a sample configuration that implements a policy
preventing more than 1 failed login every 3 seconds.</p>

<h5 id="inmemorythrottledsubmissionbyipaddresshandlerinterceptoradapter"><code class="language-plaintext highlighter-rouge">InMemoryThrottledSubmissionByIpAddressHandlerInterceptorAdapter</code></h5>
<p>Uses a memory map to prevent successive failed login attempts from the same IP address.</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"loginThrottle"</span>
      <span class="na">class=</span><span class="s">"org.jasig.cas.web.support.InMemoryThrottledSubmissionByIpAddressHandlerInterceptorAdapter"</span>
      <span class="na">p:failureRangeInSeconds=</span><span class="s">"3"</span>
      <span class="na">p:failureThreshold=</span><span class="s">"1"</span>
      <span class="na">p:usernameParameter=</span><span class="s">"username"</span> <span class="nt">/&gt;</span></code></pre></figure>

<h5 id="inmemorythrottledsubmissionbyipaddressandusernamehandlerinterceptoradapter"><code class="language-plaintext highlighter-rouge">InMemoryThrottledSubmissionByIpAddressAndUsernameHandlerInterceptorAdapter</code></h5>
<p>Uses a memory map to prevent successive failed login attempts for a particular username from the same IP address.</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"loginThrottle"</span>
      <span class="na">class=</span><span class="s">"org.jasig.cas.web.support.InMemoryThrottledSubmissionByIpAddressAndUsernameHandlerInterceptorAdapter"</span>
      <span class="na">p:failureRangeInSeconds=</span><span class="s">"3"</span>
      <span class="na">p:failureThreshold=</span><span class="s">"1"</span>
      <span class="na">p:usernameParameter=</span><span class="s">"username"</span> <span class="nt">/&gt;</span></code></pre></figure>

<h5 id="inspektrthrottledsubmissionbyipaddressandusernamehandlerinterceptoradapter"><code class="language-plaintext highlighter-rouge">InspektrThrottledSubmissionByIpAddressAndUsernameHandlerInterceptorAdapter</code></h5>
<p>Queries the data source used by the CAS audit facility to prevent successive failed login attempts for a particular
username from the same IP address. This component requires that the
<a href="https://github.com/Jasig/inspektr">inspektr library</a> used for CAS auditing be configured with
<code class="language-plaintext highlighter-rouge">JdbcAuditTrailManager</code>, which writes audit data to a database.</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"loginThrottle"</span>
      <span class="na">class=</span><span class="s">"org.jasig.cas.web.support.InspektrThrottledSubmissionByIpAddressAndUsernameHandlerInterceptorAdapter"</span>
      <span class="na">c:auditTrailManager-ref=</span><span class="s">"auditTrailManager"</span>
      <span class="na">c:dataSource-ref=</span><span class="s">"dataSource"</span>
      <span class="na">p:failureRangeInSeconds=</span><span class="s">"3"</span>
      <span class="na">p:failureThreshold=</span><span class="s">"1"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"auditTrailManager"</span>
      <span class="na">class=</span><span class="s">"org.jasig.inspektr.audit.support.JdbcAuditTrailManager"</span>
      <span class="na">c:transactionTemplate-ref=</span><span class="s">"inspektrTransactionTemplate"</span>
      <span class="na">p:dataSource-ref=</span><span class="s">"dataSource"</span> <span class="nt">/&gt;</span></code></pre></figure>

<p>For additional instructions on how to configure auditing via Inspektr,
please <a href="Logging.html">review the following guide</a>.</p>

<h2 id="high-availability-considerations-for-throttling">High Availability Considerations for Throttling</h2>

<p>All of the throttling components are suitable for a CAS deployment that satisfies the
<a href="../planning/High-Availability-Guide.html">recommended HA architecture</a>. In particular deployments with multiple CAS
nodes behind a load balancer configured with session affinity can use either in-memory or <em>inspektr</em> components. It is
instructive to discuss the rationale. Since load balancer session affinity is determined by source IP address, which
is the same criterion by which throttle policy is applied, an attacker from a fixed location should be bound to the
same CAS server node for successive authentication attempts. A distributed attack, on the other hand, where successive
request would be routed indeterminately, would cause haphazard tracking for in-memory CAS components since attempts
would be split across N systems. However, since the source varies, accurate accounting would be pointless since the
throttling components themselves assume a constant source IP for tracking purposes. The login throttling components
are simply not sufficient for detecting or preventing a distributed password brute force attack.</p>

<p>For stateless CAS clusters where there is no session affinity, the in-memory components may afford some protection but
they cannot apply the rate strictly since requests to CAS hosts would be split across N systems.
The <em>inspektr</em> components, on the other hand, fully support stateless clusters.</p>

<h3 id="configuring-login-throttling">Configuring Login Throttling</h3>
<p>Login throttling configuration consists of two core components:</p>

<ol>
  <li>A login throttle modeled as a Spring <code class="language-plaintext highlighter-rouge">HandlerInterceptorAdapter</code> component.</li>
  <li>A scheduled task that periodically cleans up state to allow the throttle to relax.</li>
</ol>

<p>The period of scheduled task execution MUST be less than that defined by <code class="language-plaintext highlighter-rouge">failureRangeInSeconds</code> for proper throttle policy enforcement. For example, if <code class="language-plaintext highlighter-rouge">failureRangeInSeconds</code> is 3, then the quartz trigger that drives the task would be configured for less than 3000 (ms).</p>

<p>It is convenient to place Spring configuration for login throttling components in <code class="language-plaintext highlighter-rouge">deployerConfigContext.xml</code>.</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"loginThrottle"</span>
      <span class="na">class=</span><span class="s">"org.jasig.cas.web.support.InMemoryThrottledSubmissionByIpAddressHandlerInterceptorAdapter"</span>
      <span class="na">p:failureRangeInSeconds=</span><span class="s">"3"</span>
      <span class="na">p:failureThreshold=</span><span class="s">"1"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"loginThrottleJobDetail"</span>
      <span class="na">class=</span><span class="s">"org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean"</span>
      <span class="na">p:targetObject-ref=</span><span class="s">"loginThrottle"</span>
      <span class="na">p:targetMethod=</span><span class="s">"decrementCounts"</span><span class="nt">/&gt;</span>

<span class="c">&lt;!-- A scheduler that drives all configured triggers is provided by default in applicationContext.xml. --&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"loginThrottleTrigger"</span>
      <span class="na">class=</span><span class="s">"org.springframework.scheduling.quartz.SimpleTriggerFactoryBean"</span>
      <span class="na">p:jobDetail-ref=</span><span class="s">"loginThrottleJobDetail"</span>
      <span class="na">p:startDelay=</span><span class="s">"1000"</span>
      <span class="na">p:repeatInterval=</span><span class="s">"1000"</span><span class="nt">/&gt;</span></code></pre></figure>

<p>Configure the throttle to fire during the login webflow by editing <code class="language-plaintext highlighter-rouge">cas-servlet.xml</code>:</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"loginFlowHandlerMapping"</span> <span class="na">class=</span><span class="s">"org.springframework.webflow.mvc.servlet.FlowHandlerMapping"</span>
      <span class="na">p:flowRegistry-ref=</span><span class="s">"loginFlowRegistry"</span>
      <span class="na">p:order=</span><span class="s">"2"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"interceptors"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;array</span> <span class="na">value-type=</span><span class="s">"org.springframework.web.servlet.HandlerInterceptor"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;ref</span> <span class="na">bean=</span><span class="s">"localeChangeInterceptor"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;ref</span> <span class="na">bean=</span><span class="s">"loginThrottle"</span> <span class="nt">/&gt;</span>		
          <span class="nt">&lt;/array&gt;</span>
      <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span></code></pre></figure>


                </div>
            </section>
        </main>
    </div>
</div>


<footer>
    <div class="container">
        CAS is supported by the <a href="https://www.apereo.org/">Apereo Foundation</a>.
    </div>
</footer>

<script>
    let pageSection = '';
</script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.3.2/js/tether.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js"></script>

<script src="../../javascripts/URI.js"></script>
<script src="../../javascripts/main.js"></script>

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script>
<script type="text/javascript" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
</body>

</html>
