<!DOCTYPE html>
<html>

<head>
    <!-- Required meta tags always come first -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="CAS - Enterprise Single Sign-On for the Web"/>
    <meta name="keywords" content="authentication, login, cas, central authentication service, web, java, protocol, thymeleaf,
                   open source, boot, spring, authorization, google, facebook, twitter, higher-ed, enterprise,
                   access management, single signon, sso, RBAC, ABAC, attributes, SAML, OpenID, openid connect,
                   JWT, ADFS"/>
    <meta name="robots" content="index,follow"/>

    
    

        
    


    

    <script>
        ((i, s, o, g, r, a, m) => {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-83384532-2', 'auto');
        ga('send', 'pageview');

    </script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3"/>

    <link rel="stylesheet" type="text/css" media="screen" href="../../stylesheets/stylesheet.css">
    <link rel="stylesheet" type="text/css" media="print" href="../../stylesheets/print.css">

    <link href='https://fonts.googleapis.com/css?family=Lato:400,300,700' rel='stylesheet'>
    <link href='https://fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic&subset=latin-ext,latin' rel='stylesheet'>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@100;200;300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css" rel="stylesheet">

    <title>CAS - Web Flow Customization</title>

</head>

<body>
<!-- HEADER -->
<header class="hidden-sm-down">
    <div class="container">
        <div class="row">
            <div class="col-xs-4 col-md-2">
                <a href="../../index.html">
                    <img class="undecorated" src="../../images/cas_logo.png"/>
                </a>
            </div>
            <div class="col-xs-8 col-md-6">
                <h1>Enterprise Single Sign-On for All</h1>
            </div>
            <div class="hidden-sm-down col-md-4">
                <a id="forkme_banner" href="https://github.com/apereo/cas">View on GitHub</a>
            </div>

        </div>
    </div>
</header>

<!-- NAVBAR -->

<nav class="navbar navbar-expand-md navbar-dark bg-primary bg-dark">
    <div class="container">
        <button class="navbar-toggler collapsed" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarsExample04" aria-controls="navbarsExample04" aria-expanded="false"
                aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="navbar-collapse collapse" id="navbarsExample04">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active"><a href="../../index.html" class="zoom nav-link">Home</a></li>
                <li class="nav-item"><a href="https://github.com/apereo/cas/releases" class="zoom nav-link">Releases</a></li>
                <li class="nav-item"><a href="../../Support.html" class="zoom nav-link">Support</a></li>
                <li class="nav-item"><a href="../../Mailing-Lists.html" class="zoom nav-link">Mailing Lists</a></li>
                <li class="nav-item">
                    <a class="zoom nav-link" href="../../Demos.html">Demos</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="zoom nav-link dropdown-toggle mr-md-2" href="#" id="cas-versions" data-bs-toggle="dropdown"
                       aria-haspopup="true" aria-expanded="false">Versions</a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="cas-versions">
                        
                        
                        <a class="dropdown-item" href="/cas/development/">Development</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.6.x/">v6.6.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.5.x/">v6.5.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.4.x/">v6.4.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.3.x/">v6.3.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.2.x/">v6.2.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.1.x/">v6.1.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.0.x/">v6.0.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.3.x/">v5.3.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.2.x/">v5.2.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.1.x/">v5.1.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.0.x/">v5.0.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/4.2.x/">v4.2.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/4.1.x/">v4.1.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/4.0.x/">v4.0.x</a>
                        
                        

                    </div>
                </li>
                <li class="nav-item"><a href="https://apereo.github.io" target="_blank" class="zoom nav-link">Blog</a></li>
            </ul>

        </div>

    </div>
</nav>


<div class="container-fluid">
    <div class="row flex-xl-nowrap">
        <div class="col-12 col-md-3 col-xl-2 docs-sidebar pb-5" id="sidebar"></div>


        <div class="d-none d-xl-block col-xl-2 docs-toc">
    <div id="pageContents">
        <ul class="section-nav"></ul>
    </div>
</div>


        <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 cas-docs-content" role="main">


            

            <section>
                <nav id="docsNavBar">
                    <span id="toolbarIcons"></span>
                </nav>

                <div id="cas-docs-container">
                    <h1 id="webflow-customization">Webflow Customization</h1>
<p>CAS uses <a href="projects.spring.io/spring-webflow">Spring Web Flow</a> to do “script” processing of login and logout protocols. Spring Web Flow builds on Spring MVC and allows implementing the “flows” of a web application. A flow encapsulates a sequence of steps that guide a user through the execution of some business task. It spans multiple HTTP requests, has state, deals with transactional data, is reusable, and may be dynamic and long-running in nature. Each flow may contain among many other settings the following major elements:</p>

<ul>
  <li>Actions: components that describe an executable task and return back a result</li>
  <li>Transitions: Routing the flow from one state to another; Transitions may be global to the entire flow.</li>
  <li>Views: Components that describe the presentation layer displayed back to the client</li>
  <li>Decisions: Components that conditionally route to other areas of flow and can make logical decisions</li>
</ul>

<p>Spring Web Flow presents CAS with a pluggable architecture where custom actions, views and decisions may be injected into the flow to account for additional use cases and processes. Note that to customize the weblow, one must possess a reasonable level of understanding of the webflow’s internals and injection policies. The intention of this document is not to describe Spring Web Flow, but merely to demonstrate how the framework is used by CAS to carry out various aspects of the protocol and business logic execution.</p>

<h2 id="login-flow">Login Flow</h2>
<p>The flow in CAS is given a unique id that is registered inside a <code class="language-plaintext highlighter-rouge">flowRegistry</code> component. Support is enabled via the following configuration snippets in <code class="language-plaintext highlighter-rouge">cas-servlet.xml</code>:</p>

<h3 id="components">Components</h3>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;bean</span> <span class="na">name=</span><span class="s">"loginFlowExecutor"</span> <span class="na">class=</span><span class="s">"org.springframework.webflow.executor.FlowExecutorImpl"</span> 
    <span class="na">c:definitionLocator-ref=</span><span class="s">"loginFlowRegistry"</span>
    <span class="na">c:executionFactory-ref=</span><span class="s">"loginFlowExecutionFactory"</span>
    <span class="na">c:executionRepository-ref=</span><span class="s">"loginFlowExecutionRepository"</span> <span class="nt">/&gt;</span>

...

<span class="nt">&lt;webflow:flow-registry</span> <span class="na">id=</span><span class="s">"loginFlowRegistry"</span> 
    <span class="na">flow-builder-services=</span><span class="s">"builder"</span> <span class="na">base-path=</span><span class="s">"/WEB-INF/webflow"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;webflow:flow-location-pattern</span> <span class="na">value=</span><span class="s">"/login/*-webflow.xml"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/webflow:flow-registry&gt;</span></code></pre></figure>

<h3 id="login-flowxml-overview">login-flow.xml Overview</h3>

<p>The login flow is at a high level composed of the following phases:</p>

<ul>
  <li>Initialization of the flow</li>
  <li>Validation of Ticket Granting Ticket (TGT)</li>
  <li>Validation of requesting service and ensuring that it is authorized to use CAS</li>
  <li>Generation of the Login Ticket (LT)</li>
  <li>Presentation of the Login Form</li>
  <li>Generation of TGT upon successful authentication</li>
  <li>Generation of Service Ticket (ST) for the requesting service</li>
  <li>Issuing a redirect back to the authenticating web service</li>
</ul>

<p>A high-level diagram detailing major states in the flow is presented here:</p>

<p><img src="http://i.imgur.com/SBDUGbH.png" alt="" /></p>

<p>Acceptance of user credentials and invoking the authentication handler components is carried out by:</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"authenticationViaFormAction"</span> <span class="na">class=</span><span class="s">"org.jasig.cas.web.flow.AuthenticationViaFormAction"</span>
        <span class="na">p:centralAuthenticationService-ref=</span><span class="s">"centralAuthenticationService"</span>
        <span class="na">p:warnCookieGenerator-ref=</span><span class="s">"warnCookieGenerator"</span><span class="nt">/&gt;</span></code></pre></figure>

<p>Handling authentication failures, mapping the result of which event to a new state is carried out by:</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"authenticationExceptionHandler"</span> <span class="na">class=</span><span class="s">"org.jasig.cas.web.flow.AuthenticationExceptionHandler"</span> <span class="nt">/&gt;</span>

...

<span class="nt">&lt;action-state</span> <span class="na">id=</span><span class="s">"realSubmit"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;evaluate</span> <span class="na">expression=</span><span class="s">"authenticationViaFormAction.submit(flowRequestContext, flowScope.credential, messageContext)"</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;transition</span> <span class="na">on=</span><span class="s">"success"</span> <span class="na">to=</span><span class="s">"sendTicketGrantingTicket"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;transition</span> <span class="na">on=</span><span class="s">"authenticationFailure"</span> <span class="na">to=</span><span class="s">"handleAuthenticationFailure"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;transition</span> <span class="na">on=</span><span class="s">"error"</span> <span class="na">to=</span><span class="s">"generateLoginTicket"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/action-state&gt;</span>

....
<span class="nt">&lt;action-state</span> <span class="na">id=</span><span class="s">"handleAuthenticationFailure"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;evaluate</span> <span class="na">expression=</span><span class="s">"authenticationExceptionHandler.handle(currentEvent.attributes.error, messageContext)"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;transition</span> <span class="na">on=</span><span class="s">"AccountDisabledException"</span> <span class="na">to=</span><span class="s">"casAccountDisabledView"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;transition</span> <span class="na">on=</span><span class="s">"AccountLockedException"</span> <span class="na">to=</span><span class="s">"casAccountLockedView"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;transition</span> <span class="na">on=</span><span class="s">"CredentialExpiredException"</span> <span class="na">to=</span><span class="s">"casExpiredPassView"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;transition</span> <span class="na">on=</span><span class="s">"InvalidLoginLocationException"</span> <span class="na">to=</span><span class="s">"casBadWorkstationView"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;transition</span> <span class="na">on=</span><span class="s">"InvalidLoginTimeException"</span> <span class="na">to=</span><span class="s">"casBadHoursView"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;transition</span> <span class="na">on=</span><span class="s">"FailedLoginException"</span> <span class="na">to=</span><span class="s">"generateLoginTicket"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;transition</span> <span class="na">on=</span><span class="s">"AccountNotFoundException"</span> <span class="na">to=</span><span class="s">"generateLoginTicket"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;transition</span> <span class="na">on=</span><span class="s">"UNKNOWN"</span> <span class="na">to=</span><span class="s">"generateLoginTicket"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/action-state&gt;</span></code></pre></figure>

<p>Certain error conditions are also classified as global transitions, particularly in cases of unauthorized services attempting to use CAS:</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;global-transitions&gt;</span>
    <span class="nt">&lt;transition</span> <span class="na">to=</span><span class="s">"viewLoginForm"</span> <span class="na">on-exception=</span><span class="s">"org.jasig.cas.services.UnauthorizedSsoServiceException"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;transition</span> <span class="na">to=</span><span class="s">"viewServiceErrorView"</span> <span class="na">on-exception=</span><span class="s">"org.springframework.webflow.execution.repository.NoSuchFlowExecutionException"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;transition</span> <span class="na">to=</span><span class="s">"viewServiceErrorView"</span> <span class="na">on-exception=</span><span class="s">"org.jasig.cas.services.UnauthorizedServiceException"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/global-transitions&gt;</span></code></pre></figure>

<h2 id="logout-flow">Logout Flow</h2>
<p>The flow in CAS is given a unique id that is registered inside a <code class="language-plaintext highlighter-rouge">flowRegistry</code> component. Support is enabled via the following configuration snippets in <code class="language-plaintext highlighter-rouge">cas-servlet.xml</code>:</p>

<h3 id="components-1">Components</h3>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;webflow:flow-executor</span> <span class="na">id=</span><span class="s">"logoutFlowExecutor"</span> <span class="na">flow-registry=</span><span class="s">"logoutFlowRegistry"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;webflow:flow-execution-attributes&gt;</span>
      <span class="nt">&lt;webflow:always-redirect-on-pause</span> <span class="na">value=</span><span class="s">"false"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;webflow:redirect-in-same-state</span> <span class="na">value=</span><span class="s">"false"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/webflow:flow-execution-attributes&gt;</span>
<span class="nt">&lt;/webflow:flow-executor&gt;</span>

...

<span class="nt">&lt;webflow:flow-registry</span> <span class="na">id=</span><span class="s">"logoutFlowRegistry"</span> 
     <span class="na">flow-builder-services=</span><span class="s">"builder"</span> <span class="na">base-path=</span><span class="s">"/WEB-INF/webflow"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;webflow:flow-location-pattern</span> <span class="na">value=</span><span class="s">"/logout/*-webflow.xml"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/webflow:flow-registry&gt;</span></code></pre></figure>

<p>###logout-flow.xml Overview
The logout flow is at a high level composed of the following phases:</p>

<ul>
  <li>Termination of the SSO session and destruction of the TGT</li>
  <li>Initiating the Logout protocol</li>
  <li>Handling various methods of logout (front-channel, back-channel, etc)</li>
</ul>

<p>The Logout protocol is initiated by the following component:</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"logoutAction"</span> <span class="na">class=</span><span class="s">"org.jasig.cas.web.flow.LogoutAction"</span>
        <span class="na">p:servicesManager-ref=</span><span class="s">"servicesManager"</span>
        <span class="na">p:followServiceRedirects=</span><span class="s">"${cas.logout.followServiceRedirects:false}"</span><span class="nt">/&gt;</span></code></pre></figure>

<p>Front-channel method of logout is specifically handled by the following component:</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"frontChannelLogoutAction"</span> <span class="na">class=</span><span class="s">"org.jasig.cas.web.flow.FrontChannelLogoutAction"</span>
        <span class="na">c:logoutManager-ref=</span><span class="s">"logoutManager"</span><span class="nt">/&gt;</span></code></pre></figure>

<h2 id="web-flow-session-encryption">Web Flow Session Encryption</h2>
<p>CAS provides a facility for storing flow execution state on the client in Spring Webflow. Flow state is stored as an encoded byte 
stream in the flow execution identifier provided to the client when rendering a view. The following features are presented via this strategy:</p>

<ul>
  <li>Support for conversation management (e.g. flow scope)</li>
  <li>Encryption of encoded flow state to prevent tampering by malicious clients</li>
</ul>

<p>CAS automatically attempts to store 
and keep track of this state on the client in an encrypted form to remove the need for session cleanup, termination and replication.</p>

<p>Default encryption strategy controlled via the <code class="language-plaintext highlighter-rouge">loginFlowStateTranscoder</code> component.
These settings can be controlled via the following defined in the <code class="language-plaintext highlighter-rouge">cas.properties</code> file:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="c"># The encryption secret key. By default, must be a size 16.
# webflow.encryption.key=
</span>
<span class="c"># The signing secret key. By default, must be a octet string of size 512.
# webflow.signing.key=
</span></pre></td></tr></tbody></table></code></pre></div></div>

<div class="alert alert-warning"><strong>Usage Warning!</strong><p>
While the above settings are all optional, it is recommended that you provide your own configuration and settings for encrypting and
transcoding of the web session state.</p></div>

<p>If keys are left undefined, on startup CAS will notice that no keys are defined and it will appropriately generate keys for you automatically. Your CAS logs will then show the following snippet:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>WARN <span class="o">[</span>org.jasig.cas.util.BinaryCipherExecutor] - &lt;Secret key <span class="k">for </span>encryption is not defined. CAS will attempt to auto-generate the encryption key&gt;
WARN <span class="o">[</span>org.jasig.cas.util.BinaryCipherExecutor] - &lt;Generated encryption key ABC of size ... <span class="nb">.</span> The generated key MUST be added to CAS settings.&gt;
WARN <span class="o">[</span>org.jasig.cas.util.BinaryCipherExecutor] - &lt;Secret key <span class="k">for </span>signing is not defined. CAS will attempt to auto-generate the signing key&gt;
WARN <span class="o">[</span>org.jasig.cas.util.BinaryCipherExecutor] - &lt;Generated signing key XYZ of size ... <span class="nb">.</span> The generated key MUST be added to CAS settings.&gt;
</pre></td></tr></tbody></table></code></pre></div></div>

<p>You should then grab each generated key for encryption and signing, and put them inside your cas.properties file for each now-enabled setting.</p>

<p>If you wish to manually generate the above keys and not have CAS do that for you, you could <a href="https://github.com/mitreid-connect/json-web-key-generator.git">download/clone</a> and build this project and invoke its executable to generate keys of appropriate size.</p>

<h2 id="required-service-for-authentication-flow">Required Service for Authentication Flow</h2>
<p>By default, CAS will present a generic success page if the initial authentication request does not identify
the target application. In some cases, the ability to login to CAS without logging
in to a particular service may be considered a misfeature because in practice, too few users and institutions
are prepared to understand, brand, and support what is at best a fringe use case of logging in to CAS for the
sake of establishing an SSO session without logging in to any CAS-reliant service.</p>

<p>As such, CAS optionally allows adopters to not bother to prompt for credentials when no target application is presented
and instead presents a message when users visit CAS directly without specifying a service.</p>

<p>This behavior is controlled via <code class="language-plaintext highlighter-rouge">cas.properties</code>:</p>

<figure class="highlight"><pre><code class="language-properties" data-lang="properties"><span class="c"># Indicates whether an SSO session can be created if no service is present.
</span><span class="err">#</span> <span class="py">create.sso.missing.service</span><span class="p">=</span><span class="s">false</span></code></pre></figure>

<h2 id="extending-the-webflow">Extending the Webflow</h2>
<p>The CAS webflow provides discrete points to inject new functionality. Thus, the only thing to modify is the flow definition where new beans and views can be added easily with the Maven overlay build method.</p>

<h3 id="adding-actions">Adding Actions</h3>
<p>Adding Spring Web Flow actions typically involves the following steps:</p>

<ul>
  <li>Adding a SWF-specific Spring bean type that extends <code class="language-plaintext highlighter-rouge">org.springframework.webflow.action.AbstractAction</code></li>
  <li>Access to the flow scope object also accessible in the flow definition file</li>
  <li><code class="language-plaintext highlighter-rouge">doExecute()</code> method contains business logic and returns <code class="language-plaintext highlighter-rouge">success()</code> or <code class="language-plaintext highlighter-rouge">error()</code> Event types</li>
  <li>Returned Event types are evaluated in the flow definition file</li>
</ul>

<p>Once the action bean is configured, you may define it inside the <code class="language-plaintext highlighter-rouge">login-webflow.xml</code>:</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;action-state</span> <span class="na">id=</span><span class="s">"actionStateId"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;action</span> <span class="na">bean=</span><span class="s">"customActionBeanId"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;transition</span> <span class="na">on=</span><span class="s">"success"</span> <span class="na">to=</span><span class="s">"doThis"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;transition</span> <span class="na">on=</span><span class="s">"error"</span> <span class="na">to=</span><span class="s">"doThat"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/action-state&gt;</span></code></pre></figure>

<h3 id="adding-views">Adding Views</h3>
<p>Adding Spring Web Flow views involves the following steps:</p>

<ul>
  <li>The name of the view directly referenced from the flow definition file</li>
  <li>The name of the view must match the view file name</li>
</ul>

<p>A sample is presented here:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c">### View for password update</span>
passwordUpdateView.<span class="o">(</span>class<span class="o">)=</span>org.springframework.web.servlet.view.JstlView
passwordUpdateView.url<span class="o">=</span>/WEB-INF/view/jsp/default/ui/passwordUpdateView.jsp</code></pre></figure>

<h2 id="acceptable-usage-policy-flow">Acceptable Usage Policy Flow</h2>
<p>CAS presents the ability to allow the user to accept the usage policy before moving on to the application. The task of remembering the user’s choice is kept in memory by default and will be lost upon container restarts and/or in clustered deployments. Production-level deployments of this feature would require modifications to the flow such that the retrieval and/or acceptance of the policy would be handled via an external storage mechanism such as LDAP or JDBC.</p>

<h3 id="configuration">Configuration</h3>

<h4 id="enable-webflow">Enable Webflow</h4>

<ul>
  <li>In the <code class="language-plaintext highlighter-rouge">login-webflow.xml</code> file, enable the transition to <code class="language-plaintext highlighter-rouge">acceptableUsagePolicyCheck</code> by uncommenting the following entry:</li>
</ul>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;transition</span> <span class="na">on=</span><span class="s">"success"</span> <span class="na">to=</span><span class="s">"acceptableUsagePolicyCheck"</span> <span class="nt">/&gt;</span></code></pre></figure>

<ul>
  <li>Enable the actual flow components by uncommenting the following entries:</li>
</ul>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="c">&lt;!-- Enable AUP flow	
&lt;action-state id="acceptableUsagePolicyCheck"&gt;
    &lt;evaluate expression="acceptableUsagePolicyFormAction.verify(flowRequestContext, flowScope.credential, messageContext)" /&gt;
    &lt;transition on="success" to="sendTicketGrantingTicket" /&gt;
    &lt;transition to="acceptableUsagePolicyView" /&gt;
&lt;/action-state&gt;
...

--&gt;</span></code></pre></figure>

<ul>
  <li>Customize the policy by modifying <code class="language-plaintext highlighter-rouge">casAcceptableUsagePolicyView.jsp</code> located at <code class="language-plaintext highlighter-rouge">src/main/webapp/WEB-INF/view/jsp/default/ui</code>.</li>
</ul>

<h4 id="configure-storage">Configure Storage</h4>

<p>The task of remembering and accepting the policy is handled by <code class="language-plaintext highlighter-rouge">AcceptableUsagePolicyFormAction</code>. Adopters may extend this class to retrieve and persistent the user’s choice via an external backend mechanism such as LDAP or JDBC.</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"acceptableUsagePolicyFormAction"</span> 
      <span class="na">class=</span><span class="s">"org.jasig.cas.web.flow.AcceptableUsagePolicyFormAction"</span><span class="nt">/&gt;</span></code></pre></figure>


                </div>
            </section>
        </main>
    </div>
</div>


<footer>
    <div class="container">
        CAS is supported by the <a href="https://www.apereo.org/">Apereo Foundation</a>.
    </div>
</footer>

<script>
    let pageSection = '';
</script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.3.2/js/tether.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js"></script>

<script src="../../javascripts/URI.js"></script>
<script src="../../javascripts/main.js"></script>

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script>
<script type="text/javascript" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
</body>

</html>
