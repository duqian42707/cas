<!DOCTYPE html>
<html>

<head>
    <!-- Required meta tags always come first -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="CAS - Enterprise Single Sign-On for the Web"/>
    <meta name="keywords" content="authentication, login, cas, central authentication service, web, java, protocol, thymeleaf,
                   open source, boot, spring, authorization, google, facebook, twitter, higher-ed, enterprise,
                   access management, single signon, sso, RBAC, ABAC, attributes, SAML, OpenID, openid connect,
                   JWT, ADFS"/>
    <meta name="robots" content="index,follow"/>

    
    

        
    


    

    <script>
        ((i, s, o, g, r, a, m) => {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-83384532-2', 'auto');
        ga('send', 'pageview');

    </script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3"/>

    <link rel="stylesheet" type="text/css" media="screen" href="../../stylesheets/stylesheet.css">
    <link rel="stylesheet" type="text/css" media="print" href="../../stylesheets/print.css">

    <link href='https://fonts.googleapis.com/css?family=Lato:400,300,700' rel='stylesheet'>
    <link href='https://fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic&subset=latin-ext,latin' rel='stylesheet'>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@100;200;300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css" rel="stylesheet">

    <title>CAS - Ehcache Ticket Registry</title>

</head>

<body>
<!-- HEADER -->
<header class="hidden-sm-down">
    <div class="container">
        <div class="row">
            <div class="col-xs-4 col-md-2">
                <a href="../../index.html">
                    <img class="undecorated" src="../../images/cas_logo.png"/>
                </a>
            </div>
            <div class="col-xs-8 col-md-6">
                <h1>Enterprise Single Sign-On for All</h1>
            </div>
            <div class="hidden-sm-down col-md-4">
                <a id="forkme_banner" href="https://github.com/apereo/cas">View on GitHub</a>
            </div>

        </div>
    </div>
</header>

<!-- NAVBAR -->

<nav class="navbar navbar-expand-md navbar-dark bg-primary bg-dark">
    <div class="container">
        <button class="navbar-toggler collapsed" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarsExample04" aria-controls="navbarsExample04" aria-expanded="false"
                aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="navbar-collapse collapse" id="navbarsExample04">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active"><a href="../../index.html" class="zoom nav-link">Home</a></li>
                <li class="nav-item"><a href="https://github.com/apereo/cas/releases" class="zoom nav-link">Releases</a></li>
                <li class="nav-item"><a href="../../Support.html" class="zoom nav-link">Support</a></li>
                <li class="nav-item"><a href="../../Mailing-Lists.html" class="zoom nav-link">Mailing Lists</a></li>
                <li class="nav-item">
                    <a class="zoom nav-link" href="../../Demos.html">Demos</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="zoom nav-link dropdown-toggle mr-md-2" href="#" id="cas-versions" data-bs-toggle="dropdown"
                       aria-haspopup="true" aria-expanded="false">Versions</a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="cas-versions">
                        
                        
                        <a class="dropdown-item" href="/cas/development/">Development</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.6.x/">v6.6.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.5.x/">v6.5.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.4.x/">v6.4.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.3.x/">v6.3.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.2.x/">v6.2.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.1.x/">v6.1.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.0.x/">v6.0.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.3.x/">v5.3.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.2.x/">v5.2.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.1.x/">v5.1.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.0.x/">v5.0.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/4.2.x/">v4.2.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/4.1.x/">v4.1.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/4.0.x/">v4.0.x</a>
                        
                        

                    </div>
                </li>
                <li class="nav-item"><a href="https://apereo.github.io" target="_blank" class="zoom nav-link">Blog</a></li>
            </ul>

        </div>

    </div>
</nav>


<div class="container-fluid">
    <div class="row flex-xl-nowrap">
        <div class="col-12 col-md-3 col-xl-2 docs-sidebar pb-5" id="sidebar"></div>


        <div class="d-none d-xl-block col-xl-2 docs-toc">
    <div id="pageContents">
        <ul class="section-nav"></ul>
    </div>
</div>


        <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 cas-docs-content" role="main">


            

            <section>
                <nav id="docsNavBar">
                    <span id="toolbarIcons"></span>
                </nav>

                <div id="cas-docs-container">
                    <h1 id="ehcache-ticket-registry">Ehcache Ticket Registry</h1>
<p>Ehcache integration is enabled by including the following dependency in the Maven WAR overlay:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>&lt;dependency&gt;
     &lt;groupId&gt;org.jasig.cas&lt;/groupId&gt;
     &lt;artifactId&gt;cas-server-integration-ehcache&lt;/artifactId&gt;
     &lt;version&gt;${cas.version}&lt;/version&gt;
&lt;/dependency&gt;
</pre></td></tr></tbody></table></code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">EhCacheTicketRegistry</code> stores tickets in an <a href="http://ehcache.org/">Ehcache</a> instance.</p>

<p>We present two configurations:</p>

<ol>
  <li>Single instance memory-backed cache with disk overflow for simple cases.</li>
  <li>Distributed cache with peer replication over RMI for HA deployments.</li>
</ol>

<h2 id="memory-cache-with-disk-overflow">Memory Cache with Disk Overflow</h2>
<p>The following Spring configuration provides a template for <code class="language-plaintext highlighter-rouge">ticketRegistry.xml</code>.</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"ticketRegistry"</span>
      <span class="na">class=</span><span class="s">"org.jasig.cas.ticket.registry.EhCacheTicketRegistry"</span>
      <span class="na">p:serviceTicketsCache-ref=</span><span class="s">"serviceTicketsCache"</span>
      <span class="na">p:ticketGrantingTicketsCache-ref=</span><span class="s">"ticketGrantingTicketsCache"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"abstractTicketCache"</span> <span class="na">abstract=</span><span class="s">"true"</span>
      <span class="na">class=</span><span class="s">"org.springframework.cache.ehcache.EhCacheFactoryBean"</span>
      <span class="na">p:cacheManager-ref=</span><span class="s">"cacheManager"</span>
      <span class="na">p:diskExpiryThreadIntervalSeconds=</span><span class="s">"0"</span>
      <span class="na">p:diskPersistent=</span><span class="s">"false"</span>
      <span class="na">p:eternal=</span><span class="s">"false"</span>
      <span class="na">p:maxElementsInMemory=</span><span class="s">"10000"</span>
      <span class="na">p:maxElementsOnDisk=</span><span class="s">"20000"</span>
      <span class="na">p:memoryStoreEvictionPolicy=</span><span class="s">"LRU"</span>
      <span class="na">p:overflowToDisk=</span><span class="s">"true"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"serviceTicketsCache"</span>
      <span class="na">class=</span><span class="s">"org.springframework.cache.ehcache.EhCacheFactoryBean"</span>
      <span class="na">parent=</span><span class="s">"abstractTicketCache"</span>
      <span class="na">p:cacheName=</span><span class="s">"cas_st"</span>
      <span class="na">p:timeToIdle=</span><span class="s">"0"</span>
      <span class="na">p:timeToLive=</span><span class="s">"300"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"ticketGrantingTicketsCache"</span>
      <span class="na">class=</span><span class="s">"org.springframework.cache.ehcache.EhCacheFactoryBean"</span>
      <span class="na">p:cacheName=</span><span class="s">"cas_tgt"</span>
      <span class="na">parent=</span><span class="s">"abstractTicketCache"</span>
      <span class="na">p:timeToIdle=</span><span class="s">"0"</span>
      <span class="na">p:timeToLive=</span><span class="s">"7201"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"cacheManager"</span>
      <span class="na">class=</span><span class="s">"org.springframework.cache.ehcache.EhCacheManagerFactoryBean"</span>
      <span class="na">p:configLocation=</span><span class="s">"classpath:ehcache-failsafe.xml"</span>
      <span class="na">p:shared=</span><span class="s">"false"</span>
      <span class="na">p:cacheManagerName=</span><span class="s">"ticketRegistryCacheManager"</span> <span class="nt">/&gt;</span></code></pre></figure>

<p>The Ehcache configuration file <code class="language-plaintext highlighter-rouge">ehcache-failsafe.xml</code> mentioned in the Spring configuration above:</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;ehcache</span> <span class="na">updateCheck=</span><span class="s">"false"</span>
         <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="na">xsi:noNamespaceSchemaLocation=</span><span class="s">"http://ehcache.org/ehcache.xsd"</span><span class="nt">&gt;</span>

  <span class="nt">&lt;diskStore</span> <span class="na">path=</span><span class="s">"java.io.tmpdir/cas"</span><span class="nt">/&gt;</span>

<span class="nt">&lt;/ehcache&gt;</span></code></pre></figure>

<h2 id="distributed-cache">Distributed Cache</h2>
<p>Distributed caches are recommended for HA architectures since they offer fault tolerance in the ticket storage subsystem. The registry maintains service tickets and ticket-granting tickets in two separate caches, so that:</p>

<ul>
  <li>Ticket Granting Tickets remain valid for a long time, replicated asynchronously</li>
  <li>Service Tickets are short lived and must be replicated right away because the requests to validate them may very likely arrive at different CAS cluster nodes</li>
</ul>

<h3 id="rmi-replication">RMI Replication</h3>
<p>Ehcache supports <a href="http://docs.oracle.com/javase/6/docs/technotes/guides/rmi/index.html">RMI</a> replication for distributed caches composed of two or more nodes. To learn more about RMI replication with Ehcache, <a href="http://ehcache.org/documentation/user-guide/rmi-replicated-caching">see this resource</a>.</p>

<h4 id="spring-configuration-template-for-ticketregistryxml">Spring configuration template for <code class="language-plaintext highlighter-rouge">ticketRegistry.xml</code>.</h4>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"ticketRegistry"</span>
      <span class="na">class=</span><span class="s">"org.jasig.cas.ticket.registry.EhCacheTicketRegistry"</span>
      <span class="na">p:serviceTicketsCache-ref=</span><span class="s">"serviceTicketsCache"</span>
      <span class="na">p:ticketGrantingTicketsCache-ref=</span><span class="s">"ticketGrantingTicketsCache"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"abstractTicketCache"</span> <span class="na">abstract=</span><span class="s">"true"</span>
      <span class="na">class=</span><span class="s">"org.springframework.cache.ehcache.EhCacheFactoryBean"</span>
      <span class="na">p:cacheManager-ref=</span><span class="s">"cacheManager"</span>
      <span class="na">p:diskExpiryThreadIntervalSeconds=</span><span class="s">"0"</span>
      <span class="na">p:diskPersistent=</span><span class="s">"false"</span>
      <span class="na">p:eternal=</span><span class="s">"false"</span>
      <span class="na">p:maxElementsInMemory=</span><span class="s">"10000"</span>
      <span class="na">p:maxElementsOnDisk=</span><span class="s">"20000"</span>
      <span class="na">p:memoryStoreEvictionPolicy=</span><span class="s">"LRU"</span>
      <span class="na">p:overflowToDisk=</span><span class="s">"true"</span>
      <span class="na">p:bootstrapCacheLoader-ref=</span><span class="s">"ticketCacheBootstrapCacheLoader"</span> <span class="nt">/&gt;</span>

<span class="c">&lt;!-- MUST use synchronous repl for service tickets for correct behavior. --&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"serviceTicketsCache"</span>
      <span class="na">class=</span><span class="s">"org.springframework.cache.ehcache.EhCacheFactoryBean"</span>
      <span class="na">parent=</span><span class="s">"abstractTicketCache"</span>
      <span class="na">p:cacheName=</span><span class="s">"cas_st"</span>
      <span class="na">p:timeToIdle=</span><span class="s">"0"</span>
      <span class="na">p:timeToLive=</span><span class="s">"300"</span>
      <span class="na">p:cacheEventListeners-ref=</span><span class="s">"ticketRMISynchronousCacheReplicator"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"ticketGrantingTicketsCache"</span>
      <span class="na">class=</span><span class="s">"org.springframework.cache.ehcache.EhCacheFactoryBean"</span>
      <span class="na">parent=</span><span class="s">"abstractTicketCache"</span>
      <span class="na">p:cacheName=</span><span class="s">"cas_tgt"</span>
      <span class="na">p:timeToIdle=</span><span class="s">"0"</span>
      <span class="na">p:timeToLive=</span><span class="s">"7201"</span>
      <span class="na">p:cacheEventListeners-ref=</span><span class="s">"ticketRMIAsynchronousCacheReplicator"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"cacheManager"</span>
      <span class="na">class=</span><span class="s">"org.springframework.cache.ehcache.EhCacheManagerFactoryBean"</span>
      <span class="na">p:configLocation=</span><span class="s">"classpath:ehcache-replicated.xml"</span>
      <span class="na">p:shared=</span><span class="s">"false"</span>
      <span class="na">p:cacheManagerName=</span><span class="s">"ticketRegistryCacheManager"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"ticketRMISynchronousCacheReplicator"</span>
      <span class="na">class=</span><span class="s">"net.sf.ehcache.distribution.RMISynchronousCacheReplicator"</span>
      <span class="na">c:replicatePuts=</span><span class="s">"true"</span>
      <span class="na">c:replicatePutsViaCopy=</span><span class="s">"true"</span>
      <span class="na">c:replicateUpdates=</span><span class="s">"true"</span>
      <span class="na">c:replicateUpdatesViaCopy=</span><span class="s">"true"</span>
      <span class="na">c:replicateRemovals=</span><span class="s">"true"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"ticketRMIAsynchronousCacheReplicator"</span>
      <span class="na">class=</span><span class="s">"net.sf.ehcache.distribution.RMIAsynchronousCacheReplicator"</span>
      <span class="na">parent=</span><span class="s">"ticketRMISynchronousCacheReplicator"</span>
      <span class="na">c:replicationInterval=</span><span class="s">"10000"</span>
      <span class="na">c:maximumBatchSize=</span><span class="s">"100"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"ticketCacheBootstrapCacheLoader"</span>
      <span class="na">class=</span><span class="s">"net.sf.ehcache.distribution.RMIBootstrapCacheLoader"</span>
      <span class="na">c:asynchronous=</span><span class="s">"true"</span>
      <span class="na">c:maximumChunkSize=</span><span class="s">"5000000"</span> <span class="nt">/&gt;</span></code></pre></figure>

<p>The Ehcache configuration for <code class="language-plaintext highlighter-rouge">ehcache-replicated.xml</code> mentioned in the Spring config follows.</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;ehcache</span> <span class="na">name=</span><span class="s">"ehCacheTicketRegistryCache"</span>
    <span class="na">updateCheck=</span><span class="s">"false"</span>
    <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="na">xsi:noNamespaceSchemaLocation=</span><span class="s">"http://ehcache.org/ehcache.xsd"</span><span class="nt">&gt;</span>

  <span class="nt">&lt;diskStore</span> <span class="na">path=</span><span class="s">"java.io.tmpdir/cas"</span><span class="nt">/&gt;</span>

  <span class="c">&lt;!--
     | Automatic peer discovery
     | See http://ehcache.org/documentation/user-guide/rmi-replicated-caching#automatic-peer-discovery
     | for more information.
     --&gt;</span>
  <span class="c">&lt;!--
  &lt;cacheManagerPeerProviderFactory
        class="net.sf.ehcache.distribution.RMICacheManagerPeerProviderFactory"
        properties="peerDiscovery=automatic, multicastGroupAddress=230.0.0.1, multicastGroupPort=4446, timeToLive=32"
        propertySeparator="," /&gt;
  --&gt;</span>

  <span class="c">&lt;!--
     | Manual peer discovery
     | See http://ehcache.org/documentation/user-guide/rmi-replicated-caching#manual-peer-discovery-manual-peer-discovery
     | for more information
     --&gt;</span>
  <span class="nt">&lt;cacheManagerPeerProviderFactory</span>
      <span class="na">class=</span><span class="s">"net.sf.ehcache.distribution.RMICacheManagerPeerProviderFactory"</span>
      <span class="na">properties=</span><span class="s">"peerDiscovery=manual,rmiUrls=//peer-2:41001/cas_st|//peer-3:41001/cas_st|//peer-2:41001/cas_tgt|//peer-3:41001/cas_tgt"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;cacheManagerPeerListenerFactory</span>
      <span class="na">class=</span><span class="s">"net.sf.ehcache.distribution.RMICacheManagerPeerListenerFactory"</span>
      <span class="na">properties=</span><span class="s">"port=41001,remoteObjectPort=41002"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/ehcache&gt;</span></code></pre></figure>

<p>Use either manual or automatic peer discovery to assemble members of distributed cache. If manual discover is used
for configuration, the file would vary according to the node on which CAS is deployed. For that reason it may be
helpful to place the configuration file on the filesystem at a well-known location and reference it in the
<code class="language-plaintext highlighter-rouge">EhCacheManagerFactoryBean</code> above as follows:</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"cacheManager"</span>
      <span class="na">class=</span><span class="s">"org.springframework.cache.ehcache.EhCacheManagerFactoryBean"</span>
      <span class="na">p:configLocation=</span><span class="s">"file:/path/to/well-known/ehcache-replicated.xml"</span>
      <span class="na">p:shared=</span><span class="s">"false"</span>
      <span class="na">p:cacheManagerName=</span><span class="s">"ticketRegistryCacheManager"</span> <span class="nt">/&gt;</span></code></pre></figure>

<h3 id="jgroups-replication">JGroups Replication</h3>
<p><a href="http://ehcache.org/documentation/2.5/replication/jgroups-replicated-caching">JGroups</a> can be used as the underlying mechanism for the replication operations in Ehcache. JGroups offers a very flexible protocol stack, reliable unicast, and multicast message transmission. On the down side JGroups can be complex to configure and some protocol stacks have dependencies on others.</p>

<h4 id="spring-configuration-template-for-ticketregistryxml-1">Spring configuration template for <code class="language-plaintext highlighter-rouge">ticketRegistry.xml</code>.</h4>
<p>The configuration is similar to above, except that ticket replicators and cache loaders need to be swapped out for their JGroups counterpart:</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml">...
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"ticketjgroupsSynchronousCacheReplicator"</span> <span class="na">class=</span><span class="s">"net.sf.ehcache.distribution.jgroups.JGroupsCacheReplicator"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">"replicatePuts"</span> <span class="na">value=</span><span class="s">"true"</span><span class="nt">/&gt;</span> 
    <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">"replicateUpdates"</span> <span class="na">value=</span><span class="s">"true"</span><span class="nt">/&gt;</span>  
    <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">"replicateUpdatesViaCopy"</span> <span class="na">value=</span><span class="s">"true"</span><span class="nt">/&gt;</span>  
    <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">"replicateRemovals"</span> <span class="na">value=</span><span class="s">"true"</span><span class="nt">/&gt;</span>       
<span class="nt">&lt;/bean&gt;</span>
 
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"ticketjgroupsAsynchronousCacheReplicator"</span> <span class="na">class=</span><span class="s">"net.sf.ehcache.distribution.jgroups.JGroupsCacheReplicator"</span> <span class="na">parent=</span><span class="s">"ticketjgroupsSynchronousCacheReplicator"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">"asynchronousReplicationInterval"</span> <span class="na">value=</span><span class="s">"1000"</span><span class="nt">/&gt;</span>  
<span class="nt">&lt;/bean&gt;</span>
 
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"ticketCacheBootstrapCacheLoader"</span> <span class="na">class=</span><span class="s">"net.sf.ehcache.distribution.jgroups.JGroupsBootstrapCacheLoader"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">"asynchronous"</span> <span class="na">value=</span><span class="s">"true"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">"maximumChunkSize"</span> <span class="na">value=</span><span class="s">"5000000"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
...</code></pre></figure>

<p>The Ehcache JGroups confguration itself needs to be altered to be similar to the following:</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;ehcache</span> <span class="na">name=</span><span class="s">"ehCacheTicketRegistryCache"</span>
    <span class="na">updateCheck=</span><span class="s">"false"</span>
    <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="na">xsi:noNamespaceSchemaLocation=</span><span class="s">"http://ehcache.sf.net/ehcache.xsd"</span><span class="nt">&gt;</span>

   <span class="nt">&lt;diskStore</span> <span class="na">path=</span><span class="s">"java.io.tmpdir/cas"</span><span class="nt">/&gt;</span>
   
   <span class="c">&lt;!-- Using UDP multicast stack --&gt;</span>
   <span class="nt">&lt;cacheManagerPeerProviderFactory</span>
        <span class="na">class=</span><span class="s">"net.sf.ehcache.distribution.jgroups.JGroupsCacheManagerPeerProviderFactory"</span>
        <span class="na">properties=</span><span class="s">"connect=UDP(mcast_addr=231.12.21.132;mcast_port=45566;):PING:
        MERGE2:FD_SOCK:VERIFY_SUSPECT:pbcast.NAKACK:UNICAST:pbcast.STABLE:FRAG:pbcast.GMS"</span>
        <span class="na">propertySeparator=</span><span class="s">"::"</span>
        <span class="nt">/&gt;</span>

<span class="nt">&lt;/ehcache&gt;</span></code></pre></figure>

<p>Your maven overlay <code class="language-plaintext highlighter-rouge">pom.xml</code> will also need to declare the following dependencies:</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.jgroups<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>jgroups<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>${jgroups.version}<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>net.sf.ehcache<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>ehcache-jgroupsreplication<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>${ehcache-jgroups.version}<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>                   </code></pre></figure>

<h3 id="eviction-policy">Eviction Policy</h3>
<p>Ehcache manages the internal eviction policy of cached objects via <code class="language-plaintext highlighter-rouge">timeToIdle</code> and <code class="language-plaintext highlighter-rouge">timeToLive</code> settings. This results of having <em>no need</em> for a Ticket Registry Cleaner.</p>

<p>There have been reports of cache eviction problems when tickets are expired, but haven’t been removed from the cache due to ehache configuration. This can be a problem because old ticket references “hang around” in the cache despite being expired. In other words, Ehcache does <a href="http://lists.terracotta.org/pipermail/ehcache-list/2011-November/000423.html">inline eviction</a> where expired objects in the cache object won’t be collected from memory until the cache max size is reached or the expired entry is explicitly accessed. To reclaim memory on expired tickets, cache eviction policies are must be carefully configured to avoid memory creep. Disk offload and/or a more aggressive eviction could provide a suitable workaround.</p>

<h3 id="troubleshooting-guidelines">Troubleshooting Guidelines</h3>

<ul>
  <li>
    <p>You will need to ensure that network communication across CAS nodes is allowed and no firewall or other component is blocking traffic.</p>
  </li>
  <li>If you are running this on a server with active firewalls, you will probably need to specify a fixed <code class="language-plaintext highlighter-rouge">remoteObjectPort</code>, within the <code class="language-plaintext highlighter-rouge">cacheManagerPeerListenerFactory</code>.</li>
  <li>Depending on environment settings and version of Ehcache used, you may also have to adjust the <code class="language-plaintext highlighter-rouge">shared</code> setting above.</li>
  <li>Ensure that each cache manager specified a name that matches the Ehcache configuration itself.</li>
  <li>You may also need to adjust your expiration policy to allow for a larger time span, specially for service tickets depending on network traffic and communication delay across CAS nodes particualrly in the event that a node is trying to join the cluster.</li>
</ul>

                </div>
            </section>
        </main>
    </div>
</div>


<footer>
    <div class="container">
        CAS is supported by the <a href="https://www.apereo.org/">Apereo Foundation</a>.
    </div>
</footer>

<script>
    let pageSection = '';
</script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.3.2/js/tether.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js"></script>

<script src="../../javascripts/URI.js"></script>
<script src="../../javascripts/main.js"></script>

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script>
<script type="text/javascript" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
</body>

</html>
