<!DOCTYPE html>
<html>

<head>
    <!-- Required meta tags always come first -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="CAS - Enterprise Single Sign-On for the Web"/>
    <meta name="keywords" content="authentication, login, cas, central authentication service, web, java, protocol, thymeleaf,
                   open source, boot, spring, authorization, google, facebook, twitter, higher-ed, enterprise,
                   access management, single signon, sso, RBAC, ABAC, attributes, SAML, OpenID, openid connect,
                   JWT, ADFS"/>
    <meta name="robots" content="index,follow"/>

    
    

        
    


    

    <script>
        ((i, s, o, g, r, a, m) => {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-83384532-2', 'auto');
        ga('send', 'pageview');

    </script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3"/>

    <link rel="stylesheet" type="text/css" media="screen" href="../../stylesheets/stylesheet.css">
    <link rel="stylesheet" type="text/css" media="print" href="../../stylesheets/print.css">

    <link href='https://fonts.googleapis.com/css?family=Lato:400,300,700' rel='stylesheet'>
    <link href='https://fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic&subset=latin-ext,latin' rel='stylesheet'>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@100;200;300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css" rel="stylesheet">

    <title>CAS - OAuth Authentication</title>

</head>

<body>
<!-- HEADER -->
<header class="hidden-sm-down">
    <div class="container">
        <div class="row">
            <div class="col-xs-4 col-md-2">
                <a href="../../index.html">
                    <img class="undecorated" src="../../images/cas_logo.png"/>
                </a>
            </div>
            <div class="col-xs-8 col-md-6">
                <h1>Enterprise Single Sign-On for All</h1>
            </div>
            <div class="hidden-sm-down col-md-4">
                <a id="forkme_banner" href="https://github.com/apereo/cas">View on GitHub</a>
            </div>

        </div>
    </div>
</header>

<!-- NAVBAR -->

<nav class="navbar navbar-expand-md navbar-dark bg-primary bg-dark">
    <div class="container">
        <button class="navbar-toggler collapsed" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarsExample04" aria-controls="navbarsExample04" aria-expanded="false"
                aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="navbar-collapse collapse" id="navbarsExample04">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active"><a href="../../index.html" class="zoom nav-link">Home</a></li>
                <li class="nav-item"><a href="https://github.com/apereo/cas/releases" class="zoom nav-link">Releases</a></li>
                <li class="nav-item"><a href="../../Support.html" class="zoom nav-link">Support</a></li>
                <li class="nav-item"><a href="../../Mailing-Lists.html" class="zoom nav-link">Mailing Lists</a></li>
                <li class="nav-item">
                    <a class="zoom nav-link" href="../../Demos.html">Demos</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="zoom nav-link dropdown-toggle mr-md-2" href="#" id="cas-versions" data-bs-toggle="dropdown"
                       aria-haspopup="true" aria-expanded="false">Versions</a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="cas-versions">
                        
                        
                        <a class="dropdown-item" href="/cas/development/">Development</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.6.x/">v6.6.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.5.x/">v6.5.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.4.x/">v6.4.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.3.x/">v6.3.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.2.x/">v6.2.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.1.x/">v6.1.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.0.x/">v6.0.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.3.x/">v5.3.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.2.x/">v5.2.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.1.x/">v5.1.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.0.x/">v5.0.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/4.2.x/">v4.2.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/4.1.x/">v4.1.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/4.0.x/">v4.0.x</a>
                        
                        

                    </div>
                </li>
                <li class="nav-item"><a href="https://apereo.github.io" target="_blank" class="zoom nav-link">Blog</a></li>
            </ul>

        </div>

    </div>
</nav>


<div class="container-fluid">
    <div class="row flex-xl-nowrap">
        <div class="col-12 col-md-3 col-xl-2 docs-sidebar pb-5" id="sidebar"></div>


        <div class="d-none d-xl-block col-xl-2 docs-toc">
    <div id="pageContents">
        <ul class="section-nav"></ul>
    </div>
</div>


        <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 cas-docs-content" role="main">


            

            <section>
                <nav id="docsNavBar">
                    <span id="toolbarIcons"></span>
                </nav>

                <div id="cas-docs-container">
                    <h1 id="oauthopenid-authentication">OAuth/OpenID Authentication</h1>

<p>Allow CAS to act as an OAuth/OpenID authentication provider. Please <a href="https://oauth.net/2/">review the specification</a> to learn more.</p>

<div class="alert alert-info"><strong>CAS as OAuth Server</strong><p>This page specifically describes how to enable
OAuth/OpenID server support for CAS. If you would like to have CAS act as an OAuth/OpenID client communicating with
other providers (such as Google, Facebook, etc), <a href="../integration/Delegate-Authentication.html">see this page</a>.</p></div>

<h2 id="configuration">Configuration</h2>

<p>Support is enabled by including the following dependency in the WAR overlay:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.apereo.cas<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>cas-server-support-oauth-webflow<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>${cas.version}<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>To see the relevant list of CAS properties, please <a href="../configuration/Configuration-Properties.html#oauth2">review this guide</a>.</p>

<h2 id="endpoints">Endpoints</h2>

<p>After enabling OAuth support, the following endpoints will be available:</p>

<table>
  <thead>
    <tr>
      <th>Endpoint</th>
      <th>Description</th>
      <th>Method</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/oauth2.0/authorize</code></td>
      <td>Authorize the user and start the CAS authentication flow.</td>
      <td><code class="language-plaintext highlighter-rouge">GET</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/oauth2.0/accessToken</code>,<code class="language-plaintext highlighter-rouge">/oauth2.0/token</code></td>
      <td>Get an access token in plain-text or JSON</td>
      <td><code class="language-plaintext highlighter-rouge">POST</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/oauth2.0/profile</code></td>
      <td>Get the authenticated user profile in JSON via <code class="language-plaintext highlighter-rouge">access_token</code> parameter.</td>
      <td><code class="language-plaintext highlighter-rouge">GET</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/oauth2.0/introspect</code></td>
      <td>Query CAS to detect the status of a given access token via <a href="https://tools.ietf.org/html/rfc7662">introspection</a>.</td>
      <td><code class="language-plaintext highlighter-rouge">POST</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/oauth2.0/device</code></td>
      <td>Approve device user codes via the <a href="https://tools.ietf.org/html/draft-denniss-oauth-device-flow">device flow protocol</a>.</td>
      <td><code class="language-plaintext highlighter-rouge">POST</code></td>
    </tr>
  </tbody>
</table>

<h2 id="responsegrant-types">Response/Grant Types</h2>

<p>The following types are supported; they allow you to get an access token representing the current user and OAuth 
client application. With the access token, you’ll be able to query the <code class="language-plaintext highlighter-rouge">/profile</code> endpoint and get the user profile.</p>

<h3 id="authorization-code">Authorization Code</h3>

<p>The authorization code type is made for UI interactions: the user will enter credentials, shall receive a code and will exchange that code for an access token.</p>

<table>
  <thead>
    <tr>
      <th>Endpoint</th>
      <th>Parameters</th>
      <th>Response</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/oauth2.0/authorize</code></td>
      <td><code class="language-plaintext highlighter-rouge">response_type=code&amp;client_id=&lt;ID&gt;&amp;redirect_uri=&lt;CALLBACK&gt;</code></td>
      <td>OAuth code as a parameter of the <code class="language-plaintext highlighter-rouge">CALLBACK</code> url.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/oauth2.0/accessToken</code></td>
      <td><code class="language-plaintext highlighter-rouge">grant_type=authorization_code&amp;client_id=ID</code><br /><code class="language-plaintext highlighter-rouge">&amp;client_secret=SECRET&amp;code=CODE&amp;redirect_uri=CALLBACK</code></td>
      <td>The access token.</td>
    </tr>
  </tbody>
</table>

<h4 id="proof-key-code-exchange-pkce">Proof Key Code Exchange (PKCE)</h4>

<p>The <a href="https://tools.ietf.org/html/rfc7636">Proof Key for Code Exchange</a> (PKCE, pronounced pixie) extension describes a technique for public clients to mitigate the threat of having the authorization code intercepted. The technique involves the client first creating a secret, and then using that secret again when exchanging the authorization code for an access token. This way if the code is intercepted, it will not be useful since the token request relies on the initial secret.</p>

<p>The authorization code type at the authorization endpoint <code class="language-plaintext highlighter-rouge">/oauth2.0/authorize</code> is able to accept the following parameters to activate PKCE:</p>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">code_challenge</code></td>
      <td>The code challenge generated using the method below.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">code_challenge_method</code></td>
      <td><code class="language-plaintext highlighter-rouge">plain</code>, <code class="language-plaintext highlighter-rouge">S256</code>. This parameter is optional, where <code class="language-plaintext highlighter-rouge">plain</code> is assumed by default.</td>
    </tr>
  </tbody>
</table>

<p>The <code class="language-plaintext highlighter-rouge">/oauth2.0/accessToken</code>  endpoint is able to accept the following parameters to activate PKCE:</p>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">code_verifier</code></td>
      <td>The original code verifier for the PKCE request, that the app originally generated before the authorization request.</td>
    </tr>
  </tbody>
</table>

<p>If the method is <code class="language-plaintext highlighter-rouge">plain</code>, then the CAS needs only to check that the provided <code class="language-plaintext highlighter-rouge">code_verifier</code> matches the expected <code class="language-plaintext highlighter-rouge">code_challenge</code> string. 
If the method is <code class="language-plaintext highlighter-rouge">S256</code>, then the CAS should take the provided <code class="language-plaintext highlighter-rouge">code_verifier</code> and transform it using the same method the client will have used initially. This means calculating the SHA256 hash of the verifier and base64-url-encoding it, then comparing it to the stored <code class="language-plaintext highlighter-rouge">code_challenge</code>.</p>

<p>If the verifier matches the expected value, then the CAS can continue on as normal, issuing an access token and responding appropriately.</p>

<h3 id="tokenimplicit">Token/Implicit</h3>

<p>The <code class="language-plaintext highlighter-rouge">token</code> type is also made for UI interactions as well as indirect non-interactive (i.e. Javascript) applications.</p>

<table>
  <thead>
    <tr>
      <th>Endpoint</th>
      <th>Parameters</th>
      <th>Response</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/oauth2.0/authorize</code></td>
      <td><code class="language-plaintext highlighter-rouge">response_type=token&amp;client_id=ID&amp;redirect_uri=CALLBACK</code></td>
      <td>The access token as an anchor parameter of the <code class="language-plaintext highlighter-rouge">CALLBACK</code> url.</td>
    </tr>
  </tbody>
</table>

<h3 id="resource-owner-credentials">Resource Owner Credentials</h3>

<p>The <code class="language-plaintext highlighter-rouge">password</code> grant type allows the OAuth client to directly send the user’s credentials to the OAuth server.
This grant is a great user experience for trusted first party clients both on the web and in native device applications.</p>

<table>
  <thead>
    <tr>
      <th>Endpoint</th>
      <th>Parameters</th>
      <th>Response</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/oauth2.0/accessToken</code></td>
      <td><code class="language-plaintext highlighter-rouge">grant_type=password&amp;client_id=ID</code><br /><code class="language-plaintext highlighter-rouge">&amp;client_secret=&lt;SECRET&gt;</code><br /><code class="language-plaintext highlighter-rouge">&amp;username=USERNAME&amp;password=PASSWORD</code></td>
      <td>The access token.</td>
    </tr>
  </tbody>
</table>

<p>Because there is no <code class="language-plaintext highlighter-rouge">redirect_uri</code> specified by this grant type, the service identifier recognized by CAS and matched in the service registry is taken as the <code class="language-plaintext highlighter-rouge">client_id</code> instead. You may optionally also pass along a <code class="language-plaintext highlighter-rouge">service</code> or <code class="language-plaintext highlighter-rouge">X-service</code> header value that identifies the target application url. The header value must match the OAuth service definition in the registry that is linked to the client id.</p>

<h3 id="client-credentials">Client Credentials</h3>

<p>The simplest of all of the OAuth grants, this grant is suitable for machine-to-machine authentication 
where a specific user’s permission to access data is not required.</p>

<table>
  <thead>
    <tr>
      <th>Endpoint</th>
      <th>Parameters</th>
      <th>Response</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/oauth2.0/accessToken</code></td>
      <td><code class="language-plaintext highlighter-rouge">grant_type=client_credentials&amp;client_id=client&amp;client_secret=secret</code></td>
      <td>The access token.</td>
    </tr>
  </tbody>
</table>

<p>Because there is no <code class="language-plaintext highlighter-rouge">redirect_uri</code> specified by this grant type, the service identifier recognized by CAS and matched in the service registry is taken as the <code class="language-plaintext highlighter-rouge">client_id</code> instead. You may optionally also pass along a <code class="language-plaintext highlighter-rouge">service</code> or <code class="language-plaintext highlighter-rouge">X-service</code> header value that identifies the target application url. The header value must match the OAuth service definition in the registry that is linked to the client id.</p>

<h3 id="refresh-token">Refresh Token</h3>

<p>The refresh token grant type retrieves a new access token from a refresh token (emitted for a previous access token),
when this previous access token is expired.</p>

<table>
  <thead>
    <tr>
      <th>Endpoint</th>
      <th>Parameters</th>
      <th>Response</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/oauth2.0/accessToken</code></td>
      <td><code class="language-plaintext highlighter-rouge">grant_type=refresh_token&amp;client_id=&lt;ID&gt;</code><br /><code class="language-plaintext highlighter-rouge">&amp;client_secret=SECRET&amp;refresh_token=REFRESH_TOKEN</code></td>
      <td>The new access token.</td>
    </tr>
  </tbody>
</table>

<h3 id="device-flow">Device Flow</h3>

<table>
  <thead>
    <tr>
      <th>Endpoint</th>
      <th>Parameters</th>
      <th>Response</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/oauth2.0/accessToken</code></td>
      <td><code class="language-plaintext highlighter-rouge">response_type=device_code&amp;client_id=&lt;ID&gt;</code></td>
      <td>Device authorization url, device code and user code.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/oauth2.0/accessToken</code></td>
      <td><code class="language-plaintext highlighter-rouge">response_type=device_code&amp;client_id=&lt;ID&gt;&amp;code=&lt;DEVICE_CODE&gt;</code></td>
      <td>New access token once the user code is approved.</td>
    </tr>
  </tbody>
</table>

<h2 id="grant-type-selection">Grant Type Selection</h2>

<p>A grant is a method of acquiring an access token. Deciding which grants to implement depends on the type of client the end user will be using, and the experience you want for your users.</p>

<p><img src="https://alexbilbie.com/images/oauth-grants.svg" alt="" /></p>

<p>To learn more about profiles and grant types, please <a href="https://alexbilbie.com/guide-to-oauth-2-grants/">review this guide</a>.</p>

<h2 id="register-clients">Register Clients</h2>

<p>Every OAuth client must be defined as a CAS service (notice the new <em>clientId</em> and <em>clientSecret</em> properties, specific to OAuth):</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.support.oauth.services.OAuthRegisteredService"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"clientId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"clientid"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"clientSecret"</span><span class="p">:</span><span class="w"> </span><span class="s2">"clientSecret"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"serviceId"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"^(https|imaps)://&lt;redirect-uri&gt;.*"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"OAuthService"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
  </span><span class="nl">"supportedGrantTypes"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"java.util.HashSet"</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"..."</span><span class="p">,</span><span class="w"> </span><span class="s2">"..."</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">],</span><span class="w">
  </span><span class="nl">"supportedResponseTypes"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"java.util.HashSet"</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"..."</span><span class="p">,</span><span class="w"> </span><span class="s2">"..."</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>The following fields are supported:</p>

<table>
  <thead>
    <tr>
      <th>Field</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">clientId</code></td>
      <td>The client identifier for the application/service.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">clientSecret</code></td>
      <td>The client secret for the application/service.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">supportedGrantTypes</code></td>
      <td>Collection of supported grant types for this service.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">supportedResponseTypes</code></td>
      <td>Collection of supported response types for this service.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">bypassApprovalPrompt</code></td>
      <td>Whether approval prompt/consent screen should be bypassed. Default is <code class="language-plaintext highlighter-rouge">false</code>.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">generateRefreshToken</code></td>
      <td>Whether a refresh token should be generated along with the access token. Default is <code class="language-plaintext highlighter-rouge">false</code>.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">serviceId</code></td>
      <td>The pattern that authorizes the redirect URI(s), or same as <code class="language-plaintext highlighter-rouge">clientId</code> in case <code class="language-plaintext highlighter-rouge">redirect_uri</code> is not required by the grant type (i.e <code class="language-plaintext highlighter-rouge">client_credentials</code>, etc).</td>
    </tr>
  </tbody>
</table>

<div class="alert alert-info"><strong>Keep What You Need!</strong><p>You are encouraged to only keep and maintain properties and settings needed for a particular integration. It is <strong>UNNECESSARY</strong> to grab a copy of all service fields and try to configure them yet again based on their default. While you may wish to keep a copy as a reference, this strategy would ultimately lead to poor upgrades increasing chances of breaking changes and a messy deployment at that.</p></div>

<p>Service definitions are typically managed by the <a href="../services/Service-Management.html">service management</a> facility.</p>

<div class="alert alert-warning"><strong>Usage Warning!</strong><p>CAS today does not strictly enforce the collection of authorized supported response/grant types for backward compatibility reasons. This means that if left undefined, all grant and response types may be allowed by the service definition and related policies. Do please note that this behavior is <strong>subject to change</strong> in future releases and thus, it is strongly recommended that all authorized grant/response types for each profile be declared in the service definition immediately to avoid surprises in the future.</p></div>

<h3 id="attribute-release">Attribute Release</h3>

<p>Attribute/claim filtering and release policies are defined per OAuth service.
See <a href="../integration/Attribute-Release-Policies.html">this guide</a> for more info.</p>

<h2 id="oauth-expiration-policy">OAuth Expiration Policy</h2>

<p>The expiration policy for OAuth tokens is controlled by CAS settings and properties. Note that while access and refresh tokens may have their own lifetime and expiration policy, they are typically upper-bound to the length of the CAS single sign-on session.</p>

<p>To see the relevant list of CAS properties, please <a href="../configuration/Configuration-Properties.html#oauth2">review this guide</a>.</p>

<h2 id="oauth-user-profile-structure">OAuth User Profile Structure</h2>

<p>The requested user profile may be rendered and consumed by the application using the following options.</p>

<h3 id="nested">Nested</h3>

<p>By default, the requested user profile is rendered using a <code class="language-plaintext highlighter-rouge">NESTED</code> format where the authenticated principal and attributes are placed inside <code class="language-plaintext highlighter-rouge">id</code> and <code class="language-plaintext highlighter-rouge">attributes</code> tags respectively in the final structure.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"casuser"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"attributes"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"casuser@example.org"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CAS"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"something"</span><span class="p">:</span><span class="w"> </span><span class="s2">"else"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="flat">Flat</h3>

<p>This option flattens principal attributes by one degree, putting them at the same level as <code class="language-plaintext highlighter-rouge">id</code>. Other nested elements in the final payload are left untouched.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"casuser"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"casuser@example.org"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CAS"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"something"</span><span class="p">:</span><span class="w"> </span><span class="s2">"else"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>To see the relevant list of CAS properties, please <a href="../configuration/Configuration-Properties.html#oauth2">review this guide</a>.</p>

<h3 id="custom">Custom</h3>

<p>If you wish to create your own profile structure, you will need to design a component and register it with CAS to handle the rendering of the user profile:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">org.apereo.cas.support.oauth</span><span class="o">;</span>

<span class="nd">@Configuration</span><span class="o">(</span><span class="s">"MyOAuthConfiguration"</span><span class="o">)</span>
<span class="nd">@EnableConfigurationProperties</span><span class="o">(</span><span class="nc">CasConfigurationProperties</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyOAuthConfiguration</span> <span class="o">{</span>

    <span class="nd">@Bean</span>
    <span class="nd">@RefreshScope</span>
    <span class="kd">public</span> <span class="nc">OAuth20UserProfileViewRenderer</span> <span class="nf">oauthUserProfileViewRenderer</span><span class="o">()</span> <span class="o">{</span>
        <span class="o">...</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><a href="../configuration/Configuration-Management-Extensions.html">See this guide</a> to learn more about how to register configurations into the CAS runtime.</p>

<h2 id="throttling">Throttling</h2>

<p>Authentication throttling may be enabled for the <code class="language-plaintext highlighter-rouge">/oauth2.0/accessToken</code> provided support is included in the overlay to <a href="Configuring-Authentication-Throttling.html">turn on authentication 
throttling</a> support. The throttling mechanism that handles the usual CAS server endpoints for authentication
and ticket validation, etc is then activated for the OAuth endpoints that are supported for throttling.</p>

<p>To see the relevant list of CAS properties, please <a href="../configuration/Configuration-Properties.html#oauth2">review this guide</a>.</p>

<h2 id="server-configuration">Server Configuration</h2>

<p>Remember that OAuth features of CAS require session affinity (and optionally session replication),
as the authorization responses throughout the login flow are stored via server-backed session storage mechanisms. You will need to configure your deployment 
environment and load balancers accordingly.</p>

<h2 id="sample-client-applications">Sample Client Applications</h2>

<ul>
  <li><a href="https://github.com/cas-projects/oauth2-sample-java-webapp">OAuth2 Sample Webapp</a></li>
</ul>

<h1 id="openid-authentication">OpenID Authentication</h1>

<p>To configure CAS to act as an OpenID provider, please <a href="../protocol/OpenID-Protocol.html">see this page</a>.</p>

                </div>
            </section>
        </main>
    </div>
</div>


<footer>
    <div class="container">
        CAS is supported by the <a href="https://www.apereo.org/">Apereo Foundation</a>.
    </div>
</footer>

<script>
    let pageSection = 'Authentication';
</script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.3.2/js/tether.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js"></script>

<script src="../../javascripts/URI.js"></script>
<script src="../../javascripts/main.js"></script>

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script>
<script type="text/javascript" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
</body>

</html>
