<!DOCTYPE html>
<html>

<head>
    <!-- Required meta tags always come first -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="CAS - Enterprise Single Sign-On for the Web"/>
    <meta name="keywords" content="authentication, login, cas, central authentication service, web, java, protocol, thymeleaf,
                   open source, boot, spring, authorization, google, facebook, twitter, higher-ed, enterprise,
                   access management, single signon, sso, RBAC, ABAC, attributes, SAML, OpenID, openid connect,
                   JWT, ADFS"/>
    <meta name="robots" content="index,follow"/>

    
    

        
    


    

    <script>
        ((i, s, o, g, r, a, m) => {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-83384532-2', 'auto');
        ga('send', 'pageview');

    </script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3"/>

    <link rel="stylesheet" type="text/css" media="screen" href="../../stylesheets/stylesheet.css">
    <link rel="stylesheet" type="text/css" media="print" href="../../stylesheets/print.css">

    <link href='https://fonts.googleapis.com/css?family=Lato:400,300,700' rel='stylesheet'>
    <link href='https://fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic&subset=latin-ext,latin' rel='stylesheet'>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@100;200;300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css" rel="stylesheet">

    <title>CAS - Multifactor Authentication</title>

</head>

<body>
<!-- HEADER -->
<header class="hidden-sm-down">
    <div class="container">
        <div class="row">
            <div class="col-xs-4 col-md-2">
                <a href="../../index.html">
                    <img class="undecorated" src="../../images/cas_logo.png"/>
                </a>
            </div>
            <div class="col-xs-8 col-md-6">
                <h1>Enterprise Single Sign-On for All</h1>
            </div>
            <div class="hidden-sm-down col-md-4">
                <a id="forkme_banner" href="https://github.com/apereo/cas">View on GitHub</a>
            </div>

        </div>
    </div>
</header>

<!-- NAVBAR -->

<nav class="navbar navbar-expand-md navbar-dark bg-primary bg-dark">
    <div class="container">
        <button class="navbar-toggler collapsed" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarsExample04" aria-controls="navbarsExample04" aria-expanded="false"
                aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="navbar-collapse collapse" id="navbarsExample04">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active"><a href="../../index.html" class="zoom nav-link">Home</a></li>
                <li class="nav-item"><a href="https://github.com/apereo/cas/releases" class="zoom nav-link">Releases</a></li>
                <li class="nav-item"><a href="../../Support.html" class="zoom nav-link">Support</a></li>
                <li class="nav-item"><a href="../../Mailing-Lists.html" class="zoom nav-link">Mailing Lists</a></li>
                <li class="nav-item">
                    <a class="zoom nav-link" href="../../Demos.html">Demos</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="zoom nav-link dropdown-toggle mr-md-2" href="#" id="cas-versions" data-bs-toggle="dropdown"
                       aria-haspopup="true" aria-expanded="false">Versions</a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="cas-versions">
                        
                        
                        <a class="dropdown-item" href="/cas/development/">Development</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.6.x/">v6.6.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.5.x/">v6.5.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.4.x/">v6.4.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.3.x/">v6.3.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.2.x/">v6.2.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.1.x/">v6.1.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.0.x/">v6.0.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.3.x/">v5.3.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.2.x/">v5.2.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.1.x/">v5.1.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/5.0.x/">v5.0.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/4.2.x/">v4.2.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/4.1.x/">v4.1.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/4.0.x/">v4.0.x</a>
                        
                        

                    </div>
                </li>
                <li class="nav-item"><a href="https://apereo.github.io" target="_blank" class="zoom nav-link">Blog</a></li>
            </ul>

        </div>

    </div>
</nav>


<div class="container-fluid">
    <div class="row flex-xl-nowrap">
        <div class="col-12 col-md-3 col-xl-2 docs-sidebar pb-5" id="sidebar"></div>


        <div class="d-none d-xl-block col-xl-2 docs-toc">
    <div id="pageContents">
        <ul class="section-nav"></ul>
    </div>
</div>


        <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 cas-docs-content" role="main">


            

            <section>
                <nav id="docsNavBar">
                    <span id="toolbarIcons"></span>
                </nav>

                <div id="cas-docs-container">
                    <h1 id="multifactor-authentication-mfa">Multifactor Authentication (MFA)</h1>

<p>CAS provides support for a variety of multifactor authentication providers and options, while allowing one to design their own. The secondary authentication factor always kicks in <em>after</em> the primary step and existing authentication sessions will be asked to step-up to the needed multifactor authentication factor, should the request or trigger require it. The satisfied authentication context is communicated back to the application as well to denote a successful multifactor authentication event.</p>

<p>At a minimum, you need answer the following questions:</p>

<ul>
  <li>Which provider(s) are we using for multifactor authentication?</li>
  <li>How and for whom are we triggering multifactor authentication?</li>
</ul>

<h2 id="supported-providers">Supported Providers</h2>

<p>The following multifactor providers are supported by CAS.</p>

<table>
  <thead>
    <tr>
      <th>Provider</th>
      <th>Id</th>
      <th>Instructions</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Duo Security</td>
      <td><code class="language-plaintext highlighter-rouge">mfa-duo</code></td>
      <td><a href="DuoSecurity-Authentication.html">See this guide</a>.</td>
    </tr>
    <tr>
      <td>Authy Authenticator</td>
      <td><code class="language-plaintext highlighter-rouge">mfa-authy</code></td>
      <td><a href="AuthyAuthenticator-Authentication.html">See this guide</a>.</td>
    </tr>
    <tr>
      <td>YubiKey</td>
      <td><code class="language-plaintext highlighter-rouge">mfa-yubikey</code></td>
      <td><a href="YubiKey-Authentication.html">See this guide</a>.</td>
    </tr>
    <tr>
      <td>RSA/RADIUS</td>
      <td><code class="language-plaintext highlighter-rouge">mfa-radius</code></td>
      <td><a href="RADIUS-Authentication.html">See this guide</a>.</td>
    </tr>
    <tr>
      <td>WiKID</td>
      <td><code class="language-plaintext highlighter-rouge">mfa-radius</code></td>
      <td><a href="RADIUS-Authentication.html">See this guide</a>.</td>
    </tr>
    <tr>
      <td>Google Authenticator</td>
      <td><code class="language-plaintext highlighter-rouge">mfa-gauth</code></td>
      <td><a href="GoogleAuthenticator-Authentication.html">See this guide</a>.</td>
    </tr>
    <tr>
      <td>FIDO U2F</td>
      <td><code class="language-plaintext highlighter-rouge">mfa-u2f</code></td>
      <td><a href="FIDO-U2F-Authentication.html">See this guide</a>.</td>
    </tr>
    <tr>
      <td>CAS Simple</td>
      <td><code class="language-plaintext highlighter-rouge">mfa-simple</code></td>
      <td><a href="Simple-Multifactor-Authentication.html">See this guide</a>.</td>
    </tr>
    <tr>
      <td>Swivel Secure</td>
      <td><code class="language-plaintext highlighter-rouge">mfa-swivel</code></td>
      <td><a href="SwivelSecure-Authentication.html">See this guide</a>.</td>
    </tr>
    <tr>
      <td>Custom</td>
      <td>Custom</td>
      <td><a href="../mfa/Custom-MFA-Authentication.html">See this guide</a>.</td>
    </tr>
  </tbody>
</table>

<h2 id="triggers">Triggers</h2>

<p>Multifactor authentication can be activated via a number of triggers.
To learn more, <a href="Configuring-Multifactor-Authentication-Triggers.html">please see this guide</a>.</p>

<h2 id="bypass-rules">Bypass Rules</h2>

<p>Each multifactor provider is equipped with options to allow for MFA bypass. To learn more, <a href="../mfa/Configuring-Multifactor-Authentication-Bypass.html">please see this guide</a>.</p>

<h2 id="failure-modes">Failure Modes</h2>

<p>The authentication policy by default supports fail-closed mode, which means that if you attempt to exercise a particular
provider available to CAS and the provider cannot be reached, authentication will be stopped and an error
will be displayed. You can of course change this behavior so that authentication proceeds without exercising the provider
functionality, if that provider cannot respond.</p>

<p>The following failure modes are supported:</p>

<table>
  <thead>
    <tr>
      <th>Field</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">CLOSED</code></td>
      <td>Authentication is blocked if the provider cannot be reached.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">OPEN</code></td>
      <td>Authentication proceeds yet requested MFA is NOT communicated to the client if provider is unavailable.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">PHANTOM</code></td>
      <td>Authentication proceeds and requested MFA is communicated to the client if provider is unavailable.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">NONE</code></td>
      <td>Do not contact the provider at all to check for availability. Assume the provider is available.</td>
    </tr>
  </tbody>
</table>

<h3 id="failure-mode-selection">Failure Mode Selection</h3>

<p>CAS will consult the current configuration in the event that the provider being requested is unreachable to determine how to proceed.<br />
The failure mode can be configured at these locations and CAS will use the first defined failure mode in this order:</p>

<ul>
  <li>Registered Service Multifactor Authentication Policy</li>
  <li>Multifactor Authentication Provider Configuration</li>
  <li>Global Multifactor Authentication Configuration</li>
</ul>

<p>If no actionable failure mode is encountered the user will be shown a generic “Authentication Failed” message.</p>

<h3 id="failure-mode-by-registered-service">Failure Mode by Registered Service</h3>

<p>Set as part of the “multifactorPolicy”.  This location will override a failure a mode set at any other location.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.services.RegexRegisteredService"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"serviceId"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"^(https|imaps)://.*"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
  </span><span class="nl">"multifactorPolicy"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.services.DefaultRegisteredServiceMultifactorPolicy"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"multifactorAuthenticationProviders"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"java.util.LinkedHashSet"</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"mfa-duo"</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">],</span><span class="w">
    </span><span class="nl">"failureMode"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"CLOSED"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="failure-mode-by-multifactor-authentication-provider">Failure Mode by Multifactor Authentication Provider</h3>

<p>Each defined multifactor authentication provider can set its own failure mode policy. Failure modes set at this location will override the global failure mode, but defer to any failure mode set by the registered service.</p>

<p>To see the relevant list of CAS properties, please <a href="../configuration/Configuration-Properties-Common.html#multifactor-authentication-providers">review this guide</a>.</p>

<h3 id="global-failure-mode">Global Failure Mode</h3>

<p>A default failure mode can be specified globally via CAS properties and will be used in the case where no failure mode is set in either the provider or the registered service.</p>

<p>To see the relevant list of CAS properties, please <a href="../configuration/Configuration-Properties.html#multifactor-authentication">review this guide</a>.</p>

<h2 id="multiple-provider-selection">Multiple Provider Selection</h2>

<p>In the event that multiple multifactor authentication providers are determined for a multifactor authentication transaction, by default CAS will attempt to sort the collection of providers based on their rank and will pick one with the highest priority. This use case may arise if multiple triggers are defined where each decides on a different multifactor authentication provider, or the same provider instance is configured multiple times with many instances.</p>

<p>Provider selection may also be carried out using Groovy scripting strategies more dynamically. The following example should serve as an outline of how to select multifactor providers based on a Groovy script:</p>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">java.util.*</span>

<span class="kd">class</span> <span class="nc">SampleGroovyProviderSelection</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">String</span> <span class="nf">run</span><span class="o">(</span><span class="kd">final</span> <span class="n">Object</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">def</span> <span class="n">service</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
        <span class="kt">def</span> <span class="n">principal</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span>
        <span class="kt">def</span> <span class="n">providersCollection</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span>
        <span class="kt">def</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span>
        <span class="o">...</span>
        <span class="k">return</span> <span class="s2">"mfa-duo"</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The parameters passed are as follows:</p>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">service</code></td>
      <td>The object representing the incoming service provided in the request, if any.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">principal</code></td>
      <td>The object representing the authenticated principal along with its attributes.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">providersCollection</code></td>
      <td>The object representing the collection of candidate multifactor providers qualified for the transaction.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">logger</code></td>
      <td>The object responsible for issuing log messages such as <code class="language-plaintext highlighter-rouge">logger.info(...)</code>.</td>
    </tr>
  </tbody>
</table>

<p>To see the relevant list of CAS properties, please <a href="../configuration/Configuration-Properties.html#multifactor-authentication">review this guide</a>.</p>

<h2 id="ranking-providers">Ranking Providers</h2>

<p>At times, CAS needs to determine the correct provider when step-up authentication is required. Consider for a moment that CAS
already has established an SSO session with/without a provider and has reached a level of authentication. Another incoming
request attempts to exercise that SSO session with a different and often competing authentication requirement that may differ
from the authentication level CAS has already established. Concretely, examples may be:</p>

<ul>
  <li>CAS has achieved an SSO session, but a separate request now requires step-up authentication with DuoSecurity.</li>
  <li>CAS has achieved an SSO session with an authentication level satisfied by DuoSecurity, but a separate request now requires step-up authentication with YubiKey.</li>
</ul>

<p>In certain scenarios, CAS will attempt to rank authentication levels and compare them with each other. If CAS already has achieved a level
that is higher than what the incoming request requires, no step-up authentication will be performed. If the opposite is true, CAS will
route the authentication flow to the required authentication level and upon success, will adjust the SSO session with the new higher
authentication level now satisfied.</p>

<p>Ranking of authentication methods is done per provider via specific properties for each in CAS settings. Note that
the higher the rank value is, the higher on the security scale it remains. A provider that ranks higher with a larger weight value trumps
and override others with a lower value.</p>

<h2 id="trusted-devicesbrowsers">Trusted Devices/Browsers</h2>

<p>CAS is able to natively provide trusted device/browser features as part of any multifactor authentication flow. While certain providers tend to support this feature as well, this behavior is now put into CAS directly providing you with exact control over how devices/browsers are checked, how is that decision remembered for subsequent requests and how you might allow delegated management of those trusted decisions both for admins and end-users.</p>

<p><a href="Multifactor-TrustedDevice-Authentication.html">See this guide for more info</a>.</p>

<h2 id="2fa-vs-mfa">2FA vs. MFA</h2>

<p>Multifactor authentication in CAS mostly presents itself in form of two-factor authentication when deployed. The framework however is designed in such a way to allow additional chaining of other providers into an existing authentication experience. If you have a need to string along multiple factors together one after another, it is likely that you may need to adjust and extend the existing authentication workflows to deliver the use case.</p>

<h2 id="settings">Settings</h2>

<p>To see the relevant list of CAS properties, please <a href="../configuration/Configuration-Properties.html#multifactor-authentication">review this guide</a>.</p>

                </div>
            </section>
        </main>
    </div>
</div>


<footer>
    <div class="container">
        CAS is supported by the <a href="https://www.apereo.org/">Apereo Foundation</a>.
    </div>
</footer>

<script>
    let pageSection = 'Multifactor Authentication';
</script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.3.2/js/tether.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js"></script>

<script src="../../javascripts/URI.js"></script>
<script src="../../javascripts/main.js"></script>

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script>
<script type="text/javascript" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
</body>

</html>
